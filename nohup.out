/opt/conda/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/opt/conda/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
[2024-05-31 14:26:32,539] [INFO] [real_accelerator.py:203:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2024-05-31 14:26:37,192] [INFO] [real_accelerator.py:203:get_accelerator] Setting ds_accelerator to cuda (auto detect)
Warning: The default cache directory for DeepSpeed Triton autotune, /root/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
[93m [WARNING] [0m async_io requires the dev libaio .so object and headers but these were not found.
[93m [WARNING] [0m async_io: please install the libaio-dev package with apt
[93m [WARNING] [0m If libaio is already installed (perhaps from source), try setting the CFLAGS and LDFLAGS environment variables to where it can be found.
[93m [WARNING] [0m Please specify the CUTLASS repo directory as environment variable $CUTLASS_PATH
[93m [WARNING] [0m sparse_attn requires a torch version >= 1.5 and < 2.0 but detected 2.3
[93m [WARNING] [0m using untested triton version (2.3.0), only 1.0.0 is known to be compatible
[2024-05-31 14:26:37,963] [INFO] [comm.py:637:init_distributed] cdb=None
[2024-05-31 14:26:37,963] [INFO] [comm.py:668:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
2024-05-31 14:26:38 - WARNING - __main__ - Process rank: 0, device: cuda:0, n_gpu: 1 distributed training: True, 16-bits training: False
2024-05-31 14:26:38 - INFO - __main__ - Training/evaluation parameters TrainingArguments(
_n_gpu=1,
accelerator_config={'split_batches': False, 'dispatch_batches': None, 'even_batches': True, 'use_seedable_sampler': True, 'non_blocking': False, 'gradient_accumulation_kwargs': None},
adafactor=False,
adam_beta1=0.9,
adam_beta2=0.999,
adam_epsilon=1e-08,
auto_find_batch_size=False,
batch_eval_metrics=False,
bf16=True,
bf16_full_eval=False,
data_seed=None,
dataloader_drop_last=False,
dataloader_num_workers=0,
dataloader_persistent_workers=False,
dataloader_pin_memory=True,
dataloader_prefetch_factor=None,
ddp_backend=None,
ddp_broadcast_buffers=None,
ddp_bucket_cap_mb=None,
ddp_find_unused_parameters=None,
ddp_timeout=1800,
debug=[],
deepspeed=None,
disable_tqdm=False,
dispatch_batches=None,
do_eval=False,
do_predict=False,
do_train=False,
eval_accumulation_steps=None,
eval_delay=0,
eval_do_concat_batches=True,
eval_steps=None,
eval_strategy=no,
evaluation_strategy=None,
fp16=False,
fp16_backend=auto,
fp16_full_eval=False,
fp16_opt_level=O1,
fsdp=[],
fsdp_config={'min_num_params': 0, 'xla': False, 'xla_fsdp_v2': False, 'xla_fsdp_grad_ckpt': False},
fsdp_min_num_params=0,
fsdp_transformer_layer_cls_to_wrap=None,
full_determinism=False,
gradient_accumulation_steps=1,
gradient_checkpointing=True,
gradient_checkpointing_kwargs={'use_reentrant': False},
greater_is_better=None,
group_by_length=False,
half_precision_backend=auto,
hub_always_push=False,
hub_model_id=None,
hub_private_repo=False,
hub_strategy=every_save,
hub_token=<HUB_TOKEN>,
ignore_data_skip=False,
include_inputs_for_metrics=False,
include_num_input_tokens_seen=False,
include_tokens_per_second=False,
jit_mode_eval=False,
label_names=None,
label_smoothing_factor=0.0,
learning_rate=5e-05,
length_column_name=length,
load_best_model_at_end=False,
local_rank=0,
log_level=info,
log_level_replica=warning,
log_on_each_node=True,
logging_dir=./checkpoint_dir/runs/May31_14-26-37_n08,
logging_first_step=False,
logging_nan_inf_filter=True,
logging_steps=20,
logging_strategy=steps,
lr_scheduler_kwargs={},
lr_scheduler_type=cosine,
max_grad_norm=1.0,
max_steps=-1,
metric_for_best_model=None,
mp_parameters=,
neftune_noise_alpha=None,
no_cuda=False,
num_train_epochs=5,
optim=adamw_torch,
optim_args=None,
optim_target_modules=None,
output_dir=./checkpoint_dir,
overwrite_output_dir=True,
past_index=-1,
per_device_eval_batch_size=2,
per_device_train_batch_size=2,
prediction_loss_only=False,
push_to_hub=False,
push_to_hub_model_id=None,
push_to_hub_organization=None,
push_to_hub_token=<PUSH_TO_HUB_TOKEN>,
ray_scope=last,
remove_unused_columns=True,
report_to=['tensorboard'],
restore_callback_states_from_checkpoint=False,
resume_from_checkpoint=None,
run_name=./checkpoint_dir,
save_on_each_node=False,
save_only_model=False,
save_safetensors=True,
save_steps=100,
save_strategy=steps,
save_total_limit=1,
seed=0,
skip_memory_metrics=True,
split_batches=None,
tf32=None,
torch_compile=False,
torch_compile_backend=None,
torch_compile_mode=None,
torchdynamo=None,
tpu_metrics_debug=False,
tpu_num_cores=None,
use_cpu=False,
use_ipex=False,
use_legacy_prediction_loop=False,
use_mps_device=False,
warmup_ratio=0.2,
warmup_steps=0,
weight_decay=0.0,
)
2024-05-31 14:26:38 - INFO - __main__ - PEFT parameters LoraConfig(peft_type=<PeftType.LORA: 'LORA'>, auto_mapping=None, base_model_name_or_path=None, revision=None, task_type='CAUSAL_LM', inference_mode=False, r=16, target_modules='all-linear', lora_alpha=32, lora_dropout=0.05, fan_in_fan_out=False, bias='none', use_rslora=False, modules_to_save=None, init_lora_weights=True, layers_to_transform=None, layers_pattern=None, rank_pattern={}, alpha_pattern={}, megatron_config=None, megatron_core='megatron.core', loftq_config={}, use_dora=False)
[INFO|configuration_utils.py:731] 2024-05-31 14:26:38,096 >> loading configuration file ./config.json
[INFO|configuration_utils.py:731] 2024-05-31 14:26:38,100 >> loading configuration file ./config.json
[INFO|configuration_utils.py:796] 2024-05-31 14:26:38,101 >> Model config Phi3Config {
  "_name_or_path": "./",
  "architectures": [
    "Phi3ForCausalLM"
  ],
  "attention_dropout": 0.0,
  "auto_map": {
    "AutoConfig": "configuration_phi3.Phi3Config",
    "AutoModelForCausalLM": "modeling_phi3.Phi3ForCausalLM"
  },
  "bos_token_id": 1,
  "embd_pdrop": 0.0,
  "eos_token_id": 32000,
  "hidden_act": "silu",
  "hidden_size": 3072,
  "initializer_range": 0.02,
  "intermediate_size": 8192,
  "max_position_embeddings": 4096,
  "model_type": "phi3",
  "num_attention_heads": 32,
  "num_hidden_layers": 32,
  "num_key_value_heads": 32,
  "original_max_position_embeddings": 4096,
  "pad_token_id": 32000,
  "resid_pdrop": 0.0,
  "rms_norm_eps": 1e-05,
  "rope_scaling": null,
  "rope_theta": 10000.0,
  "sliding_window": 2047,
  "tie_word_embeddings": false,
  "torch_dtype": "bfloat16",
  "transformers_version": "4.41.1",
  "use_cache": false,
  "vocab_size": 32064
}

[INFO|modeling_utils.py:3471] 2024-05-31 14:26:38,143 >> loading weights file ./model.safetensors.index.json
[INFO|modeling_utils.py:1519] 2024-05-31 14:26:38,144 >> Instantiating Phi3ForCausalLM model under default dtype torch.bfloat16.
[INFO|modeling_utils.py:3614] 2024-05-31 14:26:38,144 >> Detected DeepSpeed ZeRO-3: activating zero.init() for this model
[WARNING|logging.py:329] 2024-05-31 14:26:38,150 >> You are attempting to use Flash Attention 2.0 with a model not initialized on GPU. Make sure to move the model to GPU after initializing it on CPU with `model.to('cuda')`.
[INFO|configuration_utils.py:962] 2024-05-31 14:26:38,156 >> Generate config GenerationConfig {
  "bos_token_id": 1,
  "eos_token_id": 32000,
  "pad_token_id": 32000,
  "use_cache": false
}

[2024-05-31 14:26:38,613] [INFO] [partition_parameters.py:345:__exit__] finished initializing model - num_params = 195, num_elems = 3.82B
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:01<00:01,  1.16s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:01<00:00,  1.12it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:01<00:00,  1.07it/s]
[INFO|modeling_utils.py:4280] 2024-05-31 14:26:40,507 >> All model checkpoint weights were used when initializing Phi3ForCausalLM.

[INFO|modeling_utils.py:4288] 2024-05-31 14:26:40,507 >> All the weights of Phi3ForCausalLM were initialized from the model checkpoint at ./.
If your task is similar to the task the model of the checkpoint was trained on, you can already use Phi3ForCausalLM for predictions without further training.
[INFO|configuration_utils.py:915] 2024-05-31 14:26:40,511 >> loading configuration file ./generation_config.json
[INFO|configuration_utils.py:962] 2024-05-31 14:26:40,511 >> Generate config GenerationConfig {
  "bos_token_id": 1,
  "eos_token_id": [
    32000,
    32001,
    32007
  ],
  "pad_token_id": 32000
}

[INFO|tokenization_utils_base.py:2106] 2024-05-31 14:26:40,514 >> loading file tokenizer.model
[INFO|tokenization_utils_base.py:2106] 2024-05-31 14:26:40,514 >> loading file tokenizer.json
[INFO|tokenization_utils_base.py:2106] 2024-05-31 14:26:40,514 >> loading file added_tokens.json
[INFO|tokenization_utils_base.py:2106] 2024-05-31 14:26:40,514 >> loading file special_tokens_map.json
[INFO|tokenization_utils_base.py:2106] 2024-05-31 14:26:40,514 >> loading file tokenizer_config.json
[WARNING|logging.py:314] 2024-05-31 14:26:40,572 >> Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Overwrite dataset info from restored data version if exists.
2024-05-31 14:26:40 - INFO - datasets.builder - Overwrite dataset info from restored data version if exists.
Loading Dataset info from /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5
2024-05-31 14:26:40 - INFO - datasets.info - Loading Dataset info from /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5
Found cached dataset gsm8k (/root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5)
2024-05-31 14:26:40 - INFO - datasets.builder - Found cached dataset gsm8k (/root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5)
Loading Dataset info from /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5
2024-05-31 14:26:40 - INFO - datasets.info - Loading Dataset info from /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5
-----------------------------
['question', 'answer']
-----------------------------
Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-5a7811434d08fb09.arrow
2024-05-31 14:26:40 - INFO - datasets.arrow_dataset - Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-5a7811434d08fb09.arrow
Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-7989e7b156c6dfa6.arrow
2024-05-31 14:26:40 - INFO - datasets.arrow_dataset - Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-7989e7b156c6dfa6.arrow
{'question': 'Natalia sold clips to 48 of her friends in April, and then she sold half as many clips in May. How many clips did Natalia sell altogether in April and May?', 'answer': 'Natalia sold 48/2 = <<48/2=24>>24 clips in May.\nNatalia sold 48+24 = <<48+24=72>>72 clips altogether in April and May.'}
Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-0d894978e4a745e3.arrow
2024-05-31 14:26:40 - INFO - datasets.arrow_dataset - Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-0d894978e4a745e3.arrow
Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-514d9be6b6eed3cb.arrow
2024-05-31 14:26:40 - INFO - datasets.arrow_dataset - Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-514d9be6b6eed3cb.arrow
<s><|user|>
Answer the following question.

Question: Betty is saving money for a new wallet which costs $100. Betty has only half of the money she needs. Her parents decided to give her $15 for that purpose, and her grandparents twice as much as her parents. How much more money does Betty need to buy the wallet?<|end|>
<|assistant|>
Answer: In the beginning, Betty has only 100 / 2 = $<<100/2=50>>50.
Betty's grandparents gave her 15 * 2 = $<<15*2=30>>30.
This means, Betty needs 100 - 50 - 30 - 15 = $<<100-50-30-15=5>>5 more.
Caching indices mapping at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-65491db8db39c174.arrow
2024-05-31 14:26:40 - INFO - datasets.arrow_dataset - Caching indices mapping at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-65491db8db39c174.arrow
Caching indices mapping at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-8b5e22b78537ee59.arrow
2024-05-31 14:26:40 - INFO - datasets.arrow_dataset - Caching indices mapping at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-8b5e22b78537ee59.arrow
Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-a33b343c530563b1.arrow
2024-05-31 14:26:45 - INFO - datasets.arrow_dataset - Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-a33b343c530563b1.arrow
Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-99032ae739ab2487.arrow
2024-05-31 14:26:45 - INFO - datasets.arrow_dataset - Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-99032ae739ab2487.arrow
[INFO|trainer.py:641] 2024-05-31 14:26:45,884 >> Using auto half precision backend
[2024-05-31 14:26:46,053] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed info: version=0.14.2, git-hash=unknown, git-branch=unknown
[2024-05-31 14:26:46,076] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2024-05-31 14:26:46,079] [INFO] [logging.py:96:log_dist] [Rank 0] Using client Optimizer as basic optimizer
[2024-05-31 14:26:46,079] [INFO] [logging.py:96:log_dist] [Rank 0] Removing param_group that has no 'params' in the basic Optimizer
[2024-05-31 14:26:46,094] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed Basic Optimizer = AdamW
[2024-05-31 14:26:46,094] [INFO] [utils.py:56:is_zero_supported_optimizer] Checking ZeRO support for optimizer=AdamW type=<class 'torch.optim.adamw.AdamW'>
[2024-05-31 14:26:46,094] [INFO] [logging.py:96:log_dist] [Rank 0] Creating fp16 ZeRO stage 3 optimizer, MiCS is enabled False, Hierarchical params gather False
[2024-05-31 14:26:46,094] [INFO] [logging.py:96:log_dist] [Rank 0] Creating torch.bfloat16 ZeRO stage 3 optimizer
[2024-05-31 14:26:46,224] [INFO] [utils.py:779:see_memory_usage] Stage 3 initialize beginning
[2024-05-31 14:26:46,225] [INFO] [utils.py:780:see_memory_usage] MA 7.16 GB         Max_MA 7.48 GB         CA 7.53 GB         Max_CA 8 GB 
[2024-05-31 14:26:46,225] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 24.84 GB, percent = 2.5%
[2024-05-31 14:26:46,231] [INFO] [stage3.py:130:__init__] Reduce bucket size 500,000,000
[2024-05-31 14:26:46,231] [INFO] [stage3.py:131:__init__] Prefetch bucket size 50,000,000
[2024-05-31 14:26:46,357] [INFO] [utils.py:779:see_memory_usage] DeepSpeedZeRoOffload initialize [begin]
[2024-05-31 14:26:46,358] [INFO] [utils.py:780:see_memory_usage] MA 7.16 GB         Max_MA 7.16 GB         CA 7.53 GB         Max_CA 8 GB 
[2024-05-31 14:26:46,358] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 24.84 GB, percent = 2.5%
Parameter Offload: Total persistent parameters: 8064000 in 225 params
[2024-05-31 14:26:46,619] [INFO] [utils.py:779:see_memory_usage] DeepSpeedZeRoOffload initialize [end]
[2024-05-31 14:26:46,620] [INFO] [utils.py:780:see_memory_usage] MA 7.16 GB         Max_MA 7.16 GB         CA 7.53 GB         Max_CA 8 GB 
[2024-05-31 14:26:46,620] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 24.85 GB, percent = 2.5%
[2024-05-31 14:26:46,754] [INFO] [utils.py:779:see_memory_usage] Before creating fp16 partitions
[2024-05-31 14:26:46,755] [INFO] [utils.py:780:see_memory_usage] MA 7.16 GB         Max_MA 7.16 GB         CA 7.53 GB         Max_CA 8 GB 
[2024-05-31 14:26:46,755] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 24.85 GB, percent = 2.5%
[2024-05-31 14:26:47,075] [INFO] [utils.py:779:see_memory_usage] After creating fp16 partitions: 1
[2024-05-31 14:26:47,076] [INFO] [utils.py:780:see_memory_usage] MA 7.16 GB         Max_MA 7.16 GB         CA 7.48 GB         Max_CA 8 GB 
[2024-05-31 14:26:47,076] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 24.85 GB, percent = 2.5%
[2024-05-31 14:26:47,213] [INFO] [utils.py:779:see_memory_usage] Before creating fp32 partitions
[2024-05-31 14:26:47,214] [INFO] [utils.py:780:see_memory_usage] MA 7.16 GB         Max_MA 7.16 GB         CA 7.48 GB         Max_CA 7 GB 
[2024-05-31 14:26:47,214] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 24.85 GB, percent = 2.5%
[2024-05-31 14:26:47,361] [INFO] [utils.py:779:see_memory_usage] After creating fp32 partitions
[2024-05-31 14:26:47,362] [INFO] [utils.py:780:see_memory_usage] MA 7.26 GB         Max_MA 7.31 GB         CA 7.62 GB         Max_CA 8 GB 
[2024-05-31 14:26:47,362] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 24.86 GB, percent = 2.5%
[2024-05-31 14:26:47,497] [INFO] [utils.py:779:see_memory_usage] Before initializing optimizer states
[2024-05-31 14:26:47,497] [INFO] [utils.py:780:see_memory_usage] MA 7.26 GB         Max_MA 7.26 GB         CA 7.62 GB         Max_CA 8 GB 
[2024-05-31 14:26:47,498] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 24.86 GB, percent = 2.5%
[2024-05-31 14:26:47,632] [INFO] [utils.py:779:see_memory_usage] After initializing optimizer states
[2024-05-31 14:26:47,632] [INFO] [utils.py:780:see_memory_usage] MA 7.26 GB         Max_MA 7.35 GB         CA 7.71 GB         Max_CA 8 GB 
[2024-05-31 14:26:47,633] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 24.86 GB, percent = 2.5%
[2024-05-31 14:26:47,633] [INFO] [stage3.py:486:_setup_for_real_optimizer] optimizer state initialized
[2024-05-31 14:26:47,836] [INFO] [utils.py:779:see_memory_usage] After initializing ZeRO optimizer
[2024-05-31 14:26:47,837] [INFO] [utils.py:780:see_memory_usage] MA 8.24 GB         Max_MA 8.24 GB         CA 8.64 GB         Max_CA 9 GB 
[2024-05-31 14:26:47,837] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 24.86 GB, percent = 2.5%
[2024-05-31 14:26:47,838] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed Final Optimizer = AdamW
[2024-05-31 14:26:47,838] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed using client LR scheduler
[2024-05-31 14:26:47,838] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed LR Scheduler = None
[2024-05-31 14:26:47,838] [INFO] [logging.py:96:log_dist] [Rank 0] step=0, skipped=0, lr=[0.0], mom=[(0.9, 0.999)]
[2024-05-31 14:26:47,841] [INFO] [config.py:996:print] DeepSpeedEngine configuration:
[2024-05-31 14:26:47,841] [INFO] [config.py:1000:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2024-05-31 14:26:47,841] [INFO] [config.py:1000:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2024-05-31 14:26:47,841] [INFO] [config.py:1000:print]   amp_enabled .................. False
[2024-05-31 14:26:47,841] [INFO] [config.py:1000:print]   amp_params ................... False
[2024-05-31 14:26:47,841] [INFO] [config.py:1000:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2024-05-31 14:26:47,841] [INFO] [config.py:1000:print]   bfloat16_enabled ............. True
[2024-05-31 14:26:47,841] [INFO] [config.py:1000:print]   bfloat16_immediate_grad_update  False
[2024-05-31 14:26:47,842] [INFO] [config.py:1000:print]   checkpoint_parallel_write_pipeline  False
[2024-05-31 14:26:47,842] [INFO] [config.py:1000:print]   checkpoint_tag_validation_enabled  True
[2024-05-31 14:26:47,842] [INFO] [config.py:1000:print]   checkpoint_tag_validation_fail  False
[2024-05-31 14:26:47,842] [INFO] [config.py:1000:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f07022404c0>
[2024-05-31 14:26:47,842] [INFO] [config.py:1000:print]   communication_data_type ...... None
[2024-05-31 14:26:47,842] [INFO] [config.py:1000:print]   compile_config ............... enabled=False backend='inductor' kwargs={}
[2024-05-31 14:26:47,842] [INFO] [config.py:1000:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2024-05-31 14:26:47,842] [INFO] [config.py:1000:print]   curriculum_enabled_legacy .... False
[2024-05-31 14:26:47,842] [INFO] [config.py:1000:print]   curriculum_params_legacy ..... False
[2024-05-31 14:26:47,842] [INFO] [config.py:1000:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2024-05-31 14:26:47,842] [INFO] [config.py:1000:print]   data_efficiency_enabled ...... False
[2024-05-31 14:26:47,842] [INFO] [config.py:1000:print]   dataloader_drop_last ......... False
[2024-05-31 14:26:47,842] [INFO] [config.py:1000:print]   disable_allgather ............ False
[2024-05-31 14:26:47,842] [INFO] [config.py:1000:print]   dump_state ................... False
[2024-05-31 14:26:47,842] [INFO] [config.py:1000:print]   dynamic_loss_scale_args ...... None
[2024-05-31 14:26:47,842] [INFO] [config.py:1000:print]   eigenvalue_enabled ........... False
[2024-05-31 14:26:47,842] [INFO] [config.py:1000:print]   eigenvalue_gas_boundary_resolution  1
[2024-05-31 14:26:47,842] [INFO] [config.py:1000:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2024-05-31 14:26:47,842] [INFO] [config.py:1000:print]   eigenvalue_layer_num ......... 0
[2024-05-31 14:26:47,842] [INFO] [config.py:1000:print]   eigenvalue_max_iter .......... 100
[2024-05-31 14:26:47,842] [INFO] [config.py:1000:print]   eigenvalue_stability ......... 1e-06
[2024-05-31 14:26:47,842] [INFO] [config.py:1000:print]   eigenvalue_tol ............... 0.01
[2024-05-31 14:26:47,843] [INFO] [config.py:1000:print]   eigenvalue_verbose ........... False
[2024-05-31 14:26:47,843] [INFO] [config.py:1000:print]   elasticity_enabled ........... False
[2024-05-31 14:26:47,843] [INFO] [config.py:1000:print]   flops_profiler_config ........ {
    "enabled": false, 
    "recompute_fwd_factor": 0.0, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2024-05-31 14:26:47,843] [INFO] [config.py:1000:print]   fp16_auto_cast ............... None
[2024-05-31 14:26:47,843] [INFO] [config.py:1000:print]   fp16_enabled ................. False
[2024-05-31 14:26:47,843] [INFO] [config.py:1000:print]   fp16_master_weights_and_gradients  False
[2024-05-31 14:26:47,843] [INFO] [config.py:1000:print]   global_rank .................. 0
[2024-05-31 14:26:47,843] [INFO] [config.py:1000:print]   grad_accum_dtype ............. None
[2024-05-31 14:26:47,843] [INFO] [config.py:1000:print]   gradient_accumulation_steps .. 1
[2024-05-31 14:26:47,843] [INFO] [config.py:1000:print]   gradient_clipping ............ 1.0
[2024-05-31 14:26:47,843] [INFO] [config.py:1000:print]   gradient_predivide_factor .... 1.0
[2024-05-31 14:26:47,843] [INFO] [config.py:1000:print]   graph_harvesting ............. False
[2024-05-31 14:26:47,843] [INFO] [config.py:1000:print]   hybrid_engine ................ enabled=False max_out_tokens=512 inference_tp_size=1 release_inference_cache=False pin_parameters=True tp_gather_partition_size=8
[2024-05-31 14:26:47,843] [INFO] [config.py:1000:print]   initial_dynamic_scale ........ 1
[2024-05-31 14:26:47,843] [INFO] [config.py:1000:print]   load_universal_checkpoint .... False
[2024-05-31 14:26:47,843] [INFO] [config.py:1000:print]   loss_scale ................... 1.0
[2024-05-31 14:26:47,843] [INFO] [config.py:1000:print]   memory_breakdown ............. False
[2024-05-31 14:26:47,843] [INFO] [config.py:1000:print]   mics_hierarchial_params_gather  False
[2024-05-31 14:26:47,843] [INFO] [config.py:1000:print]   mics_shard_size .............. -1
[2024-05-31 14:26:47,843] [INFO] [config.py:1000:print]   monitor_config ............... tensorboard=TensorBoardConfig(enabled=False, output_path='', job_name='DeepSpeedJobName') wandb=WandbConfig(enabled=False, group=None, team=None, project='deepspeed') csv_monitor=CSVConfig(enabled=False, output_path='', job_name='DeepSpeedJobName') enabled=False
[2024-05-31 14:26:47,843] [INFO] [config.py:1000:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2024-05-31 14:26:47,843] [INFO] [config.py:1000:print]   optimizer_legacy_fusion ...... False
[2024-05-31 14:26:47,844] [INFO] [config.py:1000:print]   optimizer_name ............... None
[2024-05-31 14:26:47,844] [INFO] [config.py:1000:print]   optimizer_params ............. None
[2024-05-31 14:26:47,844] [INFO] [config.py:1000:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0, 'pipe_partitioned': True, 'grad_partitioned': True}
[2024-05-31 14:26:47,844] [INFO] [config.py:1000:print]   pld_enabled .................. False
[2024-05-31 14:26:47,844] [INFO] [config.py:1000:print]   pld_params ................... False
[2024-05-31 14:26:47,844] [INFO] [config.py:1000:print]   prescale_gradients ........... False
[2024-05-31 14:26:47,844] [INFO] [config.py:1000:print]   scheduler_name ............... None
[2024-05-31 14:26:47,844] [INFO] [config.py:1000:print]   scheduler_params ............. None
[2024-05-31 14:26:47,844] [INFO] [config.py:1000:print]   seq_parallel_communication_data_type  torch.float32
[2024-05-31 14:26:47,844] [INFO] [config.py:1000:print]   sparse_attention ............. None
[2024-05-31 14:26:47,844] [INFO] [config.py:1000:print]   sparse_gradients_enabled ..... False
[2024-05-31 14:26:47,844] [INFO] [config.py:1000:print]   steps_per_print .............. inf
[2024-05-31 14:26:47,844] [INFO] [config.py:1000:print]   train_batch_size ............. 2
[2024-05-31 14:26:47,844] [INFO] [config.py:1000:print]   train_micro_batch_size_per_gpu  2
[2024-05-31 14:26:47,844] [INFO] [config.py:1000:print]   use_data_before_expert_parallel_  False
[2024-05-31 14:26:47,844] [INFO] [config.py:1000:print]   use_node_local_storage ....... False
[2024-05-31 14:26:47,844] [INFO] [config.py:1000:print]   wall_clock_breakdown ......... False
[2024-05-31 14:26:47,844] [INFO] [config.py:1000:print]   weight_quantization_config ... None
[2024-05-31 14:26:47,844] [INFO] [config.py:1000:print]   world_size ................... 1
[2024-05-31 14:26:47,844] [INFO] [config.py:1000:print]   zero_allow_untested_optimizer  True
[2024-05-31 14:26:47,844] [INFO] [config.py:1000:print]   zero_config .................. stage=3 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 use_multi_rank_bucket_allreduce=True allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=True load_from_fp32_weights=True elastic_checkpoint=False offload_param=DeepSpeedZeroOffloadParamConfig(device='none', nvme_path=None, buffer_count=5, buffer_size=100,000,000, max_in_cpu=1,000,000,000, pin_memory=False) offload_optimizer=DeepSpeedZeroOffloadOptimizerConfig(device='none', nvme_path=None, buffer_count=4, pin_memory=False, pipeline=False, pipeline_read=False, pipeline_write=False, fast_init=False, ratio=1.0) sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False zero_hpz_partition_size=1 zero_quantized_weights=False zero_quantized_nontrainable_weights=False zero_quantized_gradients=False mics_shard_size=-1 mics_hierarchical_params_gather=False memory_efficient_linear=True pipeline_loading_checkpoint=False override_module_apply=True
[2024-05-31 14:26:47,844] [INFO] [config.py:1000:print]   zero_enabled ................. True
[2024-05-31 14:26:47,844] [INFO] [config.py:1000:print]   zero_force_ds_cpu_optimizer .. True
[2024-05-31 14:26:47,845] [INFO] [config.py:1000:print]   zero_optimization_stage ...... 3
[2024-05-31 14:26:47,845] [INFO] [config.py:986:print_user_config]   json = {
    "train_batch_size": 2, 
    "train_micro_batch_size_per_gpu": 2, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 3, 
        "offload_optimizer": {
            "device": "none", 
            "nvme_path": null
        }, 
        "offload_param": {
            "device": "none", 
            "nvme_path": null
        }, 
        "stage3_gather_16bit_weights_on_model_save": false
    }, 
    "gradient_clipping": 1.0, 
    "steps_per_print": inf, 
    "bf16": {
        "enabled": true
    }, 
    "fp16": {
        "enabled": false
    }, 
    "zero_allow_untested_optimizer": true
}
[INFO|trainer.py:2078] 2024-05-31 14:26:47,845 >> ***** Running training *****
[INFO|trainer.py:2079] 2024-05-31 14:26:47,845 >>   Num examples = 7,473
[INFO|trainer.py:2080] 2024-05-31 14:26:47,845 >>   Num Epochs = 5
[INFO|trainer.py:2081] 2024-05-31 14:26:47,845 >>   Instantaneous batch size per device = 2
[INFO|trainer.py:2084] 2024-05-31 14:26:47,845 >>   Total train batch size (w. parallel, distributed & accumulation) = 2
[INFO|trainer.py:2085] 2024-05-31 14:26:47,845 >>   Gradient Accumulation steps = 1
[INFO|trainer.py:2086] 2024-05-31 14:26:47,845 >>   Total optimization steps = 18,685
[INFO|trainer.py:2087] 2024-05-31 14:26:47,848 >>   Number of trainable parameters = 25,165,824
  0%|          | 0/18685 [00:00<?, ?it/s]  0%|          | 1/18685 [00:01<9:55:02,  1.91s/it]  0%|          | 2/18685 [00:06<18:13:54,  3.51s/it]  0%|          | 3/18685 [00:07<12:18:47,  2.37s/it]  0%|          | 4/18685 [00:08<9:32:21,  1.84s/it]   0%|          | 5/18685 [00:09<8:00:32,  1.54s/it]  0%|          | 6/18685 [00:10<7:06:06,  1.37s/it]  0%|          | 7/18685 [00:11<6:31:51,  1.26s/it]  0%|          | 8/18685 [00:12<6:08:08,  1.18s/it]  0%|          | 9/18685 [00:13<6:11:54,  1.19s/it]  0%|          | 10/18685 [00:14<5:55:16,  1.14s/it]  0%|          | 11/18685 [00:15<5:42:46,  1.10s/it]  0%|          | 12/18685 [00:16<5:35:03,  1.08s/it]  0%|          | 13/18685 [00:17<5:29:24,  1.06s/it]  0%|          | 14/18685 [00:18<5:25:57,  1.05s/it]  0%|          | 15/18685 [00:20<5:24:11,  1.04s/it]  0%|          | 16/18685 [00:21<5:21:57,  1.03s/it]  0%|          | 17/18685 [00:22<5:21:05,  1.03s/it]  0%|          | 18/18685 [00:23<5:19:53,  1.03s/it]  0%|          | 19/18685 [00:24<5:18:11,  1.02s/it]  0%|          | 20/18685 [00:25<5:17:34,  1.02s/it]                                                    {'loss': 1.0257, 'grad_norm': 2.5302324515968135, 'learning_rate': 2.675943270002676e-07, 'epoch': 0.01}
  0%|          | 20/18685 [00:25<5:17:34,  1.02s/it]  0%|          | 21/18685 [00:26<5:18:41,  1.02s/it]  0%|          | 22/18685 [00:27<5:17:45,  1.02s/it]  0%|          | 23/18685 [00:28<5:36:25,  1.08s/it]  0%|          | 24/18685 [00:29<5:31:01,  1.06s/it]  0%|          | 25/18685 [00:30<5:26:16,  1.05s/it]  0%|          | 26/18685 [00:31<5:23:53,  1.04s/it]  0%|          | 27/18685 [00:32<5:21:08,  1.03s/it]  0%|          | 28/18685 [00:33<5:19:16,  1.03s/it]  0%|          | 29/18685 [00:34<5:18:05,  1.02s/it]  0%|          | 30/18685 [00:35<5:17:36,  1.02s/it]  0%|          | 31/18685 [00:36<5:15:52,  1.02s/it]  0%|          | 32/18685 [00:37<5:15:32,  1.01s/it]  0%|          | 33/18685 [00:38<5:14:51,  1.01s/it]  0%|          | 34/18685 [00:39<5:14:54,  1.01s/it]  0%|          | 35/18685 [00:40<5:15:52,  1.02s/it]  0%|          | 36/18685 [00:41<5:16:31,  1.02s/it]  0%|          | 37/18685 [00:42<5:15:53,  1.02s/it]  0%|          | 38/18685 [00:43<5:34:53,  1.08s/it]  0%|          | 39/18685 [00:44<5:29:06,  1.06s/it]  0%|          | 40/18685 [00:45<5:24:42,  1.04s/it]                                                    {'loss': 0.9529, 'grad_norm': 2.1414786293197485, 'learning_rate': 5.351886540005352e-07, 'epoch': 0.01}
  0%|          | 40/18685 [00:45<5:24:42,  1.04s/it]  0%|          | 41/18685 [00:46<5:22:15,  1.04s/it]  0%|          | 42/18685 [00:47<5:16:15,  1.02s/it]  0%|          | 43/18685 [00:48<5:16:54,  1.02s/it]  0%|          | 44/18685 [00:49<5:17:16,  1.02s/it]  0%|          | 45/18685 [00:50<5:18:01,  1.02s/it]  0%|          | 46/18685 [00:51<5:17:19,  1.02s/it]  0%|          | 47/18685 [00:52<5:15:45,  1.02s/it]  0%|          | 48/18685 [00:53<5:14:31,  1.01s/it]  0%|          | 49/18685 [00:54<5:13:25,  1.01s/it]  0%|          | 50/18685 [00:55<5:12:47,  1.01s/it]  0%|          | 51/18685 [00:56<5:13:14,  1.01s/it]  0%|          | 52/18685 [00:58<5:31:52,  1.07s/it]  0%|          | 53/18685 [00:59<5:25:45,  1.05s/it]  0%|          | 54/18685 [01:00<5:22:49,  1.04s/it]  0%|          | 55/18685 [01:01<5:20:43,  1.03s/it]  0%|          | 56/18685 [01:02<5:18:36,  1.03s/it]  0%|          | 57/18685 [01:03<5:17:59,  1.02s/it]  0%|          | 58/18685 [01:04<5:16:47,  1.02s/it]  0%|          | 59/18685 [01:05<5:16:06,  1.02s/it]  0%|          | 60/18685 [01:06<5:15:21,  1.02s/it]                                                    {'loss': 0.9539, 'grad_norm': 2.9369581307582213, 'learning_rate': 8.027829810008028e-07, 'epoch': 0.02}
  0%|          | 60/18685 [01:06<5:15:21,  1.02s/it]  0%|          | 61/18685 [01:07<5:16:57,  1.02s/it]  0%|          | 62/18685 [01:08<5:16:14,  1.02s/it]  0%|          | 63/18685 [01:09<5:15:40,  1.02s/it]  0%|          | 64/18685 [01:10<5:15:14,  1.02s/it]  0%|          | 65/18685 [01:11<5:14:28,  1.01s/it]  0%|          | 66/18685 [01:12<5:13:51,  1.01s/it]  0%|          | 67/18685 [01:13<5:27:25,  1.06s/it]  0%|          | 68/18685 [01:14<5:23:22,  1.04s/it]  0%|          | 69/18685 [01:15<5:19:07,  1.03s/it]  0%|          | 70/18685 [01:16<5:17:33,  1.02s/it]  0%|          | 71/18685 [01:17<5:15:42,  1.02s/it]  0%|          | 72/18685 [01:18<5:15:27,  1.02s/it]  0%|          | 73/18685 [01:19<5:15:34,  1.02s/it]  0%|          | 74/18685 [01:20<5:14:45,  1.01s/it]  0%|          | 75/18685 [01:21<5:14:38,  1.01s/it]  0%|          | 76/18685 [01:22<5:13:37,  1.01s/it]  0%|          | 77/18685 [01:23<5:13:21,  1.01s/it]  0%|          | 78/18685 [01:24<5:12:42,  1.01s/it]  0%|          | 79/18685 [01:25<5:11:56,  1.01s/it]  0%|          | 80/18685 [01:26<5:12:07,  1.01s/it]                                                    {'loss': 1.0183, 'grad_norm': 2.5946584767023055, 'learning_rate': 1.0703773080010704e-06, 'epoch': 0.02}
  0%|          | 80/18685 [01:26<5:12:07,  1.01s/it]  0%|          | 81/18685 [01:27<5:29:36,  1.06s/it]  0%|          | 82/18685 [01:28<5:25:17,  1.05s/it]  0%|          | 83/18685 [01:29<5:21:40,  1.04s/it]  0%|          | 84/18685 [01:30<5:18:59,  1.03s/it]  0%|          | 85/18685 [01:31<5:17:23,  1.02s/it]  0%|          | 86/18685 [01:32<5:16:30,  1.02s/it]  0%|          | 87/18685 [01:33<5:16:00,  1.02s/it]  0%|          | 88/18685 [01:34<5:14:26,  1.01s/it]  0%|          | 89/18685 [01:35<5:13:32,  1.01s/it]  0%|          | 90/18685 [01:36<5:12:40,  1.01s/it]  0%|          | 91/18685 [01:37<5:11:25,  1.00s/it]  0%|          | 92/18685 [01:38<5:11:27,  1.01s/it]  0%|          | 93/18685 [01:39<5:11:50,  1.01s/it]  1%|          | 94/18685 [01:40<5:11:51,  1.01s/it]  1%|          | 95/18685 [01:41<5:11:34,  1.01s/it]  1%|          | 96/18685 [01:43<5:27:25,  1.06s/it]  1%|          | 97/18685 [01:44<5:21:58,  1.04s/it]  1%|          | 98/18685 [01:45<5:17:58,  1.03s/it]  1%|          | 99/18685 [01:46<5:15:09,  1.02s/it]  1%|          | 100/18685 [01:47<5:13:34,  1.01s/it]                                                     {'loss': 0.9821, 'grad_norm': 3.2341893566710804, 'learning_rate': 1.337971635001338e-06, 'epoch': 0.03}
  1%|          | 100/18685 [01:47<5:13:34,  1.01s/it][WARNING|trainer.py:3344] 2024-05-31 14:28:34,953 >>  stage3_gather_16bit_weights_on_model_save=false. Saving the full checkpoint instead, use zero_to_fp32.py to recover weights
[INFO|trainer.py:3410] 2024-05-31 14:28:34,954 >> Saving model checkpoint to ./checkpoint_dir/checkpoint-100
/opt/conda/lib/python3.10/site-packages/peft/utils/save_and_load.py:154: UserWarning: Could not find a config file in ./ - will assume that the vocabulary was not modified.
  warnings.warn(
[INFO|tokenization_utils_base.py:2513] 2024-05-31 14:28:34,994 >> tokenizer config file saved in ./checkpoint_dir/checkpoint-100/tokenizer_config.json
[INFO|tokenization_utils_base.py:2522] 2024-05-31 14:28:34,995 >> Special tokens file saved in ./checkpoint_dir/checkpoint-100/special_tokens_map.json
[2024-05-31 14:28:35,088] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step100 is about to be saved!
[2024-05-31 14:28:39,811] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-100/global_step100/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:28:39,811] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-100/global_step100/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:28:53,007] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-100/global_step100/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:28:53,313] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-100/global_step100/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:28:53,948] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-100/global_step100/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:28:53,972] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-100/global_step100/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:28:53,975] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step100 is ready now!
[2024-05-31 14:28:54,004] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step100 is about to be saved!
[2024-05-31 14:28:54,021] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-100/global_step100/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:28:54,021] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-100/global_step100/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:28:55,189] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-100/global_step100/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:28:55,189] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-100/global_step100/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:28:55,891] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-100/global_step100/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:28:55,893] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-100/global_step100/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:28:55,898] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step100 is ready now!
  1%|          | 101/18685 [02:09<37:42:56,  7.31s/it]  1%|          | 102/18685 [02:10<27:57:43,  5.42s/it]  1%|          | 103/18685 [02:11<21:08:21,  4.10s/it]  1%|          | 104/18685 [02:12<16:21:19,  3.17s/it]  1%|          | 105/18685 [02:13<12:59:21,  2.52s/it]  1%|          | 106/18685 [02:14<10:37:36,  2.06s/it]  1%|          | 107/18685 [02:15<8:58:38,  1.74s/it]   1%|          | 108/18685 [02:16<7:49:32,  1.52s/it]  1%|          | 109/18685 [02:17<7:01:33,  1.36s/it]  1%|          | 110/18685 [02:18<6:47:16,  1.32s/it]  1%|          | 111/18685 [02:19<6:18:18,  1.22s/it]  1%|          | 112/18685 [02:20<5:58:28,  1.16s/it]  1%|          | 113/18685 [02:21<5:43:47,  1.11s/it]  1%|          | 114/18685 [02:22<5:33:38,  1.08s/it]  1%|          | 115/18685 [02:23<5:26:09,  1.05s/it]  1%|          | 116/18685 [02:24<5:21:50,  1.04s/it]  1%|          | 117/18685 [02:25<5:18:06,  1.03s/it]  1%|          | 118/18685 [02:26<5:15:27,  1.02s/it]  1%|          | 119/18685 [02:27<5:12:58,  1.01s/it]  1%|          | 120/18685 [02:28<5:12:01,  1.01s/it]                                                     {'loss': 0.9549, 'grad_norm': 1.3596347463974272, 'learning_rate': 1.6055659620016057e-06, 'epoch': 0.03}
  1%|          | 120/18685 [02:28<5:12:01,  1.01s/it]  1%|          | 121/18685 [02:29<5:12:38,  1.01s/it]  1%|          | 122/18685 [02:30<5:11:40,  1.01s/it]  1%|          | 123/18685 [02:31<5:13:01,  1.01s/it]  1%|          | 124/18685 [02:32<5:28:28,  1.06s/it]  1%|          | 125/18685 [02:33<5:23:45,  1.05s/it]  1%|          | 126/18685 [02:34<5:22:06,  1.04s/it]  1%|          | 127/18685 [02:35<5:18:05,  1.03s/it]  1%|          | 128/18685 [02:36<5:14:44,  1.02s/it]  1%|          | 129/18685 [02:37<5:12:53,  1.01s/it]  1%|          | 130/18685 [02:38<5:11:19,  1.01s/it]  1%|          | 131/18685 [02:39<5:10:27,  1.00s/it]  1%|          | 132/18685 [02:40<5:09:31,  1.00s/it]  1%|          | 133/18685 [02:41<5:09:45,  1.00s/it]  1%|          | 134/18685 [02:42<5:09:29,  1.00s/it]  1%|          | 135/18685 [02:43<5:09:53,  1.00s/it]  1%|          | 136/18685 [02:44<5:09:54,  1.00s/it]  1%|          | 137/18685 [02:45<5:09:36,  1.00s/it]  1%|          | 138/18685 [02:46<5:10:06,  1.00s/it]  1%|          | 139/18685 [02:47<5:26:06,  1.06s/it]  1%|          | 140/18685 [02:48<5:21:32,  1.04s/it]                                                     {'loss': 0.8715, 'grad_norm': 1.8449731006508885, 'learning_rate': 1.8731602890018734e-06, 'epoch': 0.04}
  1%|          | 140/18685 [02:48<5:21:32,  1.04s/it]  1%|          | 141/18685 [02:49<5:19:34,  1.03s/it]  1%|          | 142/18685 [02:50<5:17:32,  1.03s/it]  1%|          | 143/18685 [02:51<5:17:03,  1.03s/it]  1%|          | 144/18685 [02:52<5:16:47,  1.03s/it]  1%|          | 145/18685 [02:53<5:15:53,  1.02s/it]  1%|          | 146/18685 [02:54<5:14:43,  1.02s/it]  1%|          | 147/18685 [02:55<5:13:24,  1.01s/it]  1%|          | 148/18685 [02:56<5:11:57,  1.01s/it]  1%|          | 149/18685 [02:57<5:10:49,  1.01s/it]  1%|          | 150/18685 [02:58<5:10:19,  1.00s/it]  1%|          | 151/18685 [02:59<5:10:48,  1.01s/it]  1%|          | 152/18685 [03:00<5:10:21,  1.00s/it]  1%|          | 153/18685 [03:01<5:09:55,  1.00s/it]  1%|          | 154/18685 [03:03<5:26:58,  1.06s/it]  1%|          | 155/18685 [03:04<5:21:30,  1.04s/it]  1%|          | 156/18685 [03:05<5:17:39,  1.03s/it]  1%|          | 157/18685 [03:06<5:15:06,  1.02s/it]  1%|          | 158/18685 [03:07<5:13:04,  1.01s/it]  1%|          | 159/18685 [03:08<5:12:20,  1.01s/it]  1%|          | 160/18685 [03:09<5:11:44,  1.01s/it]                                                     {'loss': 0.8715, 'grad_norm': 1.6976944799922462, 'learning_rate': 2.140754616002141e-06, 'epoch': 0.04}
  1%|          | 160/18685 [03:09<5:11:44,  1.01s/it]  1%|          | 161/18685 [03:10<5:13:30,  1.02s/it]  1%|          | 162/18685 [03:11<5:12:46,  1.01s/it]  1%|          | 163/18685 [03:12<5:11:58,  1.01s/it]  1%|          | 164/18685 [03:13<5:11:31,  1.01s/it]  1%|          | 165/18685 [03:14<5:10:32,  1.01s/it]  1%|          | 166/18685 [03:15<5:10:09,  1.00s/it]  1%|          | 167/18685 [03:16<5:10:20,  1.01s/it]  1%|          | 168/18685 [03:17<5:26:38,  1.06s/it]  1%|          | 169/18685 [03:18<5:21:59,  1.04s/it]  1%|          | 170/18685 [03:19<5:19:02,  1.03s/it]  1%|          | 171/18685 [03:20<5:16:35,  1.03s/it]  1%|          | 172/18685 [03:21<5:14:49,  1.02s/it]  1%|          | 173/18685 [03:22<5:15:19,  1.02s/it]  1%|          | 174/18685 [03:23<5:14:11,  1.02s/it]  1%|          | 175/18685 [03:24<5:12:15,  1.01s/it]  1%|          | 176/18685 [03:25<5:11:39,  1.01s/it]  1%|          | 177/18685 [03:26<5:10:20,  1.01s/it]  1%|          | 178/18685 [03:27<5:09:45,  1.00s/it]  1%|          | 179/18685 [03:28<5:09:20,  1.00s/it]  1%|          | 180/18685 [03:29<5:08:45,  1.00s/it]                                                     {'loss': 0.8008, 'grad_norm': 2.1529528811726344, 'learning_rate': 2.408348943002408e-06, 'epoch': 0.05}
  1%|          | 180/18685 [03:29<5:08:45,  1.00s/it]  1%|          | 181/18685 [03:30<5:08:30,  1.00s/it]  1%|          | 182/18685 [03:31<5:09:22,  1.00s/it]  1%|          | 183/18685 [03:32<5:25:01,  1.05s/it]  1%|          | 184/18685 [03:33<5:20:34,  1.04s/it]  1%|          | 185/18685 [03:34<5:17:05,  1.03s/it]  1%|          | 186/18685 [03:35<5:14:39,  1.02s/it]  1%|          | 187/18685 [03:36<5:12:16,  1.01s/it]  1%|          | 188/18685 [03:37<5:11:29,  1.01s/it]  1%|          | 189/18685 [03:38<5:10:42,  1.01s/it]  1%|          | 190/18685 [03:39<5:10:39,  1.01s/it]  1%|          | 191/18685 [03:40<5:09:28,  1.00s/it]  1%|          | 192/18685 [03:41<5:08:59,  1.00s/it]  1%|          | 193/18685 [03:42<5:09:08,  1.00s/it]  1%|          | 194/18685 [03:43<5:09:44,  1.01s/it]  1%|          | 195/18685 [03:44<5:09:33,  1.00s/it]  1%|          | 196/18685 [03:45<5:09:24,  1.00s/it]  1%|          | 197/18685 [03:46<5:09:21,  1.00s/it]  1%|          | 198/18685 [03:47<5:24:17,  1.05s/it]  1%|          | 199/18685 [03:48<5:20:10,  1.04s/it]  1%|          | 200/18685 [03:49<5:17:36,  1.03s/it]                                                     {'loss': 0.727, 'grad_norm': 1.6466977438673271, 'learning_rate': 2.675943270002676e-06, 'epoch': 0.05}
  1%|          | 200/18685 [03:49<5:17:36,  1.03s/it][WARNING|trainer.py:3344] 2024-05-31 14:30:37,625 >>  stage3_gather_16bit_weights_on_model_save=false. Saving the full checkpoint instead, use zero_to_fp32.py to recover weights
[INFO|trainer.py:3410] 2024-05-31 14:30:37,626 >> Saving model checkpoint to ./checkpoint_dir/checkpoint-200
/opt/conda/lib/python3.10/site-packages/peft/utils/save_and_load.py:154: UserWarning: Could not find a config file in ./ - will assume that the vocabulary was not modified.
  warnings.warn(
[INFO|tokenization_utils_base.py:2513] 2024-05-31 14:30:37,646 >> tokenizer config file saved in ./checkpoint_dir/checkpoint-200/tokenizer_config.json
[INFO|tokenization_utils_base.py:2522] 2024-05-31 14:30:37,647 >> Special tokens file saved in ./checkpoint_dir/checkpoint-200/special_tokens_map.json
[2024-05-31 14:30:37,704] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step200 is about to be saved!
[2024-05-31 14:30:41,860] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-200/global_step200/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:30:41,860] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-200/global_step200/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:30:53,586] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-200/global_step200/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:30:53,889] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-200/global_step200/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:30:54,482] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-200/global_step200/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:30:54,503] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-200/global_step200/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:30:54,506] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step200 is ready now!
[2024-05-31 14:30:54,535] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step200 is about to be saved!
[2024-05-31 14:30:54,552] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-200/global_step200/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:30:54,552] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-200/global_step200/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:30:55,768] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-200/global_step200/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:30:55,769] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-200/global_step200/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:30:56,459] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-200/global_step200/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:30:56,462] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-200/global_step200/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:30:56,469] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step200 is ready now!
[INFO|trainer.py:3502] 2024-05-31 14:30:56,475 >> Deleting older checkpoint [checkpoint_dir/checkpoint-100] due to args.save_total_limit
  1%|          | 201/18685 [04:09<34:22:07,  6.69s/it]  1%|          | 202/18685 [04:10<25:36:38,  4.99s/it]  1%|          | 203/18685 [04:11<19:29:06,  3.80s/it]  1%|          | 204/18685 [04:12<15:13:53,  2.97s/it]  1%|          | 205/18685 [04:13<12:12:30,  2.38s/it]  1%|          | 206/18685 [04:14<10:05:14,  1.97s/it]  1%|          | 207/18685 [04:15<8:38:13,  1.68s/it]   1%|          | 208/18685 [04:16<7:35:27,  1.48s/it]  1%|          | 209/18685 [04:17<6:51:09,  1.34s/it]  1%|          | 210/18685 [04:18<6:21:03,  1.24s/it]  1%|          | 211/18685 [04:19<5:58:59,  1.17s/it]  1%|          | 212/18685 [04:20<6:03:44,  1.18s/it]  1%|          | 213/18685 [04:21<5:47:29,  1.13s/it]  1%|          | 214/18685 [04:22<5:36:09,  1.09s/it]  1%|          | 215/18685 [04:24<5:28:55,  1.07s/it]  1%|          | 216/18685 [04:25<5:23:23,  1.05s/it]  1%|          | 217/18685 [04:26<5:19:02,  1.04s/it]  1%|          | 218/18685 [04:27<5:16:27,  1.03s/it]  1%|          | 219/18685 [04:28<5:14:07,  1.02s/it]  1%|          | 220/18685 [04:29<5:14:36,  1.02s/it]                                                     {'loss': 0.718, 'grad_norm': 1.2374796406305733, 'learning_rate': 2.9435375970029436e-06, 'epoch': 0.06}
  1%|          | 220/18685 [04:29<5:14:36,  1.02s/it]  1%|          | 221/18685 [04:30<5:14:06,  1.02s/it]  1%|          | 222/18685 [04:31<5:12:48,  1.02s/it]  1%|          | 223/18685 [04:32<5:12:07,  1.01s/it]  1%|          | 224/18685 [04:33<5:10:48,  1.01s/it]  1%|          | 225/18685 [04:34<5:10:37,  1.01s/it]  1%|          | 226/18685 [04:35<5:09:44,  1.01s/it]  1%|          | 227/18685 [04:36<5:27:38,  1.07s/it]  1%|          | 228/18685 [04:37<5:21:33,  1.05s/it]  1%|          | 229/18685 [04:38<5:17:50,  1.03s/it]  1%|          | 230/18685 [04:39<5:15:21,  1.03s/it]  1%|          | 231/18685 [04:40<5:12:06,  1.01s/it]  1%|          | 232/18685 [04:41<5:10:14,  1.01s/it]  1%|          | 233/18685 [04:42<5:08:23,  1.00s/it]  1%|▏         | 234/18685 [04:43<5:06:35,  1.00it/s]  1%|▏         | 235/18685 [04:44<5:05:40,  1.01it/s]  1%|▏         | 236/18685 [04:45<5:05:08,  1.01it/s]  1%|▏         | 237/18685 [04:46<5:05:18,  1.01it/s]  1%|▏         | 238/18685 [04:47<5:04:48,  1.01it/s]  1%|▏         | 239/18685 [04:48<5:05:33,  1.01it/s]  1%|▏         | 240/18685 [04:49<5:05:24,  1.01it/s]                                                     {'loss': 0.6315, 'grad_norm': 1.3877518847915504, 'learning_rate': 3.2111319240032113e-06, 'epoch': 0.06}
  1%|▏         | 240/18685 [04:49<5:05:24,  1.01it/s]  1%|▏         | 241/18685 [04:50<5:21:33,  1.05s/it]  1%|▏         | 242/18685 [04:51<5:16:00,  1.03s/it]  1%|▏         | 243/18685 [04:52<5:12:40,  1.02s/it]  1%|▏         | 244/18685 [04:53<5:11:39,  1.01s/it]  1%|▏         | 245/18685 [04:54<5:10:13,  1.01s/it]  1%|▏         | 246/18685 [04:55<5:09:19,  1.01s/it]  1%|▏         | 247/18685 [04:56<5:09:37,  1.01s/it]  1%|▏         | 248/18685 [04:57<5:09:04,  1.01s/it]  1%|▏         | 249/18685 [04:58<5:09:12,  1.01s/it]  1%|▏         | 250/18685 [04:59<5:08:26,  1.00s/it]  1%|▏         | 251/18685 [05:00<5:07:57,  1.00s/it]  1%|▏         | 252/18685 [05:01<5:07:51,  1.00s/it]  1%|▏         | 253/18685 [05:02<5:07:43,  1.00s/it]  1%|▏         | 254/18685 [05:03<5:06:59,  1.00it/s]  1%|▏         | 255/18685 [05:04<5:07:24,  1.00s/it]  1%|▏         | 256/18685 [05:05<5:23:36,  1.05s/it]  1%|▏         | 257/18685 [05:06<5:18:38,  1.04s/it]  1%|▏         | 258/18685 [05:07<5:14:27,  1.02s/it]  1%|▏         | 259/18685 [05:08<5:12:38,  1.02s/it]  1%|▏         | 260/18685 [05:09<5:11:36,  1.01s/it]                                                     {'loss': 0.5615, 'grad_norm': 2.2541945195725748, 'learning_rate': 3.4787262510034786e-06, 'epoch': 0.07}
  1%|▏         | 260/18685 [05:09<5:11:36,  1.01s/it]  1%|▏         | 261/18685 [05:10<5:11:52,  1.02s/it]  1%|▏         | 262/18685 [05:11<5:10:27,  1.01s/it]  1%|▏         | 263/18685 [05:12<5:10:20,  1.01s/it]  1%|▏         | 264/18685 [05:13<5:09:12,  1.01s/it]  1%|▏         | 265/18685 [05:14<5:07:49,  1.00s/it]  1%|▏         | 266/18685 [05:15<5:07:36,  1.00s/it]  1%|▏         | 267/18685 [05:16<5:07:43,  1.00s/it]  1%|▏         | 268/18685 [05:17<5:07:54,  1.00s/it]  1%|▏         | 269/18685 [05:18<5:07:25,  1.00s/it]  1%|▏         | 270/18685 [05:19<5:06:33,  1.00it/s]  1%|▏         | 271/18685 [05:20<5:23:07,  1.05s/it]  1%|▏         | 272/18685 [05:21<5:17:58,  1.04s/it]  1%|▏         | 273/18685 [05:22<5:13:56,  1.02s/it]  1%|▏         | 274/18685 [05:23<5:11:26,  1.01s/it]  1%|▏         | 275/18685 [05:24<5:09:25,  1.01s/it]  1%|▏         | 276/18685 [05:25<5:07:57,  1.00s/it]  1%|▏         | 277/18685 [05:26<5:06:53,  1.00s/it]  1%|▏         | 278/18685 [05:27<5:07:25,  1.00s/it]  1%|▏         | 279/18685 [05:28<5:07:32,  1.00s/it]  1%|▏         | 280/18685 [05:29<5:07:13,  1.00s/it]                                                     {'loss': 0.5017, 'grad_norm': 1.4668782724822398, 'learning_rate': 3.7463205780037468e-06, 'epoch': 0.07}
  1%|▏         | 280/18685 [05:29<5:07:13,  1.00s/it]  2%|▏         | 281/18685 [05:30<5:06:34,  1.00it/s]  2%|▏         | 282/18685 [05:31<5:06:18,  1.00it/s]  2%|▏         | 283/18685 [05:32<5:05:58,  1.00it/s]  2%|▏         | 284/18685 [05:33<5:05:43,  1.00it/s]  2%|▏         | 285/18685 [05:34<5:05:19,  1.00it/s]  2%|▏         | 286/18685 [05:35<5:19:34,  1.04s/it]  2%|▏         | 287/18685 [05:36<5:15:46,  1.03s/it]  2%|▏         | 288/18685 [05:37<5:11:57,  1.02s/it]  2%|▏         | 289/18685 [05:38<5:10:34,  1.01s/it]  2%|▏         | 290/18685 [05:39<5:10:12,  1.01s/it]  2%|▏         | 291/18685 [05:40<5:09:10,  1.01s/it]  2%|▏         | 292/18685 [05:41<5:08:56,  1.01s/it]  2%|▏         | 293/18685 [05:42<5:07:50,  1.00s/it]  2%|▏         | 294/18685 [05:43<5:06:30,  1.00it/s]  2%|▏         | 295/18685 [05:44<5:05:56,  1.00it/s]  2%|▏         | 296/18685 [05:45<5:05:17,  1.00it/s]  2%|▏         | 297/18685 [05:46<5:04:30,  1.01it/s]  2%|▏         | 298/18685 [05:47<5:02:56,  1.01it/s]  2%|▏         | 299/18685 [05:48<5:03:20,  1.01it/s]  2%|▏         | 300/18685 [05:49<5:20:47,  1.05s/it]                                                     {'loss': 0.4323, 'grad_norm': 1.0891931686797802, 'learning_rate': 4.013914905004014e-06, 'epoch': 0.08}
  2%|▏         | 300/18685 [05:49<5:20:47,  1.05s/it][WARNING|trainer.py:3344] 2024-05-31 14:32:37,846 >>  stage3_gather_16bit_weights_on_model_save=false. Saving the full checkpoint instead, use zero_to_fp32.py to recover weights
[INFO|trainer.py:3410] 2024-05-31 14:32:37,846 >> Saving model checkpoint to ./checkpoint_dir/checkpoint-300
/opt/conda/lib/python3.10/site-packages/peft/utils/save_and_load.py:154: UserWarning: Could not find a config file in ./ - will assume that the vocabulary was not modified.
  warnings.warn(
[INFO|tokenization_utils_base.py:2513] 2024-05-31 14:32:37,865 >> tokenizer config file saved in ./checkpoint_dir/checkpoint-300/tokenizer_config.json
[INFO|tokenization_utils_base.py:2522] 2024-05-31 14:32:37,866 >> Special tokens file saved in ./checkpoint_dir/checkpoint-300/special_tokens_map.json
[2024-05-31 14:32:37,923] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step300 is about to be saved!
[2024-05-31 14:32:42,036] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-300/global_step300/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:32:42,037] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-300/global_step300/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:32:53,661] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-300/global_step300/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:32:53,977] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-300/global_step300/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:32:54,625] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-300/global_step300/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:32:54,626] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-300/global_step300/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:32:54,633] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step300 is ready now!
[2024-05-31 14:32:54,661] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step300 is about to be saved!
[2024-05-31 14:32:54,678] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-300/global_step300/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:32:54,678] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-300/global_step300/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:32:55,890] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-300/global_step300/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:32:55,891] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-300/global_step300/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:32:56,722] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-300/global_step300/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:32:56,724] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-300/global_step300/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:32:56,730] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step300 is ready now!
[INFO|trainer.py:3502] 2024-05-31 14:32:56,736 >> Deleting older checkpoint [checkpoint_dir/checkpoint-200] due to args.save_total_limit
  2%|▏         | 301/18685 [06:09<34:19:36,  6.72s/it]  2%|▏         | 302/18685 [06:10<25:32:58,  5.00s/it]  2%|▏         | 303/18685 [06:11<19:26:21,  3.81s/it]  2%|▏         | 304/18685 [06:12<15:08:48,  2.97s/it]  2%|▏         | 305/18685 [06:13<12:09:02,  2.38s/it]  2%|▏         | 306/18685 [06:14<10:03:43,  1.97s/it]  2%|▏         | 307/18685 [06:15<8:34:50,  1.68s/it]   2%|▏         | 308/18685 [06:16<7:32:00,  1.48s/it]  2%|▏         | 309/18685 [06:17<6:48:16,  1.33s/it]  2%|▏         | 310/18685 [06:18<6:18:10,  1.23s/it]  2%|▏         | 311/18685 [06:19<5:56:50,  1.17s/it]  2%|▏         | 312/18685 [06:20<5:40:49,  1.11s/it]  2%|▏         | 313/18685 [06:21<5:30:48,  1.08s/it]  2%|▏         | 314/18685 [06:23<5:41:02,  1.11s/it]  2%|▏         | 315/18685 [06:24<5:30:31,  1.08s/it]  2%|▏         | 316/18685 [06:25<5:23:08,  1.06s/it]  2%|▏         | 317/18685 [06:26<5:19:04,  1.04s/it]  2%|▏         | 318/18685 [06:27<5:14:14,  1.03s/it]  2%|▏         | 319/18685 [06:28<5:10:43,  1.02s/it]  2%|▏         | 320/18685 [06:29<5:09:30,  1.01s/it]                                                     {'loss': 0.4403, 'grad_norm': 1.7885723630224257, 'learning_rate': 4.281509232004282e-06, 'epoch': 0.09}
  2%|▏         | 320/18685 [06:29<5:09:30,  1.01s/it]  2%|▏         | 321/18685 [06:30<5:08:41,  1.01s/it]  2%|▏         | 322/18685 [06:31<5:07:47,  1.01s/it]  2%|▏         | 323/18685 [06:32<5:07:14,  1.00s/it]  2%|▏         | 324/18685 [06:33<5:07:00,  1.00s/it]  2%|▏         | 325/18685 [06:34<5:06:08,  1.00s/it]  2%|▏         | 326/18685 [06:35<5:05:19,  1.00it/s]  2%|▏         | 327/18685 [06:36<5:04:25,  1.01it/s]  2%|▏         | 328/18685 [06:37<5:21:26,  1.05s/it]  2%|▏         | 329/18685 [06:38<5:15:33,  1.03s/it]  2%|▏         | 330/18685 [06:39<5:11:41,  1.02s/it]  2%|▏         | 331/18685 [06:40<5:05:09,  1.00it/s]  2%|▏         | 332/18685 [06:41<5:03:56,  1.01it/s]  2%|▏         | 333/18685 [06:42<5:04:04,  1.01it/s]  2%|▏         | 334/18685 [06:43<5:04:15,  1.01it/s]  2%|▏         | 335/18685 [06:44<5:04:26,  1.00it/s]  2%|▏         | 336/18685 [06:45<5:04:45,  1.00it/s]  2%|▏         | 337/18685 [06:46<5:04:39,  1.00it/s]  2%|▏         | 338/18685 [06:47<5:04:19,  1.00it/s]  2%|▏         | 339/18685 [06:48<5:04:28,  1.00it/s]  2%|▏         | 340/18685 [06:49<5:05:26,  1.00it/s]                                                     {'loss': 0.3736, 'grad_norm': 2.5844826797921088, 'learning_rate': 4.5491035590045495e-06, 'epoch': 0.09}
  2%|▏         | 340/18685 [06:49<5:05:26,  1.00it/s]  2%|▏         | 341/18685 [06:50<5:06:31,  1.00s/it]W0531 14:33:38.169000 140438309713088 torch/distributed/elastic/agent/server/api.py:741] Received Signals.SIGINT death signal, shutting down workers
W0531 14:33:38.170000 140438309713088 torch/distributed/elastic/multiprocessing/api.py:851] Sending process 189680 closing signal SIGINT
[rank0]: Traceback (most recent call last):
[rank0]:   File "/root/Phi-3-mini-4k-instruct/sample_finetune.py", line 315, in <module>
[rank0]:     packing=False
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/trl/trainer/sft_trainer.py", line 361, in train
[rank0]:     output = super().train(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/transformers/trainer.py", line 1885, in train
[rank0]:     return inner_training_loop(
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/transformers/trainer.py", line 2216, in _inner_training_loop
[rank0]:     tr_loss_step = self.training_step(model, inputs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/transformers/trainer.py", line 3238, in training_step
[rank0]:     loss = self.compute_loss(model, inputs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/transformers/trainer.py", line 3264, in compute_loss
[rank0]:     outputs = model(**inputs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1541, in _call_impl
[rank0]:     return forward_call(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
[rank0]:     ret_val = func(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/runtime/engine.py", line 1855, in forward
[rank0]:     loss = self.module(*inputs, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1582, in _call_impl
[rank0]:     result = forward_call(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/peft/peft_model.py", line 1091, in forward
[rank0]:     return self.base_model(
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1582, in _call_impl
[rank0]:     result = forward_call(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/peft/tuners/tuners_utils.py", line 160, in forward
[rank0]:     return self.model.forward(*args, **kwargs)
[rank0]:   File "/root/.cache/huggingface/modules/transformers_modules/modeling_phi3.py", line 1286, in forward
[rank0]:     outputs = self.model(
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1582, in _call_impl
[rank0]:     result = forward_call(*args, **kwargs)
[rank0]:   File "/root/.cache/huggingface/modules/transformers_modules/modeling_phi3.py", line 1154, in forward
[rank0]:     layer_outputs = self._gradient_checkpointing_func(
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/_compile.py", line 24, in inner
[rank0]:     return torch._dynamo.disable(fn, recursive)(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 451, in _fn
[rank0]:     return fn(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/_dynamo/external_utils.py", line 36, in inner
[rank0]:     return fn(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/utils/checkpoint.py", line 494, in checkpoint
[rank0]:     ret = function(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1582, in _call_impl
[rank0]:     result = forward_call(*args, **kwargs)
[rank0]:   File "/root/.cache/huggingface/modules/transformers_modules/modeling_phi3.py", line 898, in forward
[rank0]:     hidden_states = self.mlp(hidden_states)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1582, in _call_impl
[rank0]:     result = forward_call(*args, **kwargs)
[rank0]:   File "/root/.cache/huggingface/modules/transformers_modules/modeling_phi3.py", line 271, in forward
[rank0]:     up_states = self.gate_up_proj(hidden_states)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1582, in _call_impl
[rank0]:     result = forward_call(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/peft/tuners/lora/layer.py", line 437, in forward
[rank0]:     result = result + lora_B(lora_A(dropout(x))) * scaling
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
[rank0]:     return self._call_impl(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1571, in _call_impl
[rank0]:     args_result = hook(self, args)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
[rank0]:     ret_val = func(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/runtime/zero/parameter_offload.py", line 278, in _pre_forward_module_hook
[rank0]:     self.pre_sub_module_forward_function(module)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
[rank0]:     return func(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/runtime/zero/parameter_offload.py", line 452, in pre_sub_module_forward_function
[rank0]:     param_coordinator.fetch_sub_module(sub_module, forward=True)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 451, in _fn
[rank0]:     return fn(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
[rank0]:     ret_val = func(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
[rank0]:     return func(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/runtime/zero/partitioned_param_coordinator.py", line 318, in fetch_sub_module
[rank0]:     get_accelerator().current_stream().wait_stream(self.__allgather_stream)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/accelerator/cuda_accelerator.py", line 116, in current_stream
[rank0]:     return torch.cuda.current_stream(device_index)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/cuda/__init__.py", line 817, in current_stream
[rank0]:     _lazy_init()
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/cuda/__init__.py", line 265, in _lazy_init
[rank0]:     if is_initialized() or hasattr(_tls, "is_initializing"):
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/cuda/__init__.py", line 218, in is_initialized
[rank0]:     return _initialized and not _is_in_bad_fork()
[rank0]: KeyboardInterrupt
  2%|▏         | 341/18685 [06:50<6:08:13,  1.20s/it]
Warning: The default cache directory for DeepSpeed Triton autotune, /root/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
[93m [WARNING] [0m async_io requires the dev libaio .so object and headers but these were not found.
[93m [WARNING] [0m async_io: please install the libaio-dev package with apt
[93m [WARNING] [0m If libaio is already installed (perhaps from source), try setting the CFLAGS and LDFLAGS environment variables to where it can be found.
[93m [WARNING] [0m Please specify the CUTLASS repo directory as environment variable $CUTLASS_PATH
[93m [WARNING] [0m sparse_attn requires a torch version >= 1.5 and < 2.0 but detected 2.3
[93m [WARNING] [0m using untested triton version (2.3.0), only 1.0.0 is known to be compatible
Traceback (most recent call last):
  File "/opt/conda/bin/accelerate", line 8, in <module>
    sys.exit(main())
  File "/opt/conda/lib/python3.10/site-packages/accelerate/commands/accelerate_cli.py", line 46, in main
    args.func(args)
  File "/opt/conda/lib/python3.10/site-packages/accelerate/commands/launch.py", line 1067, in launch_command
    deepspeed_launcher(args)
  File "/opt/conda/lib/python3.10/site-packages/accelerate/commands/launch.py", line 771, in deepspeed_launcher
    distrib_run.run(args)
  File "/opt/conda/lib/python3.10/site-packages/torch/distributed/run.py", line 870, in run
    elastic_launch(
  File "/opt/conda/lib/python3.10/site-packages/torch/distributed/launcher/api.py", line 132, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/opt/conda/lib/python3.10/site-packages/torch/distributed/launcher/api.py", line 254, in launch_agent
    result = agent.run()
  File "/opt/conda/lib/python3.10/site-packages/torch/distributed/elastic/metrics/api.py", line 123, in wrapper
    result = f(*args, **kwargs)
  File "/opt/conda/lib/python3.10/site-packages/torch/distributed/elastic/agent/server/api.py", line 733, in run
    result = self._invoke_run(role)
  File "/opt/conda/lib/python3.10/site-packages/torch/distributed/elastic/agent/server/api.py", line 876, in _invoke_run
    time.sleep(monitor_interval)
  File "/opt/conda/lib/python3.10/site-packages/torch/distributed/elastic/multiprocessing/api.py", line 76, in _terminate_process_handler
    raise SignalException(f"Process {os.getpid()} got signal: {sigval}", sigval=sigval)
torch.distributed.elastic.multiprocessing.api.SignalException: Process 189635 got signal: 2
/opt/conda/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/opt/conda/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
[2024-05-31 14:34:03,148] [INFO] [real_accelerator.py:203:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2024-05-31 14:34:07,898] [INFO] [real_accelerator.py:203:get_accelerator] Setting ds_accelerator to cuda (auto detect)
Warning: The default cache directory for DeepSpeed Triton autotune, /root/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
[93m [WARNING] [0m async_io requires the dev libaio .so object and headers but these were not found.
[93m [WARNING] [0m async_io: please install the libaio-dev package with apt
[93m [WARNING] [0m If libaio is already installed (perhaps from source), try setting the CFLAGS and LDFLAGS environment variables to where it can be found.
[93m [WARNING] [0m Please specify the CUTLASS repo directory as environment variable $CUTLASS_PATH
[93m [WARNING] [0m sparse_attn requires a torch version >= 1.5 and < 2.0 but detected 2.3
[93m [WARNING] [0m using untested triton version (2.3.0), only 1.0.0 is known to be compatible
[2024-05-31 14:34:08,664] [INFO] [comm.py:637:init_distributed] cdb=None
[2024-05-31 14:34:08,664] [INFO] [comm.py:668:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
2024-05-31 14:34:08 - WARNING - __main__ - Process rank: 0, device: cuda:0, n_gpu: 1 distributed training: True, 16-bits training: False
2024-05-31 14:34:08 - INFO - __main__ - Training/evaluation parameters TrainingArguments(
_n_gpu=1,
accelerator_config={'split_batches': False, 'dispatch_batches': None, 'even_batches': True, 'use_seedable_sampler': True, 'non_blocking': False, 'gradient_accumulation_kwargs': None},
adafactor=False,
adam_beta1=0.9,
adam_beta2=0.999,
adam_epsilon=1e-08,
auto_find_batch_size=False,
batch_eval_metrics=False,
bf16=True,
bf16_full_eval=False,
data_seed=None,
dataloader_drop_last=False,
dataloader_num_workers=0,
dataloader_persistent_workers=False,
dataloader_pin_memory=True,
dataloader_prefetch_factor=None,
ddp_backend=None,
ddp_broadcast_buffers=None,
ddp_bucket_cap_mb=None,
ddp_find_unused_parameters=None,
ddp_timeout=1800,
debug=[],
deepspeed=None,
disable_tqdm=False,
dispatch_batches=None,
do_eval=False,
do_predict=False,
do_train=False,
eval_accumulation_steps=None,
eval_delay=0,
eval_do_concat_batches=True,
eval_steps=None,
eval_strategy=no,
evaluation_strategy=None,
fp16=False,
fp16_backend=auto,
fp16_full_eval=False,
fp16_opt_level=O1,
fsdp=[],
fsdp_config={'min_num_params': 0, 'xla': False, 'xla_fsdp_v2': False, 'xla_fsdp_grad_ckpt': False},
fsdp_min_num_params=0,
fsdp_transformer_layer_cls_to_wrap=None,
full_determinism=False,
gradient_accumulation_steps=1,
gradient_checkpointing=True,
gradient_checkpointing_kwargs={'use_reentrant': False},
greater_is_better=None,
group_by_length=False,
half_precision_backend=auto,
hub_always_push=False,
hub_model_id=None,
hub_private_repo=False,
hub_strategy=every_save,
hub_token=<HUB_TOKEN>,
ignore_data_skip=False,
include_inputs_for_metrics=False,
include_num_input_tokens_seen=False,
include_tokens_per_second=False,
jit_mode_eval=False,
label_names=None,
label_smoothing_factor=0.0,
learning_rate=5e-05,
length_column_name=length,
load_best_model_at_end=False,
local_rank=0,
log_level=info,
log_level_replica=warning,
log_on_each_node=True,
logging_dir=./checkpoint_dir/runs/May31_14-34-07_n08,
logging_first_step=False,
logging_nan_inf_filter=True,
logging_steps=20,
logging_strategy=steps,
lr_scheduler_kwargs={},
lr_scheduler_type=cosine,
max_grad_norm=1.0,
max_steps=-1,
metric_for_best_model=None,
mp_parameters=,
neftune_noise_alpha=None,
no_cuda=False,
num_train_epochs=5,
optim=adamw_torch,
optim_args=None,
optim_target_modules=None,
output_dir=./checkpoint_dir,
overwrite_output_dir=True,
past_index=-1,
per_device_eval_batch_size=4,
per_device_train_batch_size=4,
prediction_loss_only=False,
push_to_hub=False,
push_to_hub_model_id=None,
push_to_hub_organization=None,
push_to_hub_token=<PUSH_TO_HUB_TOKEN>,
ray_scope=last,
remove_unused_columns=True,
report_to=['tensorboard'],
restore_callback_states_from_checkpoint=False,
resume_from_checkpoint=None,
run_name=./checkpoint_dir,
save_on_each_node=False,
save_only_model=False,
save_safetensors=True,
save_steps=100,
save_strategy=steps,
save_total_limit=1,
seed=0,
skip_memory_metrics=True,
split_batches=None,
tf32=None,
torch_compile=False,
torch_compile_backend=None,
torch_compile_mode=None,
torchdynamo=None,
tpu_metrics_debug=False,
tpu_num_cores=None,
use_cpu=False,
use_ipex=False,
use_legacy_prediction_loop=False,
use_mps_device=False,
warmup_ratio=0.2,
warmup_steps=0,
weight_decay=0.0,
)
2024-05-31 14:34:08 - INFO - __main__ - PEFT parameters LoraConfig(peft_type=<PeftType.LORA: 'LORA'>, auto_mapping=None, base_model_name_or_path=None, revision=None, task_type='CAUSAL_LM', inference_mode=False, r=16, target_modules='all-linear', lora_alpha=32, lora_dropout=0.05, fan_in_fan_out=False, bias='none', use_rslora=False, modules_to_save=None, init_lora_weights=True, layers_to_transform=None, layers_pattern=None, rank_pattern={}, alpha_pattern={}, megatron_config=None, megatron_core='megatron.core', loftq_config={}, use_dora=False)
[INFO|configuration_utils.py:731] 2024-05-31 14:34:08,914 >> loading configuration file ./config.json
[INFO|configuration_utils.py:731] 2024-05-31 14:34:08,917 >> loading configuration file ./config.json
[INFO|configuration_utils.py:796] 2024-05-31 14:34:08,918 >> Model config Phi3Config {
  "_name_or_path": "./",
  "architectures": [
    "Phi3ForCausalLM"
  ],
  "attention_dropout": 0.0,
  "auto_map": {
    "AutoConfig": "configuration_phi3.Phi3Config",
    "AutoModelForCausalLM": "modeling_phi3.Phi3ForCausalLM"
  },
  "bos_token_id": 1,
  "embd_pdrop": 0.0,
  "eos_token_id": 32000,
  "hidden_act": "silu",
  "hidden_size": 3072,
  "initializer_range": 0.02,
  "intermediate_size": 8192,
  "max_position_embeddings": 4096,
  "model_type": "phi3",
  "num_attention_heads": 32,
  "num_hidden_layers": 32,
  "num_key_value_heads": 32,
  "original_max_position_embeddings": 4096,
  "pad_token_id": 32000,
  "resid_pdrop": 0.0,
  "rms_norm_eps": 1e-05,
  "rope_scaling": null,
  "rope_theta": 10000.0,
  "sliding_window": 2047,
  "tie_word_embeddings": false,
  "torch_dtype": "bfloat16",
  "transformers_version": "4.41.1",
  "use_cache": false,
  "vocab_size": 32064
}

[INFO|modeling_utils.py:3471] 2024-05-31 14:34:08,968 >> loading weights file ./model.safetensors.index.json
[INFO|modeling_utils.py:1519] 2024-05-31 14:34:08,969 >> Instantiating Phi3ForCausalLM model under default dtype torch.bfloat16.
[INFO|modeling_utils.py:3614] 2024-05-31 14:34:08,969 >> Detected DeepSpeed ZeRO-3: activating zero.init() for this model
[WARNING|logging.py:329] 2024-05-31 14:34:08,972 >> You are attempting to use Flash Attention 2.0 with a model not initialized on GPU. Make sure to move the model to GPU after initializing it on CPU with `model.to('cuda')`.
[INFO|configuration_utils.py:962] 2024-05-31 14:34:08,976 >> Generate config GenerationConfig {
  "bos_token_id": 1,
  "eos_token_id": 32000,
  "pad_token_id": 32000,
  "use_cache": false
}

[2024-05-31 14:34:09,309] [INFO] [partition_parameters.py:345:__exit__] finished initializing model - num_params = 195, num_elems = 3.82B
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:03<00:03,  3.07s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:04<00:00,  1.96s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:04<00:00,  2.12s/it]
[INFO|modeling_utils.py:4280] 2024-05-31 14:34:13,586 >> All model checkpoint weights were used when initializing Phi3ForCausalLM.

[INFO|modeling_utils.py:4288] 2024-05-31 14:34:13,586 >> All the weights of Phi3ForCausalLM were initialized from the model checkpoint at ./.
If your task is similar to the task the model of the checkpoint was trained on, you can already use Phi3ForCausalLM for predictions without further training.
[INFO|configuration_utils.py:915] 2024-05-31 14:34:13,589 >> loading configuration file ./generation_config.json
[INFO|configuration_utils.py:962] 2024-05-31 14:34:13,589 >> Generate config GenerationConfig {
  "bos_token_id": 1,
  "eos_token_id": [
    32000,
    32001,
    32007
  ],
  "pad_token_id": 32000
}

[INFO|tokenization_utils_base.py:2106] 2024-05-31 14:34:13,593 >> loading file tokenizer.model
[INFO|tokenization_utils_base.py:2106] 2024-05-31 14:34:13,593 >> loading file tokenizer.json
[INFO|tokenization_utils_base.py:2106] 2024-05-31 14:34:13,593 >> loading file added_tokens.json
[INFO|tokenization_utils_base.py:2106] 2024-05-31 14:34:13,593 >> loading file special_tokens_map.json
[INFO|tokenization_utils_base.py:2106] 2024-05-31 14:34:13,593 >> loading file tokenizer_config.json
[WARNING|logging.py:314] 2024-05-31 14:34:13,651 >> Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Overwrite dataset info from restored data version if exists.
2024-05-31 14:34:13 - INFO - datasets.builder - Overwrite dataset info from restored data version if exists.
Loading Dataset info from /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5
2024-05-31 14:34:13 - INFO - datasets.info - Loading Dataset info from /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5
Found cached dataset gsm8k (/root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5)
2024-05-31 14:34:13 - INFO - datasets.builder - Found cached dataset gsm8k (/root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5)
Loading Dataset info from /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5
2024-05-31 14:34:13 - INFO - datasets.info - Loading Dataset info from /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5
-----------------------------
['question', 'answer']
-----------------------------
Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-5a7811434d08fb09.arrow
2024-05-31 14:34:13 - INFO - datasets.arrow_dataset - Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-5a7811434d08fb09.arrow
Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-7989e7b156c6dfa6.arrow
2024-05-31 14:34:13 - INFO - datasets.arrow_dataset - Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-7989e7b156c6dfa6.arrow
{'question': 'Natalia sold clips to 48 of her friends in April, and then she sold half as many clips in May. How many clips did Natalia sell altogether in April and May?', 'answer': 'Natalia sold 48/2 = <<48/2=24>>24 clips in May.\nNatalia sold 48+24 = <<48+24=72>>72 clips altogether in April and May.'}
Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-0d894978e4a745e3.arrow
2024-05-31 14:34:13 - INFO - datasets.arrow_dataset - Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-0d894978e4a745e3.arrow
Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-514d9be6b6eed3cb.arrow
2024-05-31 14:34:13 - INFO - datasets.arrow_dataset - Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-514d9be6b6eed3cb.arrow
<s><|user|>
Answer the following question.

Question: Betty is saving money for a new wallet which costs $100. Betty has only half of the money she needs. Her parents decided to give her $15 for that purpose, and her grandparents twice as much as her parents. How much more money does Betty need to buy the wallet?<|end|>
<|assistant|>
Answer: In the beginning, Betty has only 100 / 2 = $<<100/2=50>>50.
Betty's grandparents gave her 15 * 2 = $<<15*2=30>>30.
This means, Betty needs 100 - 50 - 30 - 15 = $<<100-50-30-15=5>>5 more.
Caching indices mapping at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-1d0d4d2e13c33547.arrow
2024-05-31 14:34:13 - INFO - datasets.arrow_dataset - Caching indices mapping at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-1d0d4d2e13c33547.arrow
Caching indices mapping at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-bc1338151fb9c4df.arrow
2024-05-31 14:34:13 - INFO - datasets.arrow_dataset - Caching indices mapping at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-bc1338151fb9c4df.arrow
Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-a33b343c530563b1.arrow
2024-05-31 14:34:19 - INFO - datasets.arrow_dataset - Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-a33b343c530563b1.arrow
Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-99032ae739ab2487.arrow
2024-05-31 14:34:19 - INFO - datasets.arrow_dataset - Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-99032ae739ab2487.arrow
[INFO|trainer.py:641] 2024-05-31 14:34:19,187 >> Using auto half precision backend
[2024-05-31 14:34:19,363] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed info: version=0.14.2, git-hash=unknown, git-branch=unknown
[2024-05-31 14:34:19,386] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2024-05-31 14:34:19,389] [INFO] [logging.py:96:log_dist] [Rank 0] Using client Optimizer as basic optimizer
[2024-05-31 14:34:19,389] [INFO] [logging.py:96:log_dist] [Rank 0] Removing param_group that has no 'params' in the basic Optimizer
[2024-05-31 14:34:19,404] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed Basic Optimizer = AdamW
[2024-05-31 14:34:19,404] [INFO] [utils.py:56:is_zero_supported_optimizer] Checking ZeRO support for optimizer=AdamW type=<class 'torch.optim.adamw.AdamW'>
[2024-05-31 14:34:19,404] [INFO] [logging.py:96:log_dist] [Rank 0] Creating fp16 ZeRO stage 3 optimizer, MiCS is enabled False, Hierarchical params gather False
[2024-05-31 14:34:19,404] [INFO] [logging.py:96:log_dist] [Rank 0] Creating torch.bfloat16 ZeRO stage 3 optimizer
[2024-05-31 14:34:19,525] [INFO] [utils.py:779:see_memory_usage] Stage 3 initialize beginning
[2024-05-31 14:34:19,526] [INFO] [utils.py:780:see_memory_usage] MA 7.16 GB         Max_MA 7.48 GB         CA 7.53 GB         Max_CA 8 GB 
[2024-05-31 14:34:19,526] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 25.28 GB, percent = 2.5%
[2024-05-31 14:34:19,531] [INFO] [stage3.py:130:__init__] Reduce bucket size 500,000,000
[2024-05-31 14:34:19,531] [INFO] [stage3.py:131:__init__] Prefetch bucket size 50,000,000
[2024-05-31 14:34:19,657] [INFO] [utils.py:779:see_memory_usage] DeepSpeedZeRoOffload initialize [begin]
[2024-05-31 14:34:19,658] [INFO] [utils.py:780:see_memory_usage] MA 7.16 GB         Max_MA 7.16 GB         CA 7.53 GB         Max_CA 8 GB 
[2024-05-31 14:34:19,658] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 25.3 GB, percent = 2.5%
Parameter Offload: Total persistent parameters: 8064000 in 225 params
[2024-05-31 14:34:19,918] [INFO] [utils.py:779:see_memory_usage] DeepSpeedZeRoOffload initialize [end]
[2024-05-31 14:34:19,918] [INFO] [utils.py:780:see_memory_usage] MA 7.16 GB         Max_MA 7.16 GB         CA 7.53 GB         Max_CA 8 GB 
[2024-05-31 14:34:19,919] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 25.33 GB, percent = 2.5%
[2024-05-31 14:34:20,052] [INFO] [utils.py:779:see_memory_usage] Before creating fp16 partitions
[2024-05-31 14:34:20,053] [INFO] [utils.py:780:see_memory_usage] MA 7.16 GB         Max_MA 7.16 GB         CA 7.53 GB         Max_CA 8 GB 
[2024-05-31 14:34:20,053] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 25.34 GB, percent = 2.5%
[2024-05-31 14:34:20,372] [INFO] [utils.py:779:see_memory_usage] After creating fp16 partitions: 1
[2024-05-31 14:34:20,373] [INFO] [utils.py:780:see_memory_usage] MA 7.16 GB         Max_MA 7.16 GB         CA 7.48 GB         Max_CA 8 GB 
[2024-05-31 14:34:20,373] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 25.36 GB, percent = 2.5%
[2024-05-31 14:34:20,512] [INFO] [utils.py:779:see_memory_usage] Before creating fp32 partitions
[2024-05-31 14:34:20,513] [INFO] [utils.py:780:see_memory_usage] MA 7.16 GB         Max_MA 7.16 GB         CA 7.48 GB         Max_CA 7 GB 
[2024-05-31 14:34:20,513] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 25.37 GB, percent = 2.5%
[2024-05-31 14:34:20,661] [INFO] [utils.py:779:see_memory_usage] After creating fp32 partitions
[2024-05-31 14:34:20,662] [INFO] [utils.py:780:see_memory_usage] MA 7.26 GB         Max_MA 7.31 GB         CA 7.62 GB         Max_CA 8 GB 
[2024-05-31 14:34:20,662] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 25.39 GB, percent = 2.5%
[2024-05-31 14:34:20,796] [INFO] [utils.py:779:see_memory_usage] Before initializing optimizer states
[2024-05-31 14:34:20,797] [INFO] [utils.py:780:see_memory_usage] MA 7.26 GB         Max_MA 7.26 GB         CA 7.62 GB         Max_CA 8 GB 
[2024-05-31 14:34:20,797] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 25.41 GB, percent = 2.5%
[2024-05-31 14:34:20,930] [INFO] [utils.py:779:see_memory_usage] After initializing optimizer states
[2024-05-31 14:34:20,931] [INFO] [utils.py:780:see_memory_usage] MA 7.26 GB         Max_MA 7.35 GB         CA 7.71 GB         Max_CA 8 GB 
[2024-05-31 14:34:20,931] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 25.42 GB, percent = 2.5%
[2024-05-31 14:34:20,931] [INFO] [stage3.py:486:_setup_for_real_optimizer] optimizer state initialized
[2024-05-31 14:34:21,138] [INFO] [utils.py:779:see_memory_usage] After initializing ZeRO optimizer
[2024-05-31 14:34:21,139] [INFO] [utils.py:780:see_memory_usage] MA 8.24 GB         Max_MA 8.24 GB         CA 8.64 GB         Max_CA 9 GB 
[2024-05-31 14:34:21,139] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 25.43 GB, percent = 2.5%
[2024-05-31 14:34:21,140] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed Final Optimizer = AdamW
[2024-05-31 14:34:21,140] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed using client LR scheduler
[2024-05-31 14:34:21,140] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed LR Scheduler = None
[2024-05-31 14:34:21,140] [INFO] [logging.py:96:log_dist] [Rank 0] step=0, skipped=0, lr=[0.0], mom=[(0.9, 0.999)]
[2024-05-31 14:34:21,142] [INFO] [config.py:996:print] DeepSpeedEngine configuration:
[2024-05-31 14:34:21,143] [INFO] [config.py:1000:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2024-05-31 14:34:21,143] [INFO] [config.py:1000:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2024-05-31 14:34:21,143] [INFO] [config.py:1000:print]   amp_enabled .................. False
[2024-05-31 14:34:21,143] [INFO] [config.py:1000:print]   amp_params ................... False
[2024-05-31 14:34:21,143] [INFO] [config.py:1000:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2024-05-31 14:34:21,143] [INFO] [config.py:1000:print]   bfloat16_enabled ............. True
[2024-05-31 14:34:21,143] [INFO] [config.py:1000:print]   bfloat16_immediate_grad_update  False
[2024-05-31 14:34:21,143] [INFO] [config.py:1000:print]   checkpoint_parallel_write_pipeline  False
[2024-05-31 14:34:21,143] [INFO] [config.py:1000:print]   checkpoint_tag_validation_enabled  True
[2024-05-31 14:34:21,144] [INFO] [config.py:1000:print]   checkpoint_tag_validation_fail  False
[2024-05-31 14:34:21,144] [INFO] [config.py:1000:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f5d747d0850>
[2024-05-31 14:34:21,144] [INFO] [config.py:1000:print]   communication_data_type ...... None
[2024-05-31 14:34:21,144] [INFO] [config.py:1000:print]   compile_config ............... enabled=False backend='inductor' kwargs={}
[2024-05-31 14:34:21,144] [INFO] [config.py:1000:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2024-05-31 14:34:21,144] [INFO] [config.py:1000:print]   curriculum_enabled_legacy .... False
[2024-05-31 14:34:21,144] [INFO] [config.py:1000:print]   curriculum_params_legacy ..... False
[2024-05-31 14:34:21,144] [INFO] [config.py:1000:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2024-05-31 14:34:21,144] [INFO] [config.py:1000:print]   data_efficiency_enabled ...... False
[2024-05-31 14:34:21,144] [INFO] [config.py:1000:print]   dataloader_drop_last ......... False
[2024-05-31 14:34:21,144] [INFO] [config.py:1000:print]   disable_allgather ............ False
[2024-05-31 14:34:21,144] [INFO] [config.py:1000:print]   dump_state ................... False
[2024-05-31 14:34:21,144] [INFO] [config.py:1000:print]   dynamic_loss_scale_args ...... None
[2024-05-31 14:34:21,144] [INFO] [config.py:1000:print]   eigenvalue_enabled ........... False
[2024-05-31 14:34:21,144] [INFO] [config.py:1000:print]   eigenvalue_gas_boundary_resolution  1
[2024-05-31 14:34:21,144] [INFO] [config.py:1000:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2024-05-31 14:34:21,144] [INFO] [config.py:1000:print]   eigenvalue_layer_num ......... 0
[2024-05-31 14:34:21,144] [INFO] [config.py:1000:print]   eigenvalue_max_iter .......... 100
[2024-05-31 14:34:21,144] [INFO] [config.py:1000:print]   eigenvalue_stability ......... 1e-06
[2024-05-31 14:34:21,144] [INFO] [config.py:1000:print]   eigenvalue_tol ............... 0.01
[2024-05-31 14:34:21,144] [INFO] [config.py:1000:print]   eigenvalue_verbose ........... False
[2024-05-31 14:34:21,145] [INFO] [config.py:1000:print]   elasticity_enabled ........... False
[2024-05-31 14:34:21,145] [INFO] [config.py:1000:print]   flops_profiler_config ........ {
    "enabled": false, 
    "recompute_fwd_factor": 0.0, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2024-05-31 14:34:21,145] [INFO] [config.py:1000:print]   fp16_auto_cast ............... None
[2024-05-31 14:34:21,145] [INFO] [config.py:1000:print]   fp16_enabled ................. False
[2024-05-31 14:34:21,145] [INFO] [config.py:1000:print]   fp16_master_weights_and_gradients  False
[2024-05-31 14:34:21,145] [INFO] [config.py:1000:print]   global_rank .................. 0
[2024-05-31 14:34:21,145] [INFO] [config.py:1000:print]   grad_accum_dtype ............. None
[2024-05-31 14:34:21,145] [INFO] [config.py:1000:print]   gradient_accumulation_steps .. 1
[2024-05-31 14:34:21,145] [INFO] [config.py:1000:print]   gradient_clipping ............ 1.0
[2024-05-31 14:34:21,145] [INFO] [config.py:1000:print]   gradient_predivide_factor .... 1.0
[2024-05-31 14:34:21,145] [INFO] [config.py:1000:print]   graph_harvesting ............. False
[2024-05-31 14:34:21,145] [INFO] [config.py:1000:print]   hybrid_engine ................ enabled=False max_out_tokens=512 inference_tp_size=1 release_inference_cache=False pin_parameters=True tp_gather_partition_size=8
[2024-05-31 14:34:21,145] [INFO] [config.py:1000:print]   initial_dynamic_scale ........ 1
[2024-05-31 14:34:21,145] [INFO] [config.py:1000:print]   load_universal_checkpoint .... False
[2024-05-31 14:34:21,145] [INFO] [config.py:1000:print]   loss_scale ................... 1.0
[2024-05-31 14:34:21,145] [INFO] [config.py:1000:print]   memory_breakdown ............. False
[2024-05-31 14:34:21,145] [INFO] [config.py:1000:print]   mics_hierarchial_params_gather  False
[2024-05-31 14:34:21,145] [INFO] [config.py:1000:print]   mics_shard_size .............. -1
[2024-05-31 14:34:21,145] [INFO] [config.py:1000:print]   monitor_config ............... tensorboard=TensorBoardConfig(enabled=False, output_path='', job_name='DeepSpeedJobName') wandb=WandbConfig(enabled=False, group=None, team=None, project='deepspeed') csv_monitor=CSVConfig(enabled=False, output_path='', job_name='DeepSpeedJobName') enabled=False
[2024-05-31 14:34:21,145] [INFO] [config.py:1000:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2024-05-31 14:34:21,146] [INFO] [config.py:1000:print]   optimizer_legacy_fusion ...... False
[2024-05-31 14:34:21,146] [INFO] [config.py:1000:print]   optimizer_name ............... None
[2024-05-31 14:34:21,146] [INFO] [config.py:1000:print]   optimizer_params ............. None
[2024-05-31 14:34:21,146] [INFO] [config.py:1000:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0, 'pipe_partitioned': True, 'grad_partitioned': True}
[2024-05-31 14:34:21,146] [INFO] [config.py:1000:print]   pld_enabled .................. False
[2024-05-31 14:34:21,146] [INFO] [config.py:1000:print]   pld_params ................... False
[2024-05-31 14:34:21,146] [INFO] [config.py:1000:print]   prescale_gradients ........... False
[2024-05-31 14:34:21,146] [INFO] [config.py:1000:print]   scheduler_name ............... None
[2024-05-31 14:34:21,146] [INFO] [config.py:1000:print]   scheduler_params ............. None
[2024-05-31 14:34:21,146] [INFO] [config.py:1000:print]   seq_parallel_communication_data_type  torch.float32
[2024-05-31 14:34:21,146] [INFO] [config.py:1000:print]   sparse_attention ............. None
[2024-05-31 14:34:21,146] [INFO] [config.py:1000:print]   sparse_gradients_enabled ..... False
[2024-05-31 14:34:21,146] [INFO] [config.py:1000:print]   steps_per_print .............. inf
[2024-05-31 14:34:21,146] [INFO] [config.py:1000:print]   train_batch_size ............. 4
[2024-05-31 14:34:21,146] [INFO] [config.py:1000:print]   train_micro_batch_size_per_gpu  4
[2024-05-31 14:34:21,146] [INFO] [config.py:1000:print]   use_data_before_expert_parallel_  False
[2024-05-31 14:34:21,146] [INFO] [config.py:1000:print]   use_node_local_storage ....... False
[2024-05-31 14:34:21,146] [INFO] [config.py:1000:print]   wall_clock_breakdown ......... False
[2024-05-31 14:34:21,146] [INFO] [config.py:1000:print]   weight_quantization_config ... None
[2024-05-31 14:34:21,146] [INFO] [config.py:1000:print]   world_size ................... 1
[2024-05-31 14:34:21,146] [INFO] [config.py:1000:print]   zero_allow_untested_optimizer  True
[2024-05-31 14:34:21,146] [INFO] [config.py:1000:print]   zero_config .................. stage=3 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 use_multi_rank_bucket_allreduce=True allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=True load_from_fp32_weights=True elastic_checkpoint=False offload_param=DeepSpeedZeroOffloadParamConfig(device='none', nvme_path=None, buffer_count=5, buffer_size=100,000,000, max_in_cpu=1,000,000,000, pin_memory=False) offload_optimizer=DeepSpeedZeroOffloadOptimizerConfig(device='none', nvme_path=None, buffer_count=4, pin_memory=False, pipeline=False, pipeline_read=False, pipeline_write=False, fast_init=False, ratio=1.0) sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False zero_hpz_partition_size=1 zero_quantized_weights=False zero_quantized_nontrainable_weights=False zero_quantized_gradients=False mics_shard_size=-1 mics_hierarchical_params_gather=False memory_efficient_linear=True pipeline_loading_checkpoint=False override_module_apply=True
[2024-05-31 14:34:21,147] [INFO] [config.py:1000:print]   zero_enabled ................. True
[2024-05-31 14:34:21,147] [INFO] [config.py:1000:print]   zero_force_ds_cpu_optimizer .. True
[2024-05-31 14:34:21,147] [INFO] [config.py:1000:print]   zero_optimization_stage ...... 3
[2024-05-31 14:34:21,147] [INFO] [config.py:986:print_user_config]   json = {
    "train_batch_size": 4, 
    "train_micro_batch_size_per_gpu": 4, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 3, 
        "offload_optimizer": {
            "device": "none", 
            "nvme_path": null
        }, 
        "offload_param": {
            "device": "none", 
            "nvme_path": null
        }, 
        "stage3_gather_16bit_weights_on_model_save": false
    }, 
    "gradient_clipping": 1.0, 
    "steps_per_print": inf, 
    "bf16": {
        "enabled": true
    }, 
    "fp16": {
        "enabled": false
    }, 
    "zero_allow_untested_optimizer": true
}
[INFO|trainer.py:2078] 2024-05-31 14:34:21,147 >> ***** Running training *****
[INFO|trainer.py:2079] 2024-05-31 14:34:21,147 >>   Num examples = 7,473
[INFO|trainer.py:2080] 2024-05-31 14:34:21,147 >>   Num Epochs = 5
[INFO|trainer.py:2081] 2024-05-31 14:34:21,147 >>   Instantaneous batch size per device = 4
[INFO|trainer.py:2084] 2024-05-31 14:34:21,147 >>   Total train batch size (w. parallel, distributed & accumulation) = 4
[INFO|trainer.py:2085] 2024-05-31 14:34:21,147 >>   Gradient Accumulation steps = 1
[INFO|trainer.py:2086] 2024-05-31 14:34:21,147 >>   Total optimization steps = 9,345
[INFO|trainer.py:2087] 2024-05-31 14:34:21,150 >>   Number of trainable parameters = 25,165,824
  0%|          | 0/9345 [00:00<?, ?it/s]  0%|          | 1/9345 [00:01<4:57:39,  1.91s/it]  0%|          | 2/9345 [00:06<9:32:43,  3.68s/it]  0%|          | 3/9345 [00:07<6:29:22,  2.50s/it]  0%|          | 4/9345 [00:08<4:59:22,  1.92s/it]  0%|          | 5/9345 [00:09<4:09:17,  1.60s/it]  0%|          | 6/9345 [00:11<3:39:04,  1.41s/it]  0%|          | 7/9345 [00:12<3:19:47,  1.28s/it]  0%|          | 8/9345 [00:13<3:07:24,  1.20s/it]  0%|          | 9/9345 [00:14<3:07:59,  1.21s/it]  0%|          | 10/9345 [00:15<2:59:25,  1.15s/it]  0%|          | 11/9345 [00:16<2:53:35,  1.12s/it]  0%|          | 12/9345 [00:17<2:48:55,  1.09s/it]  0%|          | 13/9345 [00:18<2:45:15,  1.06s/it]  0%|          | 14/9345 [00:19<2:42:42,  1.05s/it]  0%|          | 15/9345 [00:20<2:41:52,  1.04s/it]  0%|          | 16/9345 [00:21<2:40:39,  1.03s/it]  0%|          | 17/9345 [00:22<2:39:36,  1.03s/it]  0%|          | 18/9345 [00:23<2:39:23,  1.03s/it]  0%|          | 19/9345 [00:24<2:38:53,  1.02s/it]  0%|          | 20/9345 [00:25<2:38:47,  1.02s/it]                                                   {'loss': 0.9772, 'grad_norm': 1.7833939763728055, 'learning_rate': 5.350454788657036e-07, 'epoch': 0.01}
  0%|          | 20/9345 [00:25<2:38:47,  1.02s/it]  0%|          | 21/9345 [00:26<2:39:01,  1.02s/it]  0%|          | 22/9345 [00:27<2:38:49,  1.02s/it]  0%|          | 23/9345 [00:28<2:48:48,  1.09s/it]  0%|          | 24/9345 [00:29<2:46:18,  1.07s/it]  0%|          | 25/9345 [00:30<2:44:28,  1.06s/it]  0%|          | 26/9345 [00:31<2:43:09,  1.05s/it]  0%|          | 27/9345 [00:32<2:41:57,  1.04s/it]  0%|          | 28/9345 [00:33<2:40:59,  1.04s/it]  0%|          | 29/9345 [00:34<2:40:23,  1.03s/it]  0%|          | 30/9345 [00:35<2:40:07,  1.03s/it]  0%|          | 31/9345 [00:37<2:40:17,  1.03s/it]  0%|          | 32/9345 [00:38<2:40:10,  1.03s/it]  0%|          | 33/9345 [00:39<2:40:41,  1.04s/it]  0%|          | 34/9345 [00:40<2:40:17,  1.03s/it]  0%|          | 35/9345 [00:41<2:39:41,  1.03s/it]  0%|          | 36/9345 [00:42<2:39:35,  1.03s/it]  0%|          | 37/9345 [00:43<2:39:46,  1.03s/it]  0%|          | 38/9345 [00:44<2:48:55,  1.09s/it]  0%|          | 39/9345 [00:45<2:45:21,  1.07s/it]  0%|          | 40/9345 [00:46<2:43:45,  1.06s/it]                                                   {'loss': 0.9709, 'grad_norm': 2.481765905138449, 'learning_rate': 1.0700909577314073e-06, 'epoch': 0.02}
  0%|          | 40/9345 [00:46<2:43:45,  1.06s/it]  0%|          | 41/9345 [00:47<2:42:56,  1.05s/it]  0%|          | 42/9345 [00:48<2:42:16,  1.05s/it]  0%|          | 43/9345 [00:49<2:41:24,  1.04s/it]  0%|          | 44/9345 [00:50<2:41:05,  1.04s/it]  0%|          | 45/9345 [00:51<2:40:24,  1.03s/it]  0%|          | 46/9345 [00:52<2:39:53,  1.03s/it]  1%|          | 47/9345 [00:53<2:39:42,  1.03s/it]  1%|          | 48/9345 [00:54<2:39:33,  1.03s/it]  1%|          | 49/9345 [00:55<2:39:38,  1.03s/it]  1%|          | 50/9345 [00:56<2:39:20,  1.03s/it]  1%|          | 51/9345 [00:57<2:39:16,  1.03s/it]  1%|          | 52/9345 [00:59<2:49:04,  1.09s/it]  1%|          | 53/9345 [01:00<2:46:01,  1.07s/it]  1%|          | 54/9345 [01:01<2:44:32,  1.06s/it]  1%|          | 55/9345 [01:02<2:42:56,  1.05s/it]  1%|          | 56/9345 [01:03<2:41:45,  1.04s/it]  1%|          | 57/9345 [01:04<2:40:14,  1.04s/it]  1%|          | 58/9345 [01:05<2:39:38,  1.03s/it]  1%|          | 59/9345 [01:06<2:39:04,  1.03s/it]  1%|          | 60/9345 [01:07<2:39:00,  1.03s/it]                                                   {'loss': 0.9652, 'grad_norm': 1.3269021938520873, 'learning_rate': 1.6051364365971107e-06, 'epoch': 0.03}
  1%|          | 60/9345 [01:07<2:39:00,  1.03s/it]  1%|          | 61/9345 [01:08<2:39:28,  1.03s/it]  1%|          | 62/9345 [01:09<2:39:03,  1.03s/it]  1%|          | 63/9345 [01:10<2:39:13,  1.03s/it]  1%|          | 64/9345 [01:11<2:39:06,  1.03s/it]  1%|          | 65/9345 [01:12<2:39:01,  1.03s/it]  1%|          | 66/9345 [01:13<2:39:10,  1.03s/it]  1%|          | 67/9345 [01:14<2:48:19,  1.09s/it]  1%|          | 68/9345 [01:15<2:45:17,  1.07s/it]  1%|          | 69/9345 [01:16<2:42:52,  1.05s/it]  1%|          | 70/9345 [01:17<2:41:39,  1.05s/it]  1%|          | 71/9345 [01:18<2:40:11,  1.04s/it]  1%|          | 72/9345 [01:19<2:39:34,  1.03s/it]  1%|          | 73/9345 [01:20<2:39:03,  1.03s/it]  1%|          | 74/9345 [01:21<2:38:42,  1.03s/it]  1%|          | 75/9345 [01:22<2:38:48,  1.03s/it]  1%|          | 76/9345 [01:23<2:39:00,  1.03s/it]  1%|          | 77/9345 [01:24<2:38:46,  1.03s/it]  1%|          | 78/9345 [01:25<2:39:02,  1.03s/it]  1%|          | 79/9345 [01:26<2:38:45,  1.03s/it]  1%|          | 80/9345 [01:28<2:40:15,  1.04s/it]                                                   {'loss': 0.9253, 'grad_norm': 1.893375946389369, 'learning_rate': 2.1401819154628146e-06, 'epoch': 0.04}
  1%|          | 80/9345 [01:28<2:40:15,  1.04s/it]  1%|          | 81/9345 [01:29<2:49:04,  1.10s/it]  1%|          | 82/9345 [01:30<2:45:29,  1.07s/it]  1%|          | 83/9345 [01:31<2:43:08,  1.06s/it]  1%|          | 84/9345 [01:32<2:40:27,  1.04s/it]  1%|          | 85/9345 [01:33<2:39:31,  1.03s/it]  1%|          | 86/9345 [01:34<2:38:43,  1.03s/it]  1%|          | 87/9345 [01:35<2:38:12,  1.03s/it]  1%|          | 88/9345 [01:36<2:38:08,  1.02s/it]  1%|          | 89/9345 [01:37<2:45:22,  1.07s/it]  1%|          | 90/9345 [01:38<2:43:36,  1.06s/it]  1%|          | 91/9345 [01:39<2:45:21,  1.07s/it]  1%|          | 92/9345 [01:40<2:44:00,  1.06s/it]  1%|          | 93/9345 [01:41<2:41:54,  1.05s/it]  1%|          | 94/9345 [01:42<2:40:55,  1.04s/it]  1%|          | 95/9345 [01:43<2:39:24,  1.03s/it]  1%|          | 96/9345 [01:44<2:46:57,  1.08s/it]  1%|          | 97/9345 [01:46<2:45:01,  1.07s/it]  1%|          | 98/9345 [01:47<2:43:14,  1.06s/it]  1%|          | 99/9345 [01:48<2:41:35,  1.05s/it]  1%|          | 100/9345 [01:49<2:40:46,  1.04s/it]                                                    {'loss': 0.8628, 'grad_norm': 1.7061653044007843, 'learning_rate': 2.6752273943285182e-06, 'epoch': 0.05}
  1%|          | 100/9345 [01:49<2:40:46,  1.04s/it][WARNING|trainer.py:3344] 2024-05-31 14:36:10,269 >>  stage3_gather_16bit_weights_on_model_save=false. Saving the full checkpoint instead, use zero_to_fp32.py to recover weights
[INFO|trainer.py:3410] 2024-05-31 14:36:10,269 >> Saving model checkpoint to ./checkpoint_dir/checkpoint-100
/opt/conda/lib/python3.10/site-packages/peft/utils/save_and_load.py:154: UserWarning: Could not find a config file in ./ - will assume that the vocabulary was not modified.
  warnings.warn(
[INFO|tokenization_utils_base.py:2513] 2024-05-31 14:36:10,310 >> tokenizer config file saved in ./checkpoint_dir/checkpoint-100/tokenizer_config.json
[INFO|tokenization_utils_base.py:2522] 2024-05-31 14:36:10,311 >> Special tokens file saved in ./checkpoint_dir/checkpoint-100/special_tokens_map.json
[2024-05-31 14:36:10,373] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step100 is about to be saved!
[2024-05-31 14:36:15,073] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-100/global_step100/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:36:15,073] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-100/global_step100/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:36:27,664] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-100/global_step100/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:36:27,994] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-100/global_step100/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:36:28,657] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-100/global_step100/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:36:28,659] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-100/global_step100/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:36:28,664] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step100 is ready now!
[2024-05-31 14:36:28,694] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step100 is about to be saved!
[2024-05-31 14:36:28,711] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-100/global_step100/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:36:28,711] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-100/global_step100/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:36:30,001] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-100/global_step100/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:36:30,003] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-100/global_step100/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:36:30,741] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-100/global_step100/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:36:30,743] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-100/global_step100/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:36:30,746] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step100 is ready now!
[INFO|trainer.py:3502] 2024-05-31 14:36:30,752 >> Deleting older checkpoint [checkpoint_dir/checkpoint-100] due to args.save_total_limit
  1%|          | 101/9345 [02:10<18:31:30,  7.21s/it]  1%|          | 102/9345 [02:12<14:23:06,  5.60s/it]  1%|          | 103/9345 [02:14<11:32:47,  4.50s/it]  1%|          | 104/9345 [02:15<8:51:50,  3.45s/it]   1%|          | 105/9345 [02:16<6:59:13,  2.72s/it]  1%|          | 106/9345 [02:17<5:40:02,  2.21s/it]  1%|          | 107/9345 [02:18<4:44:56,  1.85s/it]  1%|          | 108/9345 [02:19<4:06:25,  1.60s/it]  1%|          | 109/9345 [02:20<3:39:01,  1.42s/it]  1%|          | 110/9345 [02:21<3:29:02,  1.36s/it]  1%|          | 111/9345 [02:22<3:13:15,  1.26s/it]  1%|          | 112/9345 [02:23<3:08:37,  1.23s/it]  1%|          | 113/9345 [02:24<2:58:36,  1.16s/it]  1%|          | 114/9345 [02:25<2:51:44,  1.12s/it]  1%|          | 115/9345 [02:26<2:46:45,  1.08s/it]  1%|          | 116/9345 [02:27<2:43:19,  1.06s/it]  1%|▏         | 117/9345 [02:28<2:40:33,  1.04s/it]  1%|▏         | 118/9345 [02:29<2:38:51,  1.03s/it]  1%|▏         | 119/9345 [02:31<2:37:42,  1.03s/it]  1%|▏         | 120/9345 [02:32<2:37:03,  1.02s/it]                                                    {'loss': 0.8342, 'grad_norm': 1.3115927039625206, 'learning_rate': 3.2102728731942214e-06, 'epoch': 0.06}
  1%|▏         | 120/9345 [02:32<2:37:03,  1.02s/it]  1%|▏         | 121/9345 [02:33<2:36:23,  1.02s/it]  1%|▏         | 122/9345 [02:34<2:35:37,  1.01s/it]  1%|▏         | 123/9345 [02:35<2:35:10,  1.01s/it]  1%|▏         | 124/9345 [02:36<2:43:19,  1.06s/it]  1%|▏         | 125/9345 [02:37<2:40:21,  1.04s/it]  1%|▏         | 126/9345 [02:38<2:38:31,  1.03s/it]  1%|▏         | 127/9345 [02:39<2:37:26,  1.02s/it]  1%|▏         | 128/9345 [02:40<2:36:36,  1.02s/it]  1%|▏         | 129/9345 [02:41<2:35:39,  1.01s/it]  1%|▏         | 130/9345 [02:42<2:35:13,  1.01s/it]  1%|▏         | 131/9345 [02:43<2:34:54,  1.01s/it]  1%|▏         | 132/9345 [02:44<2:34:45,  1.01s/it]  1%|▏         | 133/9345 [02:45<2:35:19,  1.01s/it]  1%|▏         | 134/9345 [02:46<2:35:26,  1.01s/it]  1%|▏         | 135/9345 [02:47<2:34:40,  1.01s/it]  1%|▏         | 136/9345 [02:48<2:34:12,  1.00s/it]  1%|▏         | 137/9345 [02:49<2:33:59,  1.00s/it]  1%|▏         | 138/9345 [02:50<2:34:09,  1.00s/it]  1%|▏         | 139/9345 [02:51<2:43:09,  1.06s/it]  1%|▏         | 140/9345 [02:52<2:40:07,  1.04s/it]                                                    {'loss': 0.732, 'grad_norm': 1.559617402189023, 'learning_rate': 3.7453183520599255e-06, 'epoch': 0.07}
  1%|▏         | 140/9345 [02:52<2:40:07,  1.04s/it]  2%|▏         | 141/9345 [02:53<2:38:33,  1.03s/it]  2%|▏         | 142/9345 [02:54<2:37:12,  1.02s/it]  2%|▏         | 143/9345 [02:55<2:36:10,  1.02s/it]  2%|▏         | 144/9345 [02:56<2:35:23,  1.01s/it]  2%|▏         | 145/9345 [02:57<2:34:53,  1.01s/it]  2%|▏         | 146/9345 [02:58<2:34:28,  1.01s/it]  2%|▏         | 147/9345 [02:59<2:34:15,  1.01s/it]  2%|▏         | 148/9345 [03:00<2:33:49,  1.00s/it]  2%|▏         | 149/9345 [03:01<2:33:58,  1.00s/it]  2%|▏         | 150/9345 [03:02<2:34:05,  1.01s/it]  2%|▏         | 151/9345 [03:03<2:34:12,  1.01s/it]  2%|▏         | 152/9345 [03:04<2:33:52,  1.00s/it]  2%|▏         | 153/9345 [03:05<2:34:04,  1.01s/it]  2%|▏         | 154/9345 [03:06<2:42:24,  1.06s/it]  2%|▏         | 155/9345 [03:07<2:40:14,  1.05s/it]  2%|▏         | 156/9345 [03:08<2:38:10,  1.03s/it]  2%|▏         | 157/9345 [03:09<2:36:28,  1.02s/it]  2%|▏         | 158/9345 [03:10<2:35:17,  1.01s/it]  2%|▏         | 159/9345 [03:11<2:34:58,  1.01s/it]  2%|▏         | 160/9345 [03:12<2:34:25,  1.01s/it]                                                    {'loss': 0.655, 'grad_norm': 2.1045936081819074, 'learning_rate': 4.280363830925629e-06, 'epoch': 0.09}
  2%|▏         | 160/9345 [03:12<2:34:25,  1.01s/it]  2%|▏         | 161/9345 [03:13<2:34:53,  1.01s/it]  2%|▏         | 162/9345 [03:14<2:34:41,  1.01s/it]  2%|▏         | 163/9345 [03:15<2:34:44,  1.01s/it]  2%|▏         | 164/9345 [03:16<2:34:57,  1.01s/it]  2%|▏         | 165/9345 [03:17<2:34:57,  1.01s/it]  2%|▏         | 166/9345 [03:18<2:34:25,  1.01s/it]  2%|▏         | 167/9345 [03:19<2:34:17,  1.01s/it]  2%|▏         | 168/9345 [03:20<2:41:39,  1.06s/it]  2%|▏         | 169/9345 [03:22<2:39:49,  1.05s/it]  2%|▏         | 170/9345 [03:23<2:37:52,  1.03s/it]  2%|▏         | 171/9345 [03:24<2:36:46,  1.03s/it]  2%|▏         | 172/9345 [03:25<2:36:00,  1.02s/it]  2%|▏         | 173/9345 [03:26<2:35:11,  1.02s/it]  2%|▏         | 174/9345 [03:27<2:35:03,  1.01s/it]  2%|▏         | 175/9345 [03:28<2:34:56,  1.01s/it]  2%|▏         | 176/9345 [03:29<2:34:28,  1.01s/it]  2%|▏         | 177/9345 [03:30<2:34:50,  1.01s/it]  2%|▏         | 178/9345 [03:31<2:34:20,  1.01s/it]  2%|▏         | 179/9345 [03:32<2:34:07,  1.01s/it]  2%|▏         | 180/9345 [03:33<2:34:02,  1.01s/it]                                                    {'loss': 0.5471, 'grad_norm': 1.2633211249237812, 'learning_rate': 4.815409309791332e-06, 'epoch': 0.1}
  2%|▏         | 180/9345 [03:33<2:34:02,  1.01s/it]  2%|▏         | 181/9345 [03:34<2:33:38,  1.01s/it]  2%|▏         | 182/9345 [03:35<2:33:36,  1.01s/it]  2%|▏         | 183/9345 [03:36<2:42:25,  1.06s/it]  2%|▏         | 184/9345 [03:37<2:39:46,  1.05s/it]  2%|▏         | 185/9345 [03:38<2:38:04,  1.04s/it]  2%|▏         | 186/9345 [03:39<2:36:44,  1.03s/it]  2%|▏         | 187/9345 [03:40<2:35:54,  1.02s/it]  2%|▏         | 188/9345 [03:41<2:34:57,  1.02s/it]  2%|▏         | 189/9345 [03:42<2:34:30,  1.01s/it]  2%|▏         | 190/9345 [03:43<2:34:16,  1.01s/it]  2%|▏         | 191/9345 [03:44<2:34:10,  1.01s/it]  2%|▏         | 192/9345 [03:45<2:34:15,  1.01s/it]  2%|▏         | 193/9345 [03:46<2:34:29,  1.01s/it]  2%|▏         | 194/9345 [03:47<2:33:56,  1.01s/it]  2%|▏         | 195/9345 [03:48<2:33:45,  1.01s/it]  2%|▏         | 196/9345 [03:49<2:33:45,  1.01s/it]  2%|▏         | 197/9345 [03:50<2:33:40,  1.01s/it]  2%|▏         | 198/9345 [03:51<2:41:32,  1.06s/it]  2%|▏         | 199/9345 [03:52<2:38:52,  1.04s/it]  2%|▏         | 200/9345 [03:53<2:37:22,  1.03s/it]                                                    {'loss': 0.4537, 'grad_norm': 1.2678816851024157, 'learning_rate': 5.3504547886570364e-06, 'epoch': 0.11}
  2%|▏         | 200/9345 [03:53<2:37:22,  1.03s/it][WARNING|trainer.py:3344] 2024-05-31 14:38:14,764 >>  stage3_gather_16bit_weights_on_model_save=false. Saving the full checkpoint instead, use zero_to_fp32.py to recover weights
[INFO|trainer.py:3410] 2024-05-31 14:38:14,764 >> Saving model checkpoint to ./checkpoint_dir/checkpoint-200
/opt/conda/lib/python3.10/site-packages/peft/utils/save_and_load.py:154: UserWarning: Could not find a config file in ./ - will assume that the vocabulary was not modified.
  warnings.warn(
[INFO|tokenization_utils_base.py:2513] 2024-05-31 14:38:14,789 >> tokenizer config file saved in ./checkpoint_dir/checkpoint-200/tokenizer_config.json
[INFO|tokenization_utils_base.py:2522] 2024-05-31 14:38:14,790 >> Special tokens file saved in ./checkpoint_dir/checkpoint-200/special_tokens_map.json
[2024-05-31 14:38:14,883] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step200 is about to be saved!
[2024-05-31 14:38:19,262] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-200/global_step200/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:38:19,262] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-200/global_step200/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:38:31,556] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-200/global_step200/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:38:31,899] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-200/global_step200/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:38:32,596] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-200/global_step200/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:38:32,597] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-200/global_step200/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:38:32,604] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step200 is ready now!
[2024-05-31 14:38:32,632] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step200 is about to be saved!
[2024-05-31 14:38:32,648] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-200/global_step200/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:38:32,648] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-200/global_step200/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:38:33,885] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-200/global_step200/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:38:33,886] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-200/global_step200/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:38:34,609] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-200/global_step200/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:38:34,611] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-200/global_step200/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:38:34,617] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step200 is ready now!
[INFO|trainer.py:3502] 2024-05-31 14:38:34,622 >> Deleting older checkpoint [checkpoint_dir/checkpoint-200] due to args.save_total_limit
  2%|▏         | 201/9345 [04:14<17:47:04,  7.00s/it]  2%|▏         | 202/9345 [04:15<13:13:59,  5.21s/it]  2%|▏         | 203/9345 [04:16<10:02:35,  3.95s/it]  2%|▏         | 204/9345 [04:17<7:56:33,  3.13s/it]   2%|▏         | 205/9345 [04:18<6:19:28,  2.49s/it]  2%|▏         | 206/9345 [04:19<5:11:35,  2.05s/it]  2%|▏         | 207/9345 [04:20<4:24:10,  1.73s/it]  2%|▏         | 208/9345 [04:21<3:50:15,  1.51s/it]  2%|▏         | 209/9345 [04:22<3:26:24,  1.36s/it]  2%|▏         | 210/9345 [04:23<3:10:08,  1.25s/it]  2%|▏         | 211/9345 [04:24<2:58:31,  1.17s/it]  2%|▏         | 212/9345 [04:25<2:58:41,  1.17s/it]  2%|▏         | 213/9345 [04:26<2:51:05,  1.12s/it]  2%|▏         | 214/9345 [04:27<2:45:49,  1.09s/it]  2%|▏         | 215/9345 [04:28<2:41:49,  1.06s/it]  2%|▏         | 216/9345 [04:29<2:39:33,  1.05s/it]  2%|▏         | 217/9345 [04:31<2:38:48,  1.04s/it]  2%|▏         | 218/9345 [04:32<2:37:04,  1.03s/it]  2%|▏         | 219/9345 [04:33<2:35:46,  1.02s/it]  2%|▏         | 220/9345 [04:34<2:34:55,  1.02s/it]                                                    {'loss': 0.3848, 'grad_norm': 0.8972460637460663, 'learning_rate': 5.88550026752274e-06, 'epoch': 0.12}
  2%|▏         | 220/9345 [04:34<2:34:55,  1.02s/it]  2%|▏         | 221/9345 [04:35<2:35:28,  1.02s/it]  2%|▏         | 222/9345 [04:36<2:34:17,  1.01s/it]  2%|▏         | 223/9345 [04:37<2:34:25,  1.02s/it]  2%|▏         | 224/9345 [04:38<2:34:04,  1.01s/it]  2%|▏         | 225/9345 [04:39<2:34:20,  1.02s/it]  2%|▏         | 226/9345 [04:40<2:34:25,  1.02s/it]  2%|▏         | 227/9345 [04:41<2:43:57,  1.08s/it]  2%|▏         | 228/9345 [04:42<2:41:52,  1.07s/it]  2%|▏         | 229/9345 [04:43<2:39:20,  1.05s/it]  2%|▏         | 230/9345 [04:44<2:37:28,  1.04s/it]  2%|▏         | 231/9345 [04:45<2:36:01,  1.03s/it]  2%|▏         | 232/9345 [04:46<2:35:03,  1.02s/it]  2%|▏         | 233/9345 [04:47<2:34:17,  1.02s/it]  3%|▎         | 234/9345 [04:48<2:33:53,  1.01s/it]  3%|▎         | 235/9345 [04:49<2:33:16,  1.01s/it]  3%|▎         | 236/9345 [04:50<2:32:46,  1.01s/it]  3%|▎         | 237/9345 [04:51<2:32:43,  1.01s/it]  3%|▎         | 238/9345 [04:52<2:32:35,  1.01s/it]  3%|▎         | 239/9345 [04:53<2:32:30,  1.00s/it]  3%|▎         | 240/9345 [04:54<2:32:28,  1.00s/it]                                                    {'loss': 0.3428, 'grad_norm': 1.2944588004177744, 'learning_rate': 6.420545746388443e-06, 'epoch': 0.13}
  3%|▎         | 240/9345 [04:54<2:32:28,  1.00s/it]  3%|▎         | 241/9345 [04:55<2:40:02,  1.05s/it]  3%|▎         | 242/9345 [04:56<2:37:46,  1.04s/it]  3%|▎         | 243/9345 [04:57<2:36:06,  1.03s/it]  3%|▎         | 244/9345 [04:58<2:35:03,  1.02s/it]  3%|▎         | 245/9345 [04:59<2:34:05,  1.02s/it]  3%|▎         | 246/9345 [05:00<2:33:41,  1.01s/it]  3%|▎         | 247/9345 [05:01<2:33:25,  1.01s/it]  3%|▎         | 248/9345 [05:02<2:33:01,  1.01s/it]  3%|▎         | 249/9345 [05:03<2:32:58,  1.01s/it]  3%|▎         | 250/9345 [05:04<2:32:41,  1.01s/it]  3%|▎         | 251/9345 [05:05<2:32:35,  1.01s/it]  3%|▎         | 252/9345 [05:06<2:32:35,  1.01s/it]  3%|▎         | 253/9345 [05:07<2:32:27,  1.01s/it]  3%|▎         | 254/9345 [05:08<2:32:20,  1.01s/it]  3%|▎         | 255/9345 [05:09<2:32:14,  1.00s/it]  3%|▎         | 256/9345 [05:10<2:39:38,  1.05s/it]  3%|▎         | 257/9345 [05:11<2:36:59,  1.04s/it]  3%|▎         | 258/9345 [05:12<2:35:41,  1.03s/it]  3%|▎         | 259/9345 [05:13<2:34:33,  1.02s/it]  3%|▎         | 260/9345 [05:14<2:33:50,  1.02s/it]                                                    {'loss': 0.3219, 'grad_norm': 1.11290365060915, 'learning_rate': 6.955591225254148e-06, 'epoch': 0.14}
  3%|▎         | 260/9345 [05:14<2:33:50,  1.02s/it]  3%|▎         | 261/9345 [05:15<2:33:57,  1.02s/it]  3%|▎         | 262/9345 [05:16<2:33:23,  1.01s/it]  3%|▎         | 263/9345 [05:17<2:33:26,  1.01s/it]  3%|▎         | 264/9345 [05:18<2:32:59,  1.01s/it]  3%|▎         | 265/9345 [05:19<2:32:45,  1.01s/it]  3%|▎         | 266/9345 [05:20<2:32:25,  1.01s/it]  3%|▎         | 267/9345 [05:21<2:32:14,  1.01s/it]  3%|▎         | 268/9345 [05:22<2:31:59,  1.00s/it]  3%|▎         | 269/9345 [05:23<2:32:35,  1.01s/it]  3%|▎         | 270/9345 [05:24<2:32:51,  1.01s/it]  3%|▎         | 271/9345 [05:26<2:40:27,  1.06s/it]  3%|▎         | 272/9345 [05:27<2:38:13,  1.05s/it]  3%|▎         | 273/9345 [05:28<2:37:00,  1.04s/it]  3%|▎         | 274/9345 [05:29<2:35:34,  1.03s/it]  3%|▎         | 275/9345 [05:30<2:34:27,  1.02s/it]  3%|▎         | 276/9345 [05:31<2:33:48,  1.02s/it]  3%|▎         | 277/9345 [05:32<2:33:22,  1.01s/it]  3%|▎         | 278/9345 [05:33<2:33:20,  1.01s/it]  3%|▎         | 279/9345 [05:34<2:32:37,  1.01s/it]  3%|▎         | 280/9345 [05:35<2:32:37,  1.01s/it]                                                    {'loss': 0.3296, 'grad_norm': 1.0558028631157415, 'learning_rate': 7.490636704119851e-06, 'epoch': 0.15}
  3%|▎         | 280/9345 [05:35<2:32:37,  1.01s/it]  3%|▎         | 281/9345 [05:36<2:32:48,  1.01s/it]  3%|▎         | 282/9345 [05:37<2:32:36,  1.01s/it]  3%|▎         | 283/9345 [05:38<2:32:41,  1.01s/it]  3%|▎         | 284/9345 [05:39<2:32:57,  1.01s/it]  3%|▎         | 285/9345 [05:40<2:33:04,  1.01s/it]  3%|▎         | 286/9345 [05:41<2:41:50,  1.07s/it]  3%|▎         | 287/9345 [05:42<2:39:16,  1.06s/it]  3%|▎         | 288/9345 [05:43<2:37:07,  1.04s/it]  3%|▎         | 289/9345 [05:44<2:35:46,  1.03s/it]  3%|▎         | 290/9345 [05:45<2:34:55,  1.03s/it]  3%|▎         | 291/9345 [05:46<2:34:13,  1.02s/it]  3%|▎         | 292/9345 [05:47<2:33:34,  1.02s/it]  3%|▎         | 293/9345 [05:48<2:33:00,  1.01s/it]  3%|▎         | 294/9345 [05:49<2:32:39,  1.01s/it]  3%|▎         | 295/9345 [05:50<2:32:43,  1.01s/it]  3%|▎         | 296/9345 [05:51<2:33:56,  1.02s/it]  3%|▎         | 297/9345 [05:52<2:33:26,  1.02s/it]  3%|▎         | 298/9345 [05:53<2:32:48,  1.01s/it]  3%|▎         | 299/9345 [05:54<2:32:37,  1.01s/it]  3%|▎         | 300/9345 [05:55<2:39:45,  1.06s/it]                                                    {'loss': 0.331, 'grad_norm': 0.7427835055598868, 'learning_rate': 8.025682182985553e-06, 'epoch': 0.16}
  3%|▎         | 300/9345 [05:55<2:39:45,  1.06s/it][WARNING|trainer.py:3344] 2024-05-31 14:40:16,990 >>  stage3_gather_16bit_weights_on_model_save=false. Saving the full checkpoint instead, use zero_to_fp32.py to recover weights
[INFO|trainer.py:3410] 2024-05-31 14:40:16,990 >> Saving model checkpoint to ./checkpoint_dir/checkpoint-300
/opt/conda/lib/python3.10/site-packages/peft/utils/save_and_load.py:154: UserWarning: Could not find a config file in ./ - will assume that the vocabulary was not modified.
  warnings.warn(
[INFO|tokenization_utils_base.py:2513] 2024-05-31 14:40:16,996 >> tokenizer config file saved in ./checkpoint_dir/checkpoint-300/tokenizer_config.json
[INFO|tokenization_utils_base.py:2522] 2024-05-31 14:40:16,997 >> Special tokens file saved in ./checkpoint_dir/checkpoint-300/special_tokens_map.json
[2024-05-31 14:40:17,095] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step300 is about to be saved!
[2024-05-31 14:40:21,261] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-300/global_step300/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:40:21,261] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-300/global_step300/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:40:33,539] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-300/global_step300/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:40:33,886] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-300/global_step300/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:40:34,606] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-300/global_step300/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:40:34,608] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-300/global_step300/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:40:34,615] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step300 is ready now!
[2024-05-31 14:40:34,643] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step300 is about to be saved!
[2024-05-31 14:40:34,660] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-300/global_step300/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:40:34,660] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-300/global_step300/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:40:35,883] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-300/global_step300/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:40:35,885] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-300/global_step300/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:40:36,801] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-300/global_step300/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:40:36,803] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-300/global_step300/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:40:36,810] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step300 is ready now!
  3%|▎         | 301/9345 [06:16<17:35:28,  7.00s/it]  3%|▎         | 302/9345 [06:17<13:04:25,  5.20s/it]  3%|▎         | 303/9345 [06:18<9:53:54,  3.94s/it]   3%|▎         | 304/9345 [06:19<7:40:36,  3.06s/it]  3%|▎         | 305/9345 [06:20<6:07:39,  2.44s/it]  3%|▎         | 306/9345 [06:21<5:02:45,  2.01s/it]  3%|▎         | 307/9345 [06:22<4:17:11,  1.71s/it]  3%|▎         | 308/9345 [06:23<3:45:25,  1.50s/it]  3%|▎         | 309/9345 [06:24<3:22:46,  1.35s/it]  3%|▎         | 310/9345 [06:25<3:07:19,  1.24s/it]  3%|▎         | 311/9345 [06:26<2:56:50,  1.17s/it]  3%|▎         | 312/9345 [06:27<2:49:51,  1.13s/it]  3%|▎         | 313/9345 [06:28<2:44:09,  1.09s/it]  3%|▎         | 314/9345 [06:29<2:48:03,  1.12s/it]  3%|▎         | 315/9345 [06:30<2:42:58,  1.08s/it]  3%|▎         | 316/9345 [06:31<2:39:30,  1.06s/it]  3%|▎         | 317/9345 [06:32<2:37:02,  1.04s/it]  3%|▎         | 318/9345 [06:33<2:35:05,  1.03s/it]  3%|▎         | 319/9345 [06:34<2:34:42,  1.03s/it]  3%|▎         | 320/9345 [06:35<2:34:00,  1.02s/it]                                                    {'loss': 0.339, 'grad_norm': 0.6896295527073953, 'learning_rate': 8.560727661851258e-06, 'epoch': 0.17}
  3%|▎         | 320/9345 [06:35<2:34:00,  1.02s/it]  3%|▎         | 321/9345 [06:37<2:34:28,  1.03s/it]  3%|▎         | 322/9345 [06:38<2:34:17,  1.03s/it]  3%|▎         | 323/9345 [06:39<2:33:14,  1.02s/it]  3%|▎         | 324/9345 [06:40<2:32:33,  1.01s/it]  3%|▎         | 325/9345 [06:41<2:32:15,  1.01s/it]  3%|▎         | 326/9345 [06:42<2:32:11,  1.01s/it]  3%|▎         | 327/9345 [06:43<2:32:00,  1.01s/it]  4%|▎         | 328/9345 [06:44<2:39:35,  1.06s/it]  4%|▎         | 329/9345 [06:45<2:36:35,  1.04s/it]  4%|▎         | 330/9345 [06:46<2:34:38,  1.03s/it]  4%|▎         | 331/9345 [06:47<2:41:17,  1.07s/it]  4%|▎         | 332/9345 [06:48<2:39:13,  1.06s/it]  4%|▎         | 333/9345 [06:49<2:37:14,  1.05s/it]  4%|▎         | 334/9345 [06:50<2:45:24,  1.10s/it]  4%|▎         | 335/9345 [06:53<3:55:40,  1.57s/it]  4%|▎         | 336/9345 [06:55<4:13:23,  1.69s/it]  4%|▎         | 337/9345 [06:58<5:19:18,  2.13s/it]  4%|▎         | 338/9345 [07:00<4:53:33,  1.96s/it]  4%|▎         | 339/9345 [07:04<6:47:41,  2.72s/it]  4%|▎         | 340/9345 [07:05<5:31:22,  2.21s/it]                                                    {'loss': 0.3442, 'grad_norm': 0.5721483931705464, 'learning_rate': 9.095773140716961e-06, 'epoch': 0.18}
  4%|▎         | 340/9345 [07:05<5:31:22,  2.21s/it]  4%|▎         | 341/9345 [07:06<4:37:49,  1.85s/it]  4%|▎         | 342/9345 [07:07<4:00:21,  1.60s/it]  4%|▎         | 343/9345 [07:08<3:43:21,  1.49s/it]  4%|▎         | 344/9345 [07:10<3:34:18,  1.43s/it]  4%|▎         | 345/9345 [07:11<3:17:53,  1.32s/it]  4%|▎         | 346/9345 [07:12<3:03:59,  1.23s/it]  4%|▎         | 347/9345 [07:13<2:53:28,  1.16s/it]  4%|▎         | 348/9345 [07:14<2:45:38,  1.10s/it]  4%|▎         | 349/9345 [07:15<2:40:22,  1.07s/it]  4%|▎         | 350/9345 [07:16<2:36:39,  1.04s/it]  4%|▍         | 351/9345 [07:17<2:34:11,  1.03s/it]  4%|▍         | 352/9345 [07:18<2:32:23,  1.02s/it]  4%|▍         | 353/9345 [07:19<2:30:46,  1.01s/it]  4%|▍         | 354/9345 [07:20<2:29:43,  1.00it/s]  4%|▍         | 355/9345 [07:21<2:29:01,  1.01it/s]  4%|▍         | 356/9345 [07:22<2:28:54,  1.01it/s]  4%|▍         | 357/9345 [07:23<2:29:12,  1.00it/s]  4%|▍         | 358/9345 [07:24<2:37:09,  1.05s/it]  4%|▍         | 359/9345 [07:25<2:35:31,  1.04s/it]  4%|▍         | 360/9345 [07:26<2:34:09,  1.03s/it]                                                    {'loss': 0.3268, 'grad_norm': 1.046815916429509, 'learning_rate': 9.630818619582665e-06, 'epoch': 0.19}
  4%|▍         | 360/9345 [07:26<2:34:09,  1.03s/it]  4%|▍         | 361/9345 [07:27<2:33:57,  1.03s/it]  4%|▍         | 362/9345 [07:28<2:33:05,  1.02s/it]  4%|▍         | 363/9345 [07:29<2:32:48,  1.02s/it]  4%|▍         | 364/9345 [07:30<2:32:10,  1.02s/it]  4%|▍         | 365/9345 [07:31<2:31:46,  1.01s/it]  4%|▍         | 366/9345 [07:32<2:32:00,  1.02s/it]  4%|▍         | 367/9345 [07:33<2:32:02,  1.02s/it]  4%|▍         | 368/9345 [07:34<2:30:53,  1.01s/it]  4%|▍         | 369/9345 [07:35<2:30:51,  1.01s/it]  4%|▍         | 370/9345 [07:36<2:30:42,  1.01s/it]  4%|▍         | 371/9345 [07:37<2:30:50,  1.01s/it]  4%|▍         | 372/9345 [07:38<2:31:29,  1.01s/it]  4%|▍         | 373/9345 [07:39<2:38:10,  1.06s/it]  4%|▍         | 374/9345 [07:40<2:35:38,  1.04s/it]  4%|▍         | 375/9345 [07:41<2:34:13,  1.03s/it]  4%|▍         | 376/9345 [07:42<2:33:02,  1.02s/it]  4%|▍         | 377/9345 [07:43<2:32:25,  1.02s/it]  4%|▍         | 378/9345 [07:44<2:31:57,  1.02s/it]  4%|▍         | 379/9345 [07:45<2:31:49,  1.02s/it]  4%|▍         | 380/9345 [07:46<2:31:24,  1.01s/it]                                                    {'loss': 0.2952, 'grad_norm': 0.5152642402234666, 'learning_rate': 1.016586409844837e-05, 'epoch': 0.2}
  4%|▍         | 380/9345 [07:46<2:31:24,  1.01s/it]  4%|▍         | 381/9345 [07:47<2:32:18,  1.02s/it]  4%|▍         | 382/9345 [07:48<2:31:50,  1.02s/it]  4%|▍         | 383/9345 [07:49<2:31:28,  1.01s/it]  4%|▍         | 384/9345 [07:50<2:31:44,  1.02s/it]  4%|▍         | 385/9345 [07:51<2:31:42,  1.02s/it]  4%|▍         | 386/9345 [07:52<2:31:08,  1.01s/it]  4%|▍         | 387/9345 [07:53<2:38:12,  1.06s/it]  4%|▍         | 388/9345 [07:54<2:35:53,  1.04s/it]  4%|▍         | 389/9345 [07:55<2:34:15,  1.03s/it]  4%|▍         | 390/9345 [07:56<2:32:57,  1.02s/it]  4%|▍         | 391/9345 [07:57<2:32:21,  1.02s/it]  4%|▍         | 392/9345 [07:58<2:31:15,  1.01s/it]  4%|▍         | 393/9345 [07:59<2:31:43,  1.02s/it]  4%|▍         | 394/9345 [08:00<2:31:37,  1.02s/it]  4%|▍         | 395/9345 [08:01<2:31:24,  1.01s/it]  4%|▍         | 396/9345 [08:02<2:30:44,  1.01s/it]  4%|▍         | 397/9345 [08:03<2:31:05,  1.01s/it]  4%|▍         | 398/9345 [08:04<2:31:18,  1.01s/it]  4%|▍         | 399/9345 [08:05<2:31:07,  1.01s/it]  4%|▍         | 400/9345 [08:06<2:30:40,  1.01s/it]                                                    {'loss': 0.3206, 'grad_norm': 0.6264896298679056, 'learning_rate': 1.0700909577314073e-05, 'epoch': 0.21}
  4%|▍         | 400/9345 [08:06<2:30:40,  1.01s/it][WARNING|trainer.py:3344] 2024-05-31 14:42:28,159 >>  stage3_gather_16bit_weights_on_model_save=false. Saving the full checkpoint instead, use zero_to_fp32.py to recover weights
[INFO|trainer.py:3410] 2024-05-31 14:42:28,159 >> Saving model checkpoint to ./checkpoint_dir/checkpoint-400
/opt/conda/lib/python3.10/site-packages/peft/utils/save_and_load.py:154: UserWarning: Could not find a config file in ./ - will assume that the vocabulary was not modified.
  warnings.warn(
[INFO|tokenization_utils_base.py:2513] 2024-05-31 14:42:28,181 >> tokenizer config file saved in ./checkpoint_dir/checkpoint-400/tokenizer_config.json
[INFO|tokenization_utils_base.py:2522] 2024-05-31 14:42:28,182 >> Special tokens file saved in ./checkpoint_dir/checkpoint-400/special_tokens_map.json
[2024-05-31 14:42:28,276] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step400 is about to be saved!
[2024-05-31 14:42:32,439] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-400/global_step400/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:42:32,439] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-400/global_step400/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:42:44,915] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-400/global_step400/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:42:45,267] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-400/global_step400/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:42:45,949] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-400/global_step400/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:42:45,951] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-400/global_step400/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:42:45,959] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step400 is ready now!
[2024-05-31 14:42:45,989] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step400 is about to be saved!
[2024-05-31 14:42:46,006] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-400/global_step400/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:42:46,006] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-400/global_step400/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:42:47,250] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-400/global_step400/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:42:47,251] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-400/global_step400/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:42:48,001] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-400/global_step400/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:42:48,003] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-400/global_step400/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:42:48,010] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step400 is ready now!
[INFO|trainer.py:3502] 2024-05-31 14:42:48,016 >> Deleting older checkpoint [checkpoint_dir/checkpoint-300] due to args.save_total_limit
  4%|▍         | 401/9345 [08:28<17:29:57,  7.04s/it]  4%|▍         | 402/9345 [08:29<13:00:05,  5.23s/it]  4%|▍         | 403/9345 [08:30<9:51:07,  3.97s/it]   4%|▍         | 404/9345 [08:31<7:38:55,  3.08s/it]  4%|▍         | 405/9345 [08:32<6:05:38,  2.45s/it]  4%|▍         | 406/9345 [08:33<5:00:32,  2.02s/it]  4%|▍         | 407/9345 [08:34<4:15:28,  1.71s/it]  4%|▍         | 408/9345 [08:35<3:44:14,  1.51s/it]  4%|▍         | 409/9345 [08:36<3:21:38,  1.35s/it]  4%|▍         | 410/9345 [08:37<3:05:53,  1.25s/it]  4%|▍         | 411/9345 [08:38<2:55:22,  1.18s/it]  4%|▍         | 412/9345 [08:39<2:47:49,  1.13s/it]  4%|▍         | 413/9345 [08:40<2:42:31,  1.09s/it]  4%|▍         | 414/9345 [08:41<2:39:32,  1.07s/it]  4%|▍         | 415/9345 [08:42<2:36:35,  1.05s/it]  4%|▍         | 416/9345 [08:43<2:42:29,  1.09s/it]  4%|▍         | 417/9345 [08:44<2:39:12,  1.07s/it]  4%|▍         | 418/9345 [08:45<2:36:53,  1.05s/it]  4%|▍         | 419/9345 [08:46<2:35:08,  1.04s/it]  4%|▍         | 420/9345 [08:47<2:33:40,  1.03s/it]                                                    {'loss': 0.3157, 'grad_norm': 0.8611921401331734, 'learning_rate': 1.1235955056179776e-05, 'epoch': 0.22}
  4%|▍         | 420/9345 [08:47<2:33:40,  1.03s/it]  5%|▍         | 421/9345 [08:48<2:33:19,  1.03s/it]  5%|▍         | 422/9345 [08:49<2:32:20,  1.02s/it]  5%|▍         | 423/9345 [08:50<2:31:31,  1.02s/it]  5%|▍         | 424/9345 [08:51<2:30:49,  1.01s/it]  5%|▍         | 425/9345 [08:52<2:30:44,  1.01s/it]  5%|▍         | 426/9345 [08:53<2:30:45,  1.01s/it]  5%|▍         | 427/9345 [08:54<2:30:41,  1.01s/it]  5%|▍         | 428/9345 [08:55<2:30:45,  1.01s/it]  5%|▍         | 429/9345 [08:56<2:30:36,  1.01s/it]  5%|▍         | 430/9345 [08:57<2:30:22,  1.01s/it]  5%|▍         | 431/9345 [08:58<2:38:53,  1.07s/it]  5%|▍         | 432/9345 [08:59<2:35:56,  1.05s/it]  5%|▍         | 433/9345 [09:00<2:34:33,  1.04s/it]  5%|▍         | 434/9345 [09:01<2:33:27,  1.03s/it]  5%|▍         | 435/9345 [09:02<2:32:20,  1.03s/it]  5%|▍         | 436/9345 [09:03<2:31:11,  1.02s/it]  5%|▍         | 437/9345 [09:04<2:30:48,  1.02s/it]  5%|▍         | 438/9345 [09:05<2:30:41,  1.02s/it]  5%|▍         | 439/9345 [09:06<2:30:42,  1.02s/it]  5%|▍         | 440/9345 [09:07<2:30:38,  1.01s/it]                                                    {'loss': 0.3238, 'grad_norm': 0.8629444227648931, 'learning_rate': 1.177100053504548e-05, 'epoch': 0.24}
  5%|▍         | 440/9345 [09:07<2:30:38,  1.01s/it]  5%|▍         | 441/9345 [09:08<2:30:37,  1.01s/it]  5%|▍         | 442/9345 [09:09<2:30:15,  1.01s/it]  5%|▍         | 443/9345 [09:10<2:30:11,  1.01s/it]  5%|▍         | 444/9345 [09:11<2:29:47,  1.01s/it]  5%|▍         | 445/9345 [09:13<2:36:41,  1.06s/it]  5%|▍         | 446/9345 [09:14<2:34:10,  1.04s/it]  5%|▍         | 447/9345 [09:15<2:33:11,  1.03s/it]  5%|▍         | 448/9345 [09:16<2:32:11,  1.03s/it]  5%|▍         | 449/9345 [09:17<2:31:39,  1.02s/it]  5%|▍         | 450/9345 [09:18<2:31:10,  1.02s/it]  5%|▍         | 451/9345 [09:19<2:31:09,  1.02s/it]  5%|▍         | 452/9345 [09:20<2:30:36,  1.02s/it]  5%|▍         | 453/9345 [09:21<2:30:00,  1.01s/it]  5%|▍         | 454/9345 [09:22<2:29:22,  1.01s/it]  5%|▍         | 455/9345 [09:23<2:29:53,  1.01s/it]  5%|▍         | 456/9345 [09:24<2:29:43,  1.01s/it]  5%|▍         | 457/9345 [09:25<2:29:44,  1.01s/it]  5%|▍         | 458/9345 [09:26<2:29:56,  1.01s/it]  5%|▍         | 459/9345 [09:27<2:29:27,  1.01s/it]  5%|▍         | 460/9345 [09:28<2:38:20,  1.07s/it]                                                    {'loss': 0.2907, 'grad_norm': 0.5254225037536541, 'learning_rate': 1.2306046013911184e-05, 'epoch': 0.25}
  5%|▍         | 460/9345 [09:28<2:38:20,  1.07s/it]  5%|▍         | 461/9345 [09:29<2:36:31,  1.06s/it]  5%|▍         | 462/9345 [09:30<2:34:47,  1.05s/it]  5%|▍         | 463/9345 [09:31<2:33:18,  1.04s/it]  5%|▍         | 464/9345 [09:32<2:32:25,  1.03s/it]  5%|▍         | 465/9345 [09:33<2:31:41,  1.02s/it]  5%|▍         | 466/9345 [09:34<2:31:42,  1.03s/it]  5%|▍         | 467/9345 [09:35<2:31:31,  1.02s/it]  5%|▌         | 468/9345 [09:36<2:31:19,  1.02s/it]  5%|▌         | 469/9345 [09:37<2:31:13,  1.02s/it]  5%|▌         | 470/9345 [09:38<2:31:13,  1.02s/it]  5%|▌         | 471/9345 [09:39<2:30:53,  1.02s/it]  5%|▌         | 472/9345 [09:40<2:29:58,  1.01s/it]  5%|▌         | 473/9345 [09:41<2:29:41,  1.01s/it]  5%|▌         | 474/9345 [09:42<2:37:31,  1.07s/it]  5%|▌         | 475/9345 [09:43<2:34:55,  1.05s/it]  5%|▌         | 476/9345 [09:44<2:33:02,  1.04s/it]  5%|▌         | 477/9345 [09:45<2:31:58,  1.03s/it]  5%|▌         | 478/9345 [09:46<2:32:04,  1.03s/it]  5%|▌         | 479/9345 [09:47<2:31:33,  1.03s/it]  5%|▌         | 480/9345 [09:48<2:30:27,  1.02s/it]                                                    {'loss': 0.2966, 'grad_norm': 0.5593507947869228, 'learning_rate': 1.2841091492776886e-05, 'epoch': 0.26}
  5%|▌         | 480/9345 [09:48<2:30:27,  1.02s/it]  5%|▌         | 481/9345 [09:49<2:30:25,  1.02s/it]  5%|▌         | 482/9345 [09:50<2:29:56,  1.02s/it]  5%|▌         | 483/9345 [09:51<2:29:59,  1.02s/it]  5%|▌         | 484/9345 [09:52<2:29:57,  1.02s/it]  5%|▌         | 485/9345 [09:54<2:29:54,  1.02s/it]  5%|▌         | 486/9345 [09:55<2:30:06,  1.02s/it]  5%|▌         | 487/9345 [09:56<2:29:40,  1.01s/it]  5%|▌         | 488/9345 [09:57<2:29:51,  1.02s/it]  5%|▌         | 489/9345 [09:58<2:37:40,  1.07s/it]  5%|▌         | 490/9345 [09:59<2:35:17,  1.05s/it]  5%|▌         | 491/9345 [10:00<2:33:41,  1.04s/it]  5%|▌         | 492/9345 [10:01<2:31:51,  1.03s/it]  5%|▌         | 493/9345 [10:02<2:30:39,  1.02s/it]  5%|▌         | 494/9345 [10:03<2:30:13,  1.02s/it]  5%|▌         | 495/9345 [10:04<2:30:08,  1.02s/it]  5%|▌         | 496/9345 [10:05<2:30:04,  1.02s/it]  5%|▌         | 497/9345 [10:06<2:30:14,  1.02s/it]  5%|▌         | 498/9345 [10:07<2:30:07,  1.02s/it]  5%|▌         | 499/9345 [10:08<2:30:12,  1.02s/it]  5%|▌         | 500/9345 [10:09<2:29:11,  1.01s/it]                                                    {'loss': 0.2884, 'grad_norm': 0.7100009779979888, 'learning_rate': 1.3376136971642592e-05, 'epoch': 0.27}
  5%|▌         | 500/9345 [10:09<2:29:11,  1.01s/it][WARNING|trainer.py:3344] 2024-05-31 14:44:30,556 >>  stage3_gather_16bit_weights_on_model_save=false. Saving the full checkpoint instead, use zero_to_fp32.py to recover weights
[INFO|trainer.py:3410] 2024-05-31 14:44:30,556 >> Saving model checkpoint to ./checkpoint_dir/checkpoint-500
/opt/conda/lib/python3.10/site-packages/peft/utils/save_and_load.py:154: UserWarning: Could not find a config file in ./ - will assume that the vocabulary was not modified.
  warnings.warn(
[INFO|tokenization_utils_base.py:2513] 2024-05-31 14:44:30,580 >> tokenizer config file saved in ./checkpoint_dir/checkpoint-500/tokenizer_config.json
[INFO|tokenization_utils_base.py:2522] 2024-05-31 14:44:30,581 >> Special tokens file saved in ./checkpoint_dir/checkpoint-500/special_tokens_map.json
[2024-05-31 14:44:30,670] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step500 is about to be saved!
[2024-05-31 14:44:34,817] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-500/global_step500/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:44:34,817] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-500/global_step500/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:44:47,380] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-500/global_step500/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:44:47,719] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-500/global_step500/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:44:48,371] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-500/global_step500/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:44:48,373] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-500/global_step500/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:44:48,376] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step500 is ready now!
[2024-05-31 14:44:48,405] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step500 is about to be saved!
[2024-05-31 14:44:48,422] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-500/global_step500/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:44:48,422] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-500/global_step500/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:44:49,633] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-500/global_step500/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:44:49,634] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-500/global_step500/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:44:50,405] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-500/global_step500/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:44:50,407] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-500/global_step500/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:44:50,413] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step500 is ready now!
[INFO|trainer.py:3502] 2024-05-31 14:44:50,419 >> Deleting older checkpoint [checkpoint_dir/checkpoint-400] due to args.save_total_limit
  5%|▌         | 501/9345 [10:30<17:10:34,  6.99s/it]  5%|▌         | 502/9345 [10:31<12:46:35,  5.20s/it]  5%|▌         | 503/9345 [10:32<9:41:08,  3.94s/it]   5%|▌         | 504/9345 [10:33<7:40:40,  3.13s/it]  5%|▌         | 505/9345 [10:34<6:07:37,  2.50s/it]  5%|▌         | 506/9345 [10:35<5:02:36,  2.05s/it]  5%|▌         | 507/9345 [10:36<4:16:52,  1.74s/it]  5%|▌         | 508/9345 [10:37<3:44:39,  1.53s/it]  5%|▌         | 509/9345 [10:38<3:22:47,  1.38s/it]  5%|▌         | 510/9345 [10:39<3:06:42,  1.27s/it]  5%|▌         | 511/9345 [10:40<2:55:03,  1.19s/it]  5%|▌         | 512/9345 [10:41<2:46:59,  1.13s/it]  5%|▌         | 513/9345 [10:42<2:41:44,  1.10s/it]  6%|▌         | 514/9345 [10:43<2:37:53,  1.07s/it]  6%|▌         | 515/9345 [10:44<2:35:37,  1.06s/it]  6%|▌         | 516/9345 [10:45<2:34:14,  1.05s/it]  6%|▌         | 517/9345 [10:46<2:32:51,  1.04s/it]  6%|▌         | 518/9345 [10:48<2:41:10,  1.10s/it]  6%|▌         | 519/9345 [10:49<2:37:27,  1.07s/it]  6%|▌         | 520/9345 [10:50<2:34:53,  1.05s/it]                                                    {'loss': 0.3188, 'grad_norm': 0.6519567052644376, 'learning_rate': 1.3911182450508296e-05, 'epoch': 0.28}
  6%|▌         | 520/9345 [10:50<2:34:53,  1.05s/it]  6%|▌         | 521/9345 [10:51<2:33:42,  1.05s/it]  6%|▌         | 522/9345 [10:52<2:32:04,  1.03s/it]  6%|▌         | 523/9345 [10:53<2:31:13,  1.03s/it]  6%|▌         | 524/9345 [10:54<2:30:40,  1.02s/it]  6%|▌         | 525/9345 [10:55<2:30:38,  1.02s/it]  6%|▌         | 526/9345 [10:56<2:30:18,  1.02s/it]  6%|▌         | 527/9345 [10:57<2:29:54,  1.02s/it]  6%|▌         | 528/9345 [10:58<2:29:51,  1.02s/it]  6%|▌         | 529/9345 [10:59<2:29:41,  1.02s/it]  6%|▌         | 530/9345 [11:00<2:29:22,  1.02s/it]  6%|▌         | 531/9345 [11:01<2:29:11,  1.02s/it]  6%|▌         | 532/9345 [11:02<2:28:55,  1.01s/it]  6%|▌         | 533/9345 [11:03<2:36:19,  1.06s/it]  6%|▌         | 534/9345 [11:04<2:33:49,  1.05s/it]  6%|▌         | 535/9345 [11:05<2:32:51,  1.04s/it]  6%|▌         | 536/9345 [11:06<2:31:57,  1.04s/it]  6%|▌         | 537/9345 [11:07<2:31:07,  1.03s/it]  6%|▌         | 538/9345 [11:08<2:30:51,  1.03s/it]  6%|▌         | 539/9345 [11:09<2:30:16,  1.02s/it]  6%|▌         | 540/9345 [11:10<2:30:10,  1.02s/it]                                                    {'loss': 0.3022, 'grad_norm': 0.5911698136677253, 'learning_rate': 1.4446227929373999e-05, 'epoch': 0.29}
  6%|▌         | 540/9345 [11:10<2:30:10,  1.02s/it]  6%|▌         | 541/9345 [11:11<2:30:17,  1.02s/it]  6%|▌         | 542/9345 [11:12<2:29:43,  1.02s/it]  6%|▌         | 543/9345 [11:13<2:29:22,  1.02s/it]  6%|▌         | 544/9345 [11:14<2:29:06,  1.02s/it]  6%|▌         | 545/9345 [11:15<2:29:25,  1.02s/it]  6%|▌         | 546/9345 [11:16<2:29:01,  1.02s/it]  6%|▌         | 547/9345 [11:17<2:36:17,  1.07s/it]  6%|▌         | 548/9345 [11:18<2:34:02,  1.05s/it]  6%|▌         | 549/9345 [11:19<2:33:07,  1.04s/it]  6%|▌         | 550/9345 [11:20<2:31:56,  1.04s/it]  6%|▌         | 551/9345 [11:21<2:31:00,  1.03s/it]  6%|▌         | 552/9345 [11:22<2:30:11,  1.02s/it]  6%|▌         | 553/9345 [11:23<2:29:56,  1.02s/it]  6%|▌         | 554/9345 [11:24<2:29:28,  1.02s/it]  6%|▌         | 555/9345 [11:26<2:29:59,  1.02s/it]  6%|▌         | 556/9345 [11:27<2:30:08,  1.02s/it]  6%|▌         | 557/9345 [11:28<2:30:16,  1.03s/it]  6%|▌         | 558/9345 [11:29<2:30:33,  1.03s/it]  6%|▌         | 559/9345 [11:30<2:30:06,  1.03s/it]  6%|▌         | 560/9345 [11:31<2:30:10,  1.03s/it]                                                    {'loss': 0.3149, 'grad_norm': 0.4943447220203742, 'learning_rate': 1.4981273408239702e-05, 'epoch': 0.3}
  6%|▌         | 560/9345 [11:31<2:30:10,  1.03s/it]  6%|▌         | 561/9345 [11:32<2:29:56,  1.02s/it]  6%|▌         | 562/9345 [11:33<2:38:34,  1.08s/it]  6%|▌         | 563/9345 [11:34<2:35:37,  1.06s/it]  6%|▌         | 564/9345 [11:35<2:33:52,  1.05s/it]  6%|▌         | 565/9345 [11:36<2:32:29,  1.04s/it]  6%|▌         | 566/9345 [11:37<2:32:00,  1.04s/it]  6%|▌         | 567/9345 [11:38<2:31:42,  1.04s/it]  6%|▌         | 568/9345 [11:39<2:31:05,  1.03s/it]  6%|▌         | 569/9345 [11:40<2:31:02,  1.03s/it]  6%|▌         | 570/9345 [11:41<2:30:25,  1.03s/it]  6%|▌         | 571/9345 [11:42<2:29:58,  1.03s/it]  6%|▌         | 572/9345 [11:43<2:29:36,  1.02s/it]  6%|▌         | 573/9345 [11:44<2:29:17,  1.02s/it]  6%|▌         | 574/9345 [11:45<2:29:25,  1.02s/it]  6%|▌         | 575/9345 [11:46<2:29:41,  1.02s/it]  6%|▌         | 576/9345 [11:47<2:37:22,  1.08s/it]  6%|▌         | 577/9345 [11:48<2:34:47,  1.06s/it]  6%|▌         | 578/9345 [11:49<2:33:04,  1.05s/it]  6%|▌         | 579/9345 [11:50<2:31:50,  1.04s/it]  6%|▌         | 580/9345 [11:51<2:30:36,  1.03s/it]                                                    {'loss': 0.2878, 'grad_norm': 0.5095092031986742, 'learning_rate': 1.5516318887105404e-05, 'epoch': 0.31}
  6%|▌         | 580/9345 [11:51<2:30:36,  1.03s/it]  6%|▌         | 581/9345 [11:52<2:29:57,  1.03s/it]  6%|▌         | 582/9345 [11:53<2:29:25,  1.02s/it]  6%|▌         | 583/9345 [11:55<2:28:46,  1.02s/it]  6%|▌         | 584/9345 [11:56<2:28:30,  1.02s/it]  6%|▋         | 585/9345 [11:57<2:28:48,  1.02s/it]  6%|▋         | 586/9345 [11:58<2:28:50,  1.02s/it]  6%|▋         | 587/9345 [11:59<2:28:23,  1.02s/it]  6%|▋         | 588/9345 [12:00<2:28:03,  1.01s/it]  6%|▋         | 589/9345 [12:01<2:28:04,  1.01s/it]  6%|▋         | 590/9345 [12:02<2:28:05,  1.01s/it]  6%|▋         | 591/9345 [12:03<2:35:00,  1.06s/it]  6%|▋         | 592/9345 [12:04<2:32:46,  1.05s/it]  6%|▋         | 593/9345 [12:05<2:31:08,  1.04s/it]  6%|▋         | 594/9345 [12:06<2:30:44,  1.03s/it]  6%|▋         | 595/9345 [12:07<2:30:02,  1.03s/it]  6%|▋         | 596/9345 [12:08<2:29:44,  1.03s/it]  6%|▋         | 597/9345 [12:09<2:29:09,  1.02s/it]  6%|▋         | 598/9345 [12:10<2:28:59,  1.02s/it]  6%|▋         | 599/9345 [12:11<2:28:30,  1.02s/it]  6%|▋         | 600/9345 [12:12<2:28:28,  1.02s/it]                                                    {'loss': 0.276, 'grad_norm': 0.6312883903579384, 'learning_rate': 1.6051364365971107e-05, 'epoch': 0.32}
  6%|▋         | 600/9345 [12:12<2:28:28,  1.02s/it][WARNING|trainer.py:3344] 2024-05-31 14:46:33,599 >>  stage3_gather_16bit_weights_on_model_save=false. Saving the full checkpoint instead, use zero_to_fp32.py to recover weights
[INFO|trainer.py:3410] 2024-05-31 14:46:33,599 >> Saving model checkpoint to ./checkpoint_dir/checkpoint-600
/opt/conda/lib/python3.10/site-packages/peft/utils/save_and_load.py:154: UserWarning: Could not find a config file in ./ - will assume that the vocabulary was not modified.
  warnings.warn(
[INFO|tokenization_utils_base.py:2513] 2024-05-31 14:46:33,619 >> tokenizer config file saved in ./checkpoint_dir/checkpoint-600/tokenizer_config.json
[INFO|tokenization_utils_base.py:2522] 2024-05-31 14:46:33,619 >> Special tokens file saved in ./checkpoint_dir/checkpoint-600/special_tokens_map.json
[2024-05-31 14:46:33,717] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step600 is about to be saved!
[2024-05-31 14:46:37,805] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-600/global_step600/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:46:37,805] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-600/global_step600/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:46:50,217] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-600/global_step600/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:46:50,533] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-600/global_step600/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:46:51,144] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-600/global_step600/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:46:51,146] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-600/global_step600/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:46:51,150] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step600 is ready now!
[2024-05-31 14:46:51,180] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step600 is about to be saved!
[2024-05-31 14:46:51,196] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-600/global_step600/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:46:51,196] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-600/global_step600/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:46:52,406] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-600/global_step600/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:46:52,407] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-600/global_step600/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:46:53,184] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-600/global_step600/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:46:53,186] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-600/global_step600/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:46:53,190] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step600 is ready now!
[INFO|trainer.py:3502] 2024-05-31 14:46:53,197 >> Deleting older checkpoint [checkpoint_dir/checkpoint-500] due to args.save_total_limit
  6%|▋         | 601/9345 [12:33<16:48:21,  6.92s/it]  6%|▋         | 602/9345 [12:34<12:30:20,  5.15s/it]  6%|▋         | 603/9345 [12:35<9:29:59,  3.91s/it]   6%|▋         | 604/9345 [12:36<7:23:57,  3.05s/it]  6%|▋         | 605/9345 [12:37<6:04:37,  2.50s/it]  6%|▋         | 606/9345 [12:38<5:00:06,  2.06s/it]  6%|▋         | 607/9345 [12:39<4:14:48,  1.75s/it]  7%|▋         | 608/9345 [12:40<3:43:04,  1.53s/it]  7%|▋         | 609/9345 [12:41<3:20:49,  1.38s/it]  7%|▋         | 610/9345 [12:42<3:05:10,  1.27s/it]  7%|▋         | 611/9345 [12:43<2:54:05,  1.20s/it]  7%|▋         | 612/9345 [12:44<2:46:45,  1.15s/it]  7%|▋         | 613/9345 [12:45<2:41:28,  1.11s/it]  7%|▋         | 614/9345 [12:46<2:37:52,  1.08s/it]  7%|▋         | 615/9345 [12:47<2:35:00,  1.07s/it]  7%|▋         | 616/9345 [12:48<2:33:10,  1.05s/it]  7%|▋         | 617/9345 [12:49<2:31:54,  1.04s/it]  7%|▋         | 618/9345 [12:50<2:31:00,  1.04s/it]  7%|▋         | 619/9345 [12:51<2:30:12,  1.03s/it]  7%|▋         | 620/9345 [12:52<2:36:59,  1.08s/it]                                                    {'loss': 0.2879, 'grad_norm': 1.004315234739639, 'learning_rate': 1.658640984483681e-05, 'epoch': 0.33}
  7%|▋         | 620/9345 [12:52<2:36:59,  1.08s/it]  7%|▋         | 621/9345 [12:53<2:35:12,  1.07s/it]  7%|▋         | 622/9345 [12:55<2:33:11,  1.05s/it]  7%|▋         | 623/9345 [12:56<2:31:47,  1.04s/it]  7%|▋         | 624/9345 [12:57<2:30:53,  1.04s/it]  7%|▋         | 625/9345 [12:58<2:29:42,  1.03s/it]  7%|▋         | 626/9345 [12:59<2:28:45,  1.02s/it]  7%|▋         | 627/9345 [13:00<2:28:22,  1.02s/it]  7%|▋         | 628/9345 [13:01<2:28:06,  1.02s/it]  7%|▋         | 629/9345 [13:02<2:27:55,  1.02s/it]  7%|▋         | 630/9345 [13:03<2:27:39,  1.02s/it]  7%|▋         | 631/9345 [13:04<2:27:40,  1.02s/it]  7%|▋         | 632/9345 [13:05<2:27:18,  1.01s/it]  7%|▋         | 633/9345 [13:06<2:27:23,  1.02s/it]  7%|▋         | 634/9345 [13:07<2:36:32,  1.08s/it]  7%|▋         | 635/9345 [13:08<2:33:51,  1.06s/it]  7%|▋         | 636/9345 [13:09<2:31:44,  1.05s/it]  7%|▋         | 637/9345 [13:10<2:30:17,  1.04s/it]  7%|▋         | 638/9345 [13:11<2:29:10,  1.03s/it]  7%|▋         | 639/9345 [13:12<2:29:12,  1.03s/it]  7%|▋         | 640/9345 [13:13<2:28:58,  1.03s/it]                                                    {'loss': 0.2939, 'grad_norm': 0.6518839278972317, 'learning_rate': 1.7121455323702517e-05, 'epoch': 0.34}
  7%|▋         | 640/9345 [13:13<2:28:58,  1.03s/it]  7%|▋         | 641/9345 [13:14<2:28:47,  1.03s/it]  7%|▋         | 642/9345 [13:15<2:28:25,  1.02s/it]  7%|▋         | 643/9345 [13:16<2:28:33,  1.02s/it]  7%|▋         | 644/9345 [13:17<2:28:45,  1.03s/it]  7%|▋         | 645/9345 [13:18<2:28:37,  1.03s/it]  7%|▋         | 646/9345 [13:19<2:28:26,  1.02s/it]  7%|▋         | 647/9345 [13:20<2:28:00,  1.02s/it]  7%|▋         | 648/9345 [13:21<2:27:31,  1.02s/it]  7%|▋         | 649/9345 [13:22<2:35:02,  1.07s/it]  7%|▋         | 650/9345 [13:23<2:32:52,  1.05s/it]  7%|▋         | 651/9345 [13:24<2:30:52,  1.04s/it]  7%|▋         | 652/9345 [13:25<2:29:53,  1.03s/it]  7%|▋         | 653/9345 [13:26<2:29:08,  1.03s/it]  7%|▋         | 654/9345 [13:27<2:28:48,  1.03s/it]  7%|▋         | 655/9345 [13:28<2:28:30,  1.03s/it]  7%|▋         | 656/9345 [13:29<2:27:49,  1.02s/it]  7%|▋         | 657/9345 [13:30<2:27:31,  1.02s/it]  7%|▋         | 658/9345 [13:32<2:27:07,  1.02s/it]  7%|▋         | 659/9345 [13:33<2:27:17,  1.02s/it]  7%|▋         | 660/9345 [13:34<2:27:05,  1.02s/it]                                                    {'loss': 0.293, 'grad_norm': 0.42326787879140443, 'learning_rate': 1.765650080256822e-05, 'epoch': 0.35}
  7%|▋         | 660/9345 [13:34<2:27:05,  1.02s/it]  7%|▋         | 661/9345 [13:35<2:27:45,  1.02s/it]  7%|▋         | 662/9345 [13:36<2:27:25,  1.02s/it]  7%|▋         | 663/9345 [13:37<2:36:02,  1.08s/it]  7%|▋         | 664/9345 [13:38<2:33:17,  1.06s/it]  7%|▋         | 665/9345 [13:39<2:31:14,  1.05s/it]  7%|▋         | 666/9345 [13:40<2:30:05,  1.04s/it]  7%|▋         | 667/9345 [13:41<2:29:30,  1.03s/it]  7%|▋         | 668/9345 [13:42<2:28:40,  1.03s/it]  7%|▋         | 669/9345 [13:43<2:27:49,  1.02s/it]  7%|▋         | 670/9345 [13:44<2:27:52,  1.02s/it]  7%|▋         | 671/9345 [13:45<2:27:36,  1.02s/it]  7%|▋         | 672/9345 [13:46<2:27:09,  1.02s/it]  7%|▋         | 673/9345 [13:47<2:27:00,  1.02s/it]  7%|▋         | 674/9345 [13:48<2:26:34,  1.01s/it]  7%|▋         | 675/9345 [13:49<2:25:49,  1.01s/it]  7%|▋         | 676/9345 [13:50<2:25:49,  1.01s/it]  7%|▋         | 677/9345 [13:51<2:26:08,  1.01s/it]  7%|▋         | 678/9345 [13:52<2:32:54,  1.06s/it]  7%|▋         | 679/9345 [13:53<2:31:05,  1.05s/it]  7%|▋         | 680/9345 [13:54<2:29:47,  1.04s/it]                                                    {'loss': 0.3003, 'grad_norm': 0.45628211753671305, 'learning_rate': 1.8191546281433923e-05, 'epoch': 0.36}
  7%|▋         | 680/9345 [13:54<2:29:47,  1.04s/it]  7%|▋         | 681/9345 [13:55<2:29:12,  1.03s/it]  7%|▋         | 682/9345 [13:56<2:28:27,  1.03s/it]  7%|▋         | 683/9345 [13:57<2:27:26,  1.02s/it]  7%|▋         | 684/9345 [13:58<2:27:04,  1.02s/it]  7%|▋         | 685/9345 [13:59<2:26:35,  1.02s/it]  7%|▋         | 686/9345 [14:00<2:26:23,  1.01s/it]  7%|▋         | 687/9345 [14:01<2:26:40,  1.02s/it]  7%|▋         | 688/9345 [14:02<2:26:16,  1.01s/it]  7%|▋         | 689/9345 [14:03<2:25:59,  1.01s/it]  7%|▋         | 690/9345 [14:04<2:25:50,  1.01s/it]  7%|▋         | 691/9345 [14:05<2:26:01,  1.01s/it]  7%|▋         | 692/9345 [14:06<2:26:14,  1.01s/it]  7%|▋         | 693/9345 [14:08<2:34:44,  1.07s/it]  7%|▋         | 694/9345 [14:09<2:31:38,  1.05s/it]  7%|▋         | 695/9345 [14:10<2:29:54,  1.04s/it]  7%|▋         | 696/9345 [14:11<2:28:22,  1.03s/it]  7%|▋         | 697/9345 [14:12<2:27:18,  1.02s/it]  7%|▋         | 698/9345 [14:13<2:26:40,  1.02s/it]  7%|▋         | 699/9345 [14:14<2:26:29,  1.02s/it]  7%|▋         | 700/9345 [14:15<2:26:00,  1.01s/it]                                                    {'loss': 0.3037, 'grad_norm': 0.5087250281876199, 'learning_rate': 1.8726591760299626e-05, 'epoch': 0.37}
  7%|▋         | 700/9345 [14:15<2:26:00,  1.01s/it][WARNING|trainer.py:3344] 2024-05-31 14:48:36,286 >>  stage3_gather_16bit_weights_on_model_save=false. Saving the full checkpoint instead, use zero_to_fp32.py to recover weights
[INFO|trainer.py:3410] 2024-05-31 14:48:36,286 >> Saving model checkpoint to ./checkpoint_dir/checkpoint-700
/opt/conda/lib/python3.10/site-packages/peft/utils/save_and_load.py:154: UserWarning: Could not find a config file in ./ - will assume that the vocabulary was not modified.
  warnings.warn(
[INFO|tokenization_utils_base.py:2513] 2024-05-31 14:48:36,305 >> tokenizer config file saved in ./checkpoint_dir/checkpoint-700/tokenizer_config.json
[INFO|tokenization_utils_base.py:2522] 2024-05-31 14:48:36,306 >> Special tokens file saved in ./checkpoint_dir/checkpoint-700/special_tokens_map.json
[2024-05-31 14:48:36,403] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step700 is about to be saved!
[2024-05-31 14:48:40,491] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-700/global_step700/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:48:40,492] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-700/global_step700/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:48:52,619] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-700/global_step700/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:48:52,955] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-700/global_step700/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:48:53,615] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-700/global_step700/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:48:53,617] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-700/global_step700/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:48:53,624] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step700 is ready now!
[2024-05-31 14:48:53,651] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step700 is about to be saved!
[2024-05-31 14:48:53,667] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-700/global_step700/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:48:53,667] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-700/global_step700/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:48:54,908] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-700/global_step700/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:48:54,911] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-700/global_step700/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:48:55,638] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-700/global_step700/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:48:55,639] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-700/global_step700/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:48:55,642] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step700 is ready now!
[INFO|trainer.py:3502] 2024-05-31 14:48:55,648 >> Deleting older checkpoint [checkpoint_dir/checkpoint-600] due to args.save_total_limit
  8%|▊         | 701/9345 [14:35<16:25:32,  6.84s/it]  8%|▊         | 702/9345 [14:36<12:13:50,  5.09s/it]  8%|▊         | 703/9345 [14:37<9:17:32,  3.87s/it]   8%|▊         | 704/9345 [14:38<7:13:52,  3.01s/it]  8%|▊         | 705/9345 [14:39<5:47:13,  2.41s/it]  8%|▊         | 706/9345 [14:40<4:46:51,  1.99s/it]  8%|▊         | 707/9345 [14:41<4:12:49,  1.76s/it]  8%|▊         | 708/9345 [14:42<3:40:41,  1.53s/it]  8%|▊         | 709/9345 [14:43<3:17:55,  1.38s/it]  8%|▊         | 710/9345 [14:44<3:02:25,  1.27s/it]  8%|▊         | 711/9345 [14:45<2:51:36,  1.19s/it]  8%|▊         | 712/9345 [14:46<2:44:17,  1.14s/it]  8%|▊         | 713/9345 [14:47<2:38:36,  1.10s/it]  8%|▊         | 714/9345 [14:48<2:34:20,  1.07s/it]  8%|▊         | 715/9345 [14:49<2:31:11,  1.05s/it]  8%|▊         | 716/9345 [14:50<2:28:49,  1.03s/it]  8%|▊         | 717/9345 [14:51<2:27:37,  1.03s/it]  8%|▊         | 718/9345 [14:52<2:26:16,  1.02s/it]  8%|▊         | 719/9345 [14:53<2:25:52,  1.01s/it]  8%|▊         | 720/9345 [14:54<2:25:38,  1.01s/it]                                                    {'loss': 0.2928, 'grad_norm': 0.5374072219525932, 'learning_rate': 1.926163723916533e-05, 'epoch': 0.39}
  8%|▊         | 720/9345 [14:54<2:25:38,  1.01s/it]  8%|▊         | 721/9345 [14:55<2:25:19,  1.01s/it]  8%|▊         | 722/9345 [14:57<2:33:59,  1.07s/it]  8%|▊         | 723/9345 [14:58<2:31:11,  1.05s/it]  8%|▊         | 724/9345 [14:59<2:29:06,  1.04s/it]  8%|▊         | 725/9345 [15:00<2:27:58,  1.03s/it]  8%|▊         | 726/9345 [15:01<2:27:14,  1.02s/it]  8%|▊         | 727/9345 [15:02<2:26:16,  1.02s/it]  8%|▊         | 728/9345 [15:03<2:25:29,  1.01s/it]  8%|▊         | 729/9345 [15:04<2:25:03,  1.01s/it]  8%|▊         | 730/9345 [15:05<2:25:01,  1.01s/it]  8%|▊         | 731/9345 [15:06<2:24:52,  1.01s/it]  8%|▊         | 732/9345 [15:07<2:25:01,  1.01s/it]  8%|▊         | 733/9345 [15:08<2:25:24,  1.01s/it]  8%|▊         | 734/9345 [15:09<2:25:09,  1.01s/it]  8%|▊         | 735/9345 [15:10<2:24:46,  1.01s/it]  8%|▊         | 736/9345 [15:11<2:32:10,  1.06s/it]  8%|▊         | 737/9345 [15:12<2:29:51,  1.04s/it]  8%|▊         | 738/9345 [15:13<2:28:08,  1.03s/it]  8%|▊         | 739/9345 [15:14<2:26:56,  1.02s/it]  8%|▊         | 740/9345 [15:15<2:26:20,  1.02s/it]                                                    {'loss': 0.2904, 'grad_norm': 0.723922471806717, 'learning_rate': 1.9796682718031036e-05, 'epoch': 0.4}
  8%|▊         | 740/9345 [15:15<2:26:20,  1.02s/it]  8%|▊         | 741/9345 [15:16<2:26:37,  1.02s/it]  8%|▊         | 742/9345 [15:17<2:26:35,  1.02s/it]  8%|▊         | 743/9345 [15:18<2:25:38,  1.02s/it]  8%|▊         | 744/9345 [15:19<2:25:28,  1.01s/it]  8%|▊         | 745/9345 [15:20<2:25:11,  1.01s/it]  8%|▊         | 746/9345 [15:21<2:24:59,  1.01s/it]  8%|▊         | 747/9345 [15:22<2:24:58,  1.01s/it]  8%|▊         | 748/9345 [15:23<2:24:57,  1.01s/it]  8%|▊         | 749/9345 [15:24<2:24:36,  1.01s/it]  8%|▊         | 750/9345 [15:25<2:24:46,  1.01s/it]  8%|▊         | 751/9345 [15:26<2:31:48,  1.06s/it]  8%|▊         | 752/9345 [15:27<2:29:47,  1.05s/it]  8%|▊         | 753/9345 [15:28<2:28:13,  1.04s/it]  8%|▊         | 754/9345 [15:29<2:26:54,  1.03s/it]  8%|▊         | 755/9345 [15:30<2:26:39,  1.02s/it]  8%|▊         | 756/9345 [15:31<2:25:53,  1.02s/it]  8%|▊         | 757/9345 [15:32<2:25:34,  1.02s/it]  8%|▊         | 758/9345 [15:33<2:25:20,  1.02s/it]  8%|▊         | 759/9345 [15:34<2:24:50,  1.01s/it]  8%|▊         | 760/9345 [15:35<2:24:40,  1.01s/it]                                                    {'loss': 0.2981, 'grad_norm': 0.5681416295825539, 'learning_rate': 2.033172819689674e-05, 'epoch': 0.41}
  8%|▊         | 760/9345 [15:35<2:24:40,  1.01s/it]  8%|▊         | 761/9345 [15:36<2:25:23,  1.02s/it]  8%|▊         | 762/9345 [15:37<2:25:29,  1.02s/it]  8%|▊         | 763/9345 [15:38<2:25:37,  1.02s/it]  8%|▊         | 764/9345 [15:39<2:25:38,  1.02s/it]  8%|▊         | 765/9345 [15:41<2:33:48,  1.08s/it]  8%|▊         | 766/9345 [15:42<2:31:19,  1.06s/it]  8%|▊         | 767/9345 [15:43<2:29:41,  1.05s/it]  8%|▊         | 768/9345 [15:44<2:28:31,  1.04s/it]  8%|▊         | 769/9345 [15:45<2:28:30,  1.04s/it]  8%|▊         | 770/9345 [15:46<2:27:55,  1.03s/it]  8%|▊         | 771/9345 [15:47<2:27:39,  1.03s/it]  8%|▊         | 772/9345 [15:48<2:27:20,  1.03s/it]  8%|▊         | 773/9345 [15:49<2:27:01,  1.03s/it]  8%|▊         | 774/9345 [15:50<2:27:03,  1.03s/it]  8%|▊         | 775/9345 [15:51<2:26:51,  1.03s/it]  8%|▊         | 776/9345 [15:52<2:26:29,  1.03s/it]  8%|▊         | 777/9345 [15:53<2:26:36,  1.03s/it]  8%|▊         | 778/9345 [15:54<2:26:18,  1.02s/it]  8%|▊         | 779/9345 [15:55<2:26:07,  1.02s/it]  8%|▊         | 780/9345 [15:56<2:33:48,  1.08s/it]                                                    {'loss': 0.3002, 'grad_norm': 0.8332770123333536, 'learning_rate': 2.0866773675762442e-05, 'epoch': 0.42}
  8%|▊         | 780/9345 [15:56<2:33:48,  1.08s/it]  8%|▊         | 781/9345 [15:57<2:31:54,  1.06s/it]  8%|▊         | 782/9345 [15:58<2:29:44,  1.05s/it]  8%|▊         | 783/9345 [15:59<2:28:36,  1.04s/it]  8%|▊         | 784/9345 [16:00<2:27:51,  1.04s/it]  8%|▊         | 785/9345 [16:01<2:27:06,  1.03s/it]  8%|▊         | 786/9345 [16:02<2:26:44,  1.03s/it]  8%|▊         | 787/9345 [16:03<2:26:18,  1.03s/it]  8%|▊         | 788/9345 [16:04<2:26:01,  1.02s/it]  8%|▊         | 789/9345 [16:05<2:25:58,  1.02s/it]  8%|▊         | 790/9345 [16:06<2:25:50,  1.02s/it]  8%|▊         | 791/9345 [16:07<2:25:56,  1.02s/it]  8%|▊         | 792/9345 [16:08<2:25:30,  1.02s/it]  8%|▊         | 793/9345 [16:09<2:25:28,  1.02s/it]  8%|▊         | 794/9345 [16:11<2:32:05,  1.07s/it]  9%|▊         | 795/9345 [16:12<2:29:41,  1.05s/it]  9%|▊         | 796/9345 [16:13<2:28:10,  1.04s/it]  9%|▊         | 797/9345 [16:14<2:27:08,  1.03s/it]  9%|▊         | 798/9345 [16:15<2:27:23,  1.03s/it]  9%|▊         | 799/9345 [16:16<2:26:43,  1.03s/it]  9%|▊         | 800/9345 [16:17<2:26:02,  1.03s/it]                                                    {'loss': 0.2769, 'grad_norm': 0.5098582051683366, 'learning_rate': 2.1401819154628146e-05, 'epoch': 0.43}
  9%|▊         | 800/9345 [16:17<2:26:02,  1.03s/it][WARNING|trainer.py:3344] 2024-05-31 14:50:38,451 >>  stage3_gather_16bit_weights_on_model_save=false. Saving the full checkpoint instead, use zero_to_fp32.py to recover weights
[INFO|trainer.py:3410] 2024-05-31 14:50:38,451 >> Saving model checkpoint to ./checkpoint_dir/checkpoint-800
/opt/conda/lib/python3.10/site-packages/peft/utils/save_and_load.py:154: UserWarning: Could not find a config file in ./ - will assume that the vocabulary was not modified.
  warnings.warn(
[INFO|tokenization_utils_base.py:2513] 2024-05-31 14:50:38,473 >> tokenizer config file saved in ./checkpoint_dir/checkpoint-800/tokenizer_config.json
[INFO|tokenization_utils_base.py:2522] 2024-05-31 14:50:38,474 >> Special tokens file saved in ./checkpoint_dir/checkpoint-800/special_tokens_map.json
[2024-05-31 14:50:38,530] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step800 is about to be saved!
[2024-05-31 14:50:42,694] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-800/global_step800/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:50:42,694] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-800/global_step800/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:50:54,719] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-800/global_step800/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:50:55,058] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-800/global_step800/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:50:55,720] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-800/global_step800/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:50:55,722] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-800/global_step800/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:50:55,725] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step800 is ready now!
[2024-05-31 14:50:55,755] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step800 is about to be saved!
[2024-05-31 14:50:55,772] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-800/global_step800/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:50:55,772] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-800/global_step800/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:50:56,999] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-800/global_step800/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:50:57,000] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-800/global_step800/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:50:57,762] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-800/global_step800/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:50:57,764] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-800/global_step800/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:50:57,770] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step800 is ready now!
[INFO|trainer.py:3502] 2024-05-31 14:50:57,776 >> Deleting older checkpoint [checkpoint_dir/checkpoint-700] due to args.save_total_limit
  9%|▊         | 801/9345 [16:37<16:14:47,  6.85s/it]  9%|▊         | 802/9345 [16:38<12:06:17,  5.10s/it]  9%|▊         | 803/9345 [16:39<9:12:05,  3.88s/it]   9%|▊         | 804/9345 [16:40<7:09:06,  3.01s/it]  9%|▊         | 805/9345 [16:41<5:43:32,  2.41s/it]  9%|▊         | 806/9345 [16:42<4:44:01,  2.00s/it]  9%|▊         | 807/9345 [16:43<4:02:20,  1.70s/it]  9%|▊         | 808/9345 [16:44<3:33:11,  1.50s/it]  9%|▊         | 809/9345 [16:46<3:21:53,  1.42s/it]  9%|▊         | 810/9345 [16:47<3:04:47,  1.30s/it]  9%|▊         | 811/9345 [16:48<2:52:35,  1.21s/it]  9%|▊         | 812/9345 [16:49<2:43:54,  1.15s/it]  9%|▊         | 813/9345 [16:50<2:38:11,  1.11s/it]  9%|▊         | 814/9345 [16:51<2:34:07,  1.08s/it]  9%|▊         | 815/9345 [16:52<2:31:32,  1.07s/it]  9%|▊         | 816/9345 [16:53<2:29:18,  1.05s/it]  9%|▊         | 817/9345 [16:54<2:27:47,  1.04s/it]  9%|▉         | 818/9345 [16:55<2:27:18,  1.04s/it]  9%|▉         | 819/9345 [16:56<2:26:36,  1.03s/it]  9%|▉         | 820/9345 [16:57<2:26:03,  1.03s/it]                                                    {'loss': 0.2763, 'grad_norm': 0.43563376596388353, 'learning_rate': 2.193686463349385e-05, 'epoch': 0.44}
  9%|▉         | 820/9345 [16:57<2:26:03,  1.03s/it]  9%|▉         | 821/9345 [16:58<2:26:41,  1.03s/it]  9%|▉         | 822/9345 [16:59<2:25:54,  1.03s/it]  9%|▉         | 823/9345 [17:00<2:32:30,  1.07s/it]  9%|▉         | 824/9345 [17:01<2:29:56,  1.06s/it]  9%|▉         | 825/9345 [17:02<2:28:24,  1.05s/it]  9%|▉         | 826/9345 [17:03<2:27:23,  1.04s/it]  9%|▉         | 827/9345 [17:04<2:26:24,  1.03s/it]  9%|▉         | 828/9345 [17:05<2:25:54,  1.03s/it]  9%|▉         | 829/9345 [17:06<2:25:44,  1.03s/it]  9%|▉         | 830/9345 [17:07<2:25:38,  1.03s/it]  9%|▉         | 831/9345 [17:08<2:25:38,  1.03s/it]  9%|▉         | 832/9345 [17:09<2:25:10,  1.02s/it]  9%|▉         | 833/9345 [17:10<2:24:39,  1.02s/it]  9%|▉         | 834/9345 [17:11<2:24:36,  1.02s/it]  9%|▉         | 835/9345 [17:12<2:24:52,  1.02s/it]  9%|▉         | 836/9345 [17:13<2:24:48,  1.02s/it]  9%|▉         | 837/9345 [17:14<2:24:21,  1.02s/it]  9%|▉         | 838/9345 [17:15<2:31:07,  1.07s/it]  9%|▉         | 839/9345 [17:16<2:29:24,  1.05s/it]  9%|▉         | 840/9345 [17:18<2:28:04,  1.04s/it]                                                    {'loss': 0.2887, 'grad_norm': 0.8669735245209894, 'learning_rate': 2.2471910112359552e-05, 'epoch': 0.45}
  9%|▉         | 840/9345 [17:18<2:28:04,  1.04s/it]  9%|▉         | 841/9345 [17:19<2:27:32,  1.04s/it]  9%|▉         | 842/9345 [17:20<2:26:21,  1.03s/it]  9%|▉         | 843/9345 [17:21<2:25:36,  1.03s/it]  9%|▉         | 844/9345 [17:22<2:25:49,  1.03s/it]  9%|▉         | 845/9345 [17:23<2:25:12,  1.02s/it]  9%|▉         | 846/9345 [17:24<2:25:17,  1.03s/it]  9%|▉         | 847/9345 [17:25<2:25:29,  1.03s/it]  9%|▉         | 848/9345 [17:26<2:25:06,  1.02s/it]  9%|▉         | 849/9345 [17:27<2:24:44,  1.02s/it]  9%|▉         | 850/9345 [17:28<2:24:45,  1.02s/it]  9%|▉         | 851/9345 [17:29<2:24:46,  1.02s/it]  9%|▉         | 852/9345 [17:30<2:31:55,  1.07s/it]  9%|▉         | 853/9345 [17:31<2:29:29,  1.06s/it]  9%|▉         | 854/9345 [17:32<2:27:40,  1.04s/it]  9%|▉         | 855/9345 [17:33<2:26:16,  1.03s/it]  9%|▉         | 856/9345 [17:34<2:25:51,  1.03s/it]  9%|▉         | 857/9345 [17:35<2:25:23,  1.03s/it]  9%|▉         | 858/9345 [17:36<2:25:13,  1.03s/it]  9%|▉         | 859/9345 [17:37<2:23:59,  1.02s/it]  9%|▉         | 860/9345 [17:38<2:24:15,  1.02s/it]                                                    {'loss': 0.2828, 'grad_norm': 1.1641564229139467, 'learning_rate': 2.3006955591225255e-05, 'epoch': 0.46}
  9%|▉         | 860/9345 [17:38<2:24:15,  1.02s/it]  9%|▉         | 861/9345 [17:39<2:24:46,  1.02s/it]  9%|▉         | 862/9345 [17:40<2:24:38,  1.02s/it]  9%|▉         | 863/9345 [17:41<2:24:12,  1.02s/it]  9%|▉         | 864/9345 [17:42<2:23:52,  1.02s/it]  9%|▉         | 865/9345 [17:43<2:23:40,  1.02s/it]  9%|▉         | 866/9345 [17:44<2:23:39,  1.02s/it]  9%|▉         | 867/9345 [17:45<2:31:35,  1.07s/it]  9%|▉         | 868/9345 [17:46<2:29:09,  1.06s/it]  9%|▉         | 869/9345 [17:47<2:27:43,  1.05s/it]  9%|▉         | 870/9345 [17:48<2:26:35,  1.04s/it]  9%|▉         | 871/9345 [17:49<2:25:40,  1.03s/it]  9%|▉         | 872/9345 [17:50<2:24:49,  1.03s/it]  9%|▉         | 873/9345 [17:51<2:24:14,  1.02s/it]  9%|▉         | 874/9345 [17:53<2:24:04,  1.02s/it]  9%|▉         | 875/9345 [17:54<2:23:45,  1.02s/it]  9%|▉         | 876/9345 [17:55<2:24:25,  1.02s/it]  9%|▉         | 877/9345 [17:56<2:24:02,  1.02s/it]  9%|▉         | 878/9345 [17:57<2:23:54,  1.02s/it]  9%|▉         | 879/9345 [17:58<2:23:15,  1.02s/it]  9%|▉         | 880/9345 [17:59<2:23:30,  1.02s/it]                                                    {'loss': 0.2985, 'grad_norm': 0.5853453874970167, 'learning_rate': 2.354200107009096e-05, 'epoch': 0.47}
  9%|▉         | 880/9345 [17:59<2:23:30,  1.02s/it]  9%|▉         | 881/9345 [18:00<2:23:56,  1.02s/it]  9%|▉         | 882/9345 [18:01<2:31:51,  1.08s/it]  9%|▉         | 883/9345 [18:02<2:29:15,  1.06s/it]  9%|▉         | 884/9345 [18:03<2:26:56,  1.04s/it]  9%|▉         | 885/9345 [18:04<2:24:48,  1.03s/it]  9%|▉         | 886/9345 [18:05<2:23:39,  1.02s/it]  9%|▉         | 887/9345 [18:06<2:22:49,  1.01s/it] 10%|▉         | 888/9345 [18:07<2:21:57,  1.01s/it] 10%|▉         | 889/9345 [18:08<2:21:45,  1.01s/it] 10%|▉         | 890/9345 [18:09<2:21:31,  1.00s/it] 10%|▉         | 891/9345 [18:10<2:21:39,  1.01s/it] 10%|▉         | 892/9345 [18:11<2:21:46,  1.01s/it] 10%|▉         | 893/9345 [18:12<2:22:08,  1.01s/it] 10%|▉         | 894/9345 [18:13<2:22:10,  1.01s/it] 10%|▉         | 895/9345 [18:14<2:22:30,  1.01s/it] 10%|▉         | 896/9345 [18:15<2:29:36,  1.06s/it] 10%|▉         | 897/9345 [18:16<2:27:29,  1.05s/it] 10%|▉         | 898/9345 [18:17<2:26:08,  1.04s/it] 10%|▉         | 899/9345 [18:18<2:25:39,  1.03s/it] 10%|▉         | 900/9345 [18:19<2:24:31,  1.03s/it]                                                    {'loss': 0.2844, 'grad_norm': 0.6407602198970873, 'learning_rate': 2.4077046548956665e-05, 'epoch': 0.48}
 10%|▉         | 900/9345 [18:19<2:24:31,  1.03s/it][WARNING|trainer.py:3344] 2024-05-31 14:52:40,830 >>  stage3_gather_16bit_weights_on_model_save=false. Saving the full checkpoint instead, use zero_to_fp32.py to recover weights
[INFO|trainer.py:3410] 2024-05-31 14:52:40,831 >> Saving model checkpoint to ./checkpoint_dir/checkpoint-900
/opt/conda/lib/python3.10/site-packages/peft/utils/save_and_load.py:154: UserWarning: Could not find a config file in ./ - will assume that the vocabulary was not modified.
  warnings.warn(
[INFO|tokenization_utils_base.py:2513] 2024-05-31 14:52:40,851 >> tokenizer config file saved in ./checkpoint_dir/checkpoint-900/tokenizer_config.json
[INFO|tokenization_utils_base.py:2522] 2024-05-31 14:52:40,852 >> Special tokens file saved in ./checkpoint_dir/checkpoint-900/special_tokens_map.json
[2024-05-31 14:52:40,947] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step900 is about to be saved!
[2024-05-31 14:52:45,097] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-900/global_step900/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:52:45,098] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-900/global_step900/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:52:56,513] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-900/global_step900/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:52:56,845] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-900/global_step900/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:52:57,534] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-900/global_step900/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:52:57,536] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-900/global_step900/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:52:57,542] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step900 is ready now!
[2024-05-31 14:52:57,569] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step900 is about to be saved!
[2024-05-31 14:52:57,586] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-900/global_step900/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:52:57,586] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-900/global_step900/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:52:58,804] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-900/global_step900/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:52:58,805] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-900/global_step900/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:52:59,554] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-900/global_step900/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:52:59,556] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-900/global_step900/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:52:59,562] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step900 is ready now!
[INFO|trainer.py:3502] 2024-05-31 14:52:59,569 >> Deleting older checkpoint [checkpoint_dir/checkpoint-800] due to args.save_total_limit
 10%|▉         | 901/9345 [18:39<15:37:36,  6.66s/it] 10%|▉         | 902/9345 [18:40<11:38:56,  4.97s/it] 10%|▉         | 903/9345 [18:41<8:52:48,  3.79s/it]  10%|▉         | 904/9345 [18:42<6:55:40,  2.95s/it] 10%|▉         | 905/9345 [18:43<5:33:20,  2.37s/it] 10%|▉         | 906/9345 [18:44<4:36:07,  1.96s/it] 10%|▉         | 907/9345 [18:45<3:56:16,  1.68s/it] 10%|▉         | 908/9345 [18:46<3:28:11,  1.48s/it] 10%|▉         | 909/9345 [18:47<3:08:55,  1.34s/it] 10%|▉         | 910/9345 [18:48<2:54:40,  1.24s/it] 10%|▉         | 911/9345 [18:49<2:52:07,  1.22s/it] 10%|▉         | 912/9345 [18:50<2:43:27,  1.16s/it] 10%|▉         | 913/9345 [18:51<2:37:18,  1.12s/it] 10%|▉         | 914/9345 [18:52<2:33:04,  1.09s/it] 10%|▉         | 915/9345 [18:53<2:30:03,  1.07s/it] 10%|▉         | 916/9345 [18:54<2:27:42,  1.05s/it] 10%|▉         | 917/9345 [18:55<2:26:33,  1.04s/it] 10%|▉         | 918/9345 [18:56<2:25:33,  1.04s/it] 10%|▉         | 919/9345 [18:57<2:24:59,  1.03s/it] 10%|▉         | 920/9345 [18:58<2:24:17,  1.03s/it]                                                    {'loss': 0.3106, 'grad_norm': 0.5869514938698858, 'learning_rate': 2.461209202782237e-05, 'epoch': 0.49}
 10%|▉         | 920/9345 [18:58<2:24:17,  1.03s/it] 10%|▉         | 921/9345 [19:00<2:24:14,  1.03s/it] 10%|▉         | 922/9345 [19:01<2:23:47,  1.02s/it] 10%|▉         | 923/9345 [19:02<2:23:15,  1.02s/it] 10%|▉         | 924/9345 [19:03<2:22:43,  1.02s/it] 10%|▉         | 925/9345 [19:04<2:30:45,  1.07s/it] 10%|▉         | 926/9345 [19:05<2:28:36,  1.06s/it] 10%|▉         | 927/9345 [19:06<2:26:33,  1.04s/it] 10%|▉         | 928/9345 [19:07<2:25:22,  1.04s/it] 10%|▉         | 929/9345 [19:08<2:24:30,  1.03s/it] 10%|▉         | 930/9345 [19:09<2:24:12,  1.03s/it] 10%|▉         | 931/9345 [19:10<2:23:59,  1.03s/it] 10%|▉         | 932/9345 [19:11<2:23:31,  1.02s/it] 10%|▉         | 933/9345 [19:12<2:22:51,  1.02s/it] 10%|▉         | 934/9345 [19:13<2:22:42,  1.02s/it] 10%|█         | 935/9345 [19:14<2:22:27,  1.02s/it] 10%|█         | 936/9345 [19:15<2:22:24,  1.02s/it] 10%|█         | 937/9345 [19:16<2:22:37,  1.02s/it] 10%|█         | 938/9345 [19:17<2:22:40,  1.02s/it] 10%|█         | 939/9345 [19:18<2:22:56,  1.02s/it] 10%|█         | 940/9345 [19:19<2:30:07,  1.07s/it]                                                    {'loss': 0.2706, 'grad_norm': 0.3951490128481606, 'learning_rate': 2.5147137506688068e-05, 'epoch': 0.5}
 10%|█         | 940/9345 [19:19<2:30:07,  1.07s/it] 10%|█         | 941/9345 [19:20<2:28:23,  1.06s/it] 10%|█         | 942/9345 [19:21<2:26:44,  1.05s/it] 10%|█         | 943/9345 [19:22<2:25:24,  1.04s/it] 10%|█         | 944/9345 [19:23<2:24:28,  1.03s/it] 10%|█         | 945/9345 [19:24<2:24:02,  1.03s/it] 10%|█         | 946/9345 [19:25<2:23:28,  1.02s/it] 10%|█         | 947/9345 [19:26<2:23:16,  1.02s/it] 10%|█         | 948/9345 [19:27<2:23:10,  1.02s/it] 10%|█         | 949/9345 [19:28<2:22:40,  1.02s/it] 10%|█         | 950/9345 [19:29<2:22:45,  1.02s/it] 10%|█         | 951/9345 [19:30<2:22:36,  1.02s/it] 10%|█         | 952/9345 [19:31<2:22:14,  1.02s/it] 10%|█         | 953/9345 [19:32<2:21:52,  1.01s/it] 10%|█         | 954/9345 [19:34<2:28:40,  1.06s/it] 10%|█         | 955/9345 [19:35<2:26:42,  1.05s/it] 10%|█         | 956/9345 [19:36<2:25:15,  1.04s/it] 10%|█         | 957/9345 [19:37<2:24:28,  1.03s/it] 10%|█         | 958/9345 [19:38<2:23:51,  1.03s/it] 10%|█         | 959/9345 [19:39<2:23:40,  1.03s/it] 10%|█         | 960/9345 [19:40<2:23:03,  1.02s/it]                                                    {'loss': 0.2895, 'grad_norm': 0.4764423521211204, 'learning_rate': 2.568218298555377e-05, 'epoch': 0.51}
 10%|█         | 960/9345 [19:40<2:23:03,  1.02s/it] 10%|█         | 961/9345 [19:41<2:22:46,  1.02s/it] 10%|█         | 962/9345 [19:42<2:22:20,  1.02s/it] 10%|█         | 963/9345 [19:43<2:22:19,  1.02s/it] 10%|█         | 964/9345 [19:44<2:21:49,  1.02s/it] 10%|█         | 965/9345 [19:45<2:21:51,  1.02s/it] 10%|█         | 966/9345 [19:46<2:21:45,  1.02s/it] 10%|█         | 967/9345 [19:47<2:21:39,  1.01s/it] 10%|█         | 968/9345 [19:48<2:21:51,  1.02s/it] 10%|█         | 969/9345 [19:49<2:28:41,  1.07s/it] 10%|█         | 970/9345 [19:50<2:26:53,  1.05s/it] 10%|█         | 971/9345 [19:51<2:25:33,  1.04s/it] 10%|█         | 972/9345 [19:52<2:24:52,  1.04s/it] 10%|█         | 973/9345 [19:53<2:23:47,  1.03s/it] 10%|█         | 974/9345 [19:54<2:23:20,  1.03s/it] 10%|█         | 975/9345 [19:55<2:23:04,  1.03s/it] 10%|█         | 976/9345 [19:56<2:22:55,  1.02s/it] 10%|█         | 977/9345 [19:57<2:22:44,  1.02s/it] 10%|█         | 978/9345 [19:58<2:23:01,  1.03s/it] 10%|█         | 979/9345 [19:59<2:22:49,  1.02s/it] 10%|█         | 980/9345 [20:00<2:22:36,  1.02s/it]                                                    {'loss': 0.2757, 'grad_norm': 0.36798098511191457, 'learning_rate': 2.6217228464419475e-05, 'epoch': 0.52}
 10%|█         | 980/9345 [20:00<2:22:36,  1.02s/it] 10%|█         | 981/9345 [20:01<2:22:58,  1.03s/it] 11%|█         | 982/9345 [20:02<2:22:23,  1.02s/it] 11%|█         | 983/9345 [20:03<2:29:20,  1.07s/it] 11%|█         | 984/9345 [20:04<2:27:11,  1.06s/it] 11%|█         | 985/9345 [20:06<2:25:37,  1.05s/it] 11%|█         | 986/9345 [20:07<2:24:44,  1.04s/it] 11%|█         | 987/9345 [20:08<2:23:58,  1.03s/it] 11%|█         | 988/9345 [20:09<2:23:52,  1.03s/it] 11%|█         | 989/9345 [20:10<2:23:53,  1.03s/it] 11%|█         | 990/9345 [20:11<2:23:20,  1.03s/it] 11%|█         | 991/9345 [20:12<2:22:37,  1.02s/it] 11%|█         | 992/9345 [20:13<2:22:15,  1.02s/it] 11%|█         | 993/9345 [20:14<2:22:00,  1.02s/it] 11%|█         | 994/9345 [20:15<2:21:53,  1.02s/it] 11%|█         | 995/9345 [20:16<2:21:54,  1.02s/it] 11%|█         | 996/9345 [20:17<2:21:48,  1.02s/it] 11%|█         | 997/9345 [20:18<2:21:35,  1.02s/it] 11%|█         | 998/9345 [20:19<2:29:08,  1.07s/it] 11%|█         | 999/9345 [20:20<2:26:45,  1.06s/it] 11%|█         | 1000/9345 [20:21<2:25:12,  1.04s/it]                                                     {'loss': 0.2724, 'grad_norm': 0.5704767035123358, 'learning_rate': 2.6752273943285185e-05, 'epoch': 0.54}
 11%|█         | 1000/9345 [20:21<2:25:12,  1.04s/it][WARNING|trainer.py:3344] 2024-05-31 14:54:42,666 >>  stage3_gather_16bit_weights_on_model_save=false. Saving the full checkpoint instead, use zero_to_fp32.py to recover weights
[INFO|trainer.py:3410] 2024-05-31 14:54:42,666 >> Saving model checkpoint to ./checkpoint_dir/checkpoint-1000
/opt/conda/lib/python3.10/site-packages/peft/utils/save_and_load.py:154: UserWarning: Could not find a config file in ./ - will assume that the vocabulary was not modified.
  warnings.warn(
[INFO|tokenization_utils_base.py:2513] 2024-05-31 14:54:42,692 >> tokenizer config file saved in ./checkpoint_dir/checkpoint-1000/tokenizer_config.json
[INFO|tokenization_utils_base.py:2522] 2024-05-31 14:54:42,692 >> Special tokens file saved in ./checkpoint_dir/checkpoint-1000/special_tokens_map.json
[2024-05-31 14:54:42,802] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step1000 is about to be saved!
[2024-05-31 14:54:46,932] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-1000/global_step1000/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:54:46,932] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1000/global_step1000/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:54:59,381] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1000/global_step1000/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:54:59,712] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1000/global_step1000/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:55:00,341] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1000/global_step1000/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:55:00,342] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-1000/global_step1000/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:55:00,345] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step1000 is ready now!
[2024-05-31 14:55:00,373] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step1000 is about to be saved!
[2024-05-31 14:55:00,390] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-1000/global_step1000/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:55:00,390] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1000/global_step1000/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:55:01,601] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1000/global_step1000/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:55:01,602] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1000/global_step1000/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:55:02,336] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1000/global_step1000/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:55:02,337] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-1000/global_step1000/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:55:02,341] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step1000 is ready now!
[INFO|trainer.py:3502] 2024-05-31 14:55:02,348 >> Deleting older checkpoint [checkpoint_dir/checkpoint-900] due to args.save_total_limit
 11%|█         | 1001/9345 [20:42<16:08:06,  6.96s/it] 11%|█         | 1002/9345 [20:43<11:59:57,  5.18s/it] 11%|█         | 1003/9345 [20:44<9:06:16,  3.93s/it]  11%|█         | 1004/9345 [20:45<7:04:56,  3.06s/it] 11%|█         | 1005/9345 [20:46<5:39:36,  2.44s/it] 11%|█         | 1006/9345 [20:47<4:40:02,  2.01s/it] 11%|█         | 1007/9345 [20:48<3:58:59,  1.72s/it] 11%|█         | 1008/9345 [20:49<3:30:00,  1.51s/it] 11%|█         | 1009/9345 [20:50<3:09:32,  1.36s/it] 11%|█         | 1010/9345 [20:51<2:54:55,  1.26s/it] 11%|█         | 1011/9345 [20:52<2:44:57,  1.19s/it] 11%|█         | 1012/9345 [20:53<2:38:09,  1.14s/it] 11%|█         | 1013/9345 [20:54<2:41:19,  1.16s/it] 11%|█         | 1014/9345 [20:55<2:35:04,  1.12s/it] 11%|█         | 1015/9345 [20:56<2:31:01,  1.09s/it] 11%|█         | 1016/9345 [20:57<2:28:18,  1.07s/it] 11%|█         | 1017/9345 [20:58<2:25:53,  1.05s/it] 11%|█         | 1018/9345 [20:59<2:24:18,  1.04s/it] 11%|█         | 1019/9345 [21:00<2:23:51,  1.04s/it] 11%|█         | 1020/9345 [21:01<2:22:55,  1.03s/it]                                                     {'loss': 0.3063, 'grad_norm': 0.5849886370555303, 'learning_rate': 2.7287319422150888e-05, 'epoch': 0.55}
 11%|█         | 1020/9345 [21:01<2:22:55,  1.03s/it] 11%|█         | 1021/9345 [21:02<2:22:52,  1.03s/it] 11%|█         | 1022/9345 [21:03<2:22:24,  1.03s/it] 11%|█         | 1023/9345 [21:04<2:22:22,  1.03s/it] 11%|█         | 1024/9345 [21:05<2:22:07,  1.02s/it] 11%|█         | 1025/9345 [21:06<2:21:49,  1.02s/it] 11%|█         | 1026/9345 [21:07<2:21:32,  1.02s/it] 11%|█         | 1027/9345 [21:09<2:29:17,  1.08s/it] 11%|█         | 1028/9345 [21:10<2:26:45,  1.06s/it] 11%|█         | 1029/9345 [21:11<2:24:42,  1.04s/it] 11%|█         | 1030/9345 [21:12<2:23:17,  1.03s/it] 11%|█         | 1031/9345 [21:13<2:22:14,  1.03s/it] 11%|█         | 1032/9345 [21:14<2:21:21,  1.02s/it] 11%|█         | 1033/9345 [21:15<2:20:54,  1.02s/it] 11%|█         | 1034/9345 [21:16<2:20:37,  1.02s/it] 11%|█         | 1035/9345 [21:17<2:20:32,  1.01s/it] 11%|█         | 1036/9345 [21:18<2:20:35,  1.02s/it] 11%|█         | 1037/9345 [21:19<2:20:31,  1.01s/it] 11%|█         | 1038/9345 [21:20<2:20:30,  1.01s/it] 11%|█         | 1039/9345 [21:21<2:20:30,  1.01s/it] 11%|█         | 1040/9345 [21:22<2:20:43,  1.02s/it]                                                     {'loss': 0.3017, 'grad_norm': 0.5260145029687386, 'learning_rate': 2.782236490101659e-05, 'epoch': 0.56}
 11%|█         | 1040/9345 [21:22<2:20:43,  1.02s/it] 11%|█         | 1041/9345 [21:23<2:21:10,  1.02s/it] 11%|█         | 1042/9345 [21:24<2:28:12,  1.07s/it] 11%|█         | 1043/9345 [21:25<2:25:50,  1.05s/it] 11%|█         | 1044/9345 [21:26<2:24:17,  1.04s/it] 11%|█         | 1045/9345 [21:27<2:23:07,  1.03s/it] 11%|█         | 1046/9345 [21:28<2:22:33,  1.03s/it] 11%|█         | 1047/9345 [21:29<2:21:50,  1.03s/it] 11%|█         | 1048/9345 [21:30<2:21:28,  1.02s/it] 11%|█         | 1049/9345 [21:31<2:20:58,  1.02s/it] 11%|█         | 1050/9345 [21:32<2:20:50,  1.02s/it] 11%|█         | 1051/9345 [21:33<2:20:22,  1.02s/it] 11%|█▏        | 1052/9345 [21:34<2:20:07,  1.01s/it] 11%|█▏        | 1053/9345 [21:35<2:19:57,  1.01s/it] 11%|█▏        | 1054/9345 [21:36<2:20:17,  1.02s/it] 11%|█▏        | 1055/9345 [21:37<2:20:31,  1.02s/it] 11%|█▏        | 1056/9345 [21:38<2:27:38,  1.07s/it] 11%|█▏        | 1057/9345 [21:39<2:25:23,  1.05s/it] 11%|█▏        | 1058/9345 [21:40<2:24:01,  1.04s/it] 11%|█▏        | 1059/9345 [21:41<2:22:35,  1.03s/it] 11%|█▏        | 1060/9345 [21:42<2:21:51,  1.03s/it]                                                     {'loss': 0.3086, 'grad_norm': 0.6478554496850966, 'learning_rate': 2.8357410379882294e-05, 'epoch': 0.57}
 11%|█▏        | 1060/9345 [21:42<2:21:51,  1.03s/it] 11%|█▏        | 1061/9345 [21:44<2:21:43,  1.03s/it] 11%|█▏        | 1062/9345 [21:45<2:21:13,  1.02s/it] 11%|█▏        | 1063/9345 [21:46<2:21:16,  1.02s/it] 11%|█▏        | 1064/9345 [21:47<2:20:48,  1.02s/it] 11%|█▏        | 1065/9345 [21:48<2:20:16,  1.02s/it] 11%|█▏        | 1066/9345 [21:49<2:20:07,  1.02s/it] 11%|█▏        | 1067/9345 [21:50<2:21:02,  1.02s/it] 11%|█▏        | 1068/9345 [21:51<2:20:42,  1.02s/it] 11%|█▏        | 1069/9345 [21:52<2:20:39,  1.02s/it] 11%|█▏        | 1070/9345 [21:53<2:20:37,  1.02s/it] 11%|█▏        | 1071/9345 [21:54<2:27:33,  1.07s/it] 11%|█▏        | 1072/9345 [21:55<2:25:13,  1.05s/it] 11%|█▏        | 1073/9345 [21:56<2:23:19,  1.04s/it] 11%|█▏        | 1074/9345 [21:57<2:21:57,  1.03s/it] 12%|█▏        | 1075/9345 [21:58<2:21:20,  1.03s/it] 12%|█▏        | 1076/9345 [21:59<2:20:28,  1.02s/it] 12%|█▏        | 1077/9345 [22:00<2:19:57,  1.02s/it] 12%|█▏        | 1078/9345 [22:01<2:19:45,  1.01s/it] 12%|█▏        | 1079/9345 [22:02<2:19:34,  1.01s/it] 12%|█▏        | 1080/9345 [22:03<2:19:19,  1.01s/it]                                                     {'loss': 0.2934, 'grad_norm': 0.614348203434301, 'learning_rate': 2.8892455858747998e-05, 'epoch': 0.58}
 12%|█▏        | 1080/9345 [22:03<2:19:19,  1.01s/it] 12%|█▏        | 1081/9345 [22:04<2:19:49,  1.02s/it] 12%|█▏        | 1082/9345 [22:05<2:19:57,  1.02s/it] 12%|█▏        | 1083/9345 [22:06<2:20:03,  1.02s/it] 12%|█▏        | 1084/9345 [22:07<2:19:49,  1.02s/it] 12%|█▏        | 1085/9345 [22:08<2:27:56,  1.07s/it] 12%|█▏        | 1086/9345 [22:09<2:25:19,  1.06s/it] 12%|█▏        | 1087/9345 [22:10<2:23:41,  1.04s/it] 12%|█▏        | 1088/9345 [22:11<2:22:18,  1.03s/it] 12%|█▏        | 1089/9345 [22:12<2:21:18,  1.03s/it] 12%|█▏        | 1090/9345 [22:13<2:20:44,  1.02s/it] 12%|█▏        | 1091/9345 [22:14<2:20:22,  1.02s/it] 12%|█▏        | 1092/9345 [22:15<2:20:12,  1.02s/it] 12%|█▏        | 1093/9345 [22:16<2:19:49,  1.02s/it] 12%|█▏        | 1094/9345 [22:17<2:19:31,  1.01s/it] 12%|█▏        | 1095/9345 [22:18<2:19:13,  1.01s/it] 12%|█▏        | 1096/9345 [22:19<2:19:18,  1.01s/it] 12%|█▏        | 1097/9345 [22:20<2:19:00,  1.01s/it] 12%|█▏        | 1098/9345 [22:21<2:18:53,  1.01s/it] 12%|█▏        | 1099/9345 [22:22<2:18:37,  1.01s/it] 12%|█▏        | 1100/9345 [22:24<2:25:34,  1.06s/it]                                                     {'loss': 0.2543, 'grad_norm': 0.5529279994385738, 'learning_rate': 2.94275013376137e-05, 'epoch': 0.59}
 12%|█▏        | 1100/9345 [22:24<2:25:34,  1.06s/it][WARNING|trainer.py:3344] 2024-05-31 14:56:45,241 >>  stage3_gather_16bit_weights_on_model_save=false. Saving the full checkpoint instead, use zero_to_fp32.py to recover weights
[INFO|trainer.py:3410] 2024-05-31 14:56:45,242 >> Saving model checkpoint to ./checkpoint_dir/checkpoint-1100
/opt/conda/lib/python3.10/site-packages/peft/utils/save_and_load.py:154: UserWarning: Could not find a config file in ./ - will assume that the vocabulary was not modified.
  warnings.warn(
[INFO|tokenization_utils_base.py:2513] 2024-05-31 14:56:45,265 >> tokenizer config file saved in ./checkpoint_dir/checkpoint-1100/tokenizer_config.json
[INFO|tokenization_utils_base.py:2522] 2024-05-31 14:56:45,266 >> Special tokens file saved in ./checkpoint_dir/checkpoint-1100/special_tokens_map.json
[2024-05-31 14:56:45,361] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step1100 is about to be saved!
[2024-05-31 14:56:49,514] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-1100/global_step1100/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:56:49,514] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1100/global_step1100/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:57:01,955] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1100/global_step1100/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:57:02,291] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1100/global_step1100/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:57:02,986] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1100/global_step1100/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:57:02,988] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-1100/global_step1100/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:57:02,992] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step1100 is ready now!
[2024-05-31 14:57:03,021] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step1100 is about to be saved!
[2024-05-31 14:57:03,037] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-1100/global_step1100/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:57:03,037] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1100/global_step1100/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:57:04,250] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1100/global_step1100/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:57:04,251] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1100/global_step1100/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:57:05,008] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1100/global_step1100/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:57:05,010] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-1100/global_step1100/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:57:05,017] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step1100 is ready now!
[INFO|trainer.py:3502] 2024-05-31 14:57:05,024 >> Deleting older checkpoint [checkpoint_dir/checkpoint-1000] due to args.save_total_limit
 12%|█▏        | 1101/9345 [22:44<16:01:56,  7.00s/it] 12%|█▏        | 1102/9345 [22:45<11:55:00,  5.20s/it] 12%|█▏        | 1103/9345 [22:46<9:02:25,  3.95s/it]  12%|█▏        | 1104/9345 [22:47<7:01:25,  3.07s/it] 12%|█▏        | 1105/9345 [22:48<5:36:49,  2.45s/it] 12%|█▏        | 1106/9345 [22:50<4:37:27,  2.02s/it] 12%|█▏        | 1107/9345 [22:51<3:56:01,  1.72s/it] 12%|█▏        | 1108/9345 [22:52<3:27:00,  1.51s/it] 12%|█▏        | 1109/9345 [22:53<3:06:58,  1.36s/it] 12%|█▏        | 1110/9345 [22:54<2:52:38,  1.26s/it] 12%|█▏        | 1111/9345 [22:55<2:42:49,  1.19s/it] 12%|█▏        | 1112/9345 [22:56<2:36:08,  1.14s/it] 12%|█▏        | 1113/9345 [22:57<2:31:02,  1.10s/it] 12%|█▏        | 1114/9345 [22:58<2:34:52,  1.13s/it] 12%|█▏        | 1115/9345 [22:59<2:29:50,  1.09s/it] 12%|█▏        | 1116/9345 [23:00<2:26:31,  1.07s/it] 12%|█▏        | 1117/9345 [23:01<2:24:23,  1.05s/it] 12%|█▏        | 1118/9345 [23:02<2:23:05,  1.04s/it] 12%|█▏        | 1119/9345 [23:03<2:22:19,  1.04s/it] 12%|█▏        | 1120/9345 [23:04<2:21:21,  1.03s/it]                                                     {'loss': 0.2704, 'grad_norm': 0.5364277855217475, 'learning_rate': 2.9962546816479404e-05, 'epoch': 0.6}
 12%|█▏        | 1120/9345 [23:04<2:21:21,  1.03s/it] 12%|█▏        | 1121/9345 [23:05<2:21:43,  1.03s/it] 12%|█▏        | 1122/9345 [23:06<2:21:20,  1.03s/it] 12%|█▏        | 1123/9345 [23:07<2:20:59,  1.03s/it] 12%|█▏        | 1124/9345 [23:08<2:20:27,  1.03s/it] 12%|█▏        | 1125/9345 [23:09<2:20:04,  1.02s/it] 12%|█▏        | 1126/9345 [23:10<2:20:06,  1.02s/it] 12%|█▏        | 1127/9345 [23:11<2:19:48,  1.02s/it] 12%|█▏        | 1128/9345 [23:12<2:18:45,  1.01s/it] 12%|█▏        | 1129/9345 [23:13<2:26:15,  1.07s/it] 12%|█▏        | 1130/9345 [23:14<2:23:56,  1.05s/it] 12%|█▏        | 1131/9345 [23:15<2:22:28,  1.04s/it] 12%|█▏        | 1132/9345 [23:16<2:21:25,  1.03s/it] 12%|█▏        | 1133/9345 [23:17<2:20:22,  1.03s/it] 12%|█▏        | 1134/9345 [23:18<2:19:01,  1.02s/it] 12%|█▏        | 1135/9345 [23:19<2:18:09,  1.01s/it] 12%|█▏        | 1136/9345 [23:20<2:17:37,  1.01s/it] 12%|█▏        | 1137/9345 [23:21<2:17:10,  1.00s/it] 12%|█▏        | 1138/9345 [23:22<2:16:44,  1.00it/s] 12%|█▏        | 1139/9345 [23:23<2:16:23,  1.00it/s] 12%|█▏        | 1140/9345 [23:24<2:16:35,  1.00it/s]                                                     {'loss': 0.2992, 'grad_norm': 0.5174358179035384, 'learning_rate': 3.0497592295345107e-05, 'epoch': 0.61}
 12%|█▏        | 1140/9345 [23:24<2:16:35,  1.00it/s] 12%|█▏        | 1141/9345 [23:25<2:17:10,  1.00s/it] 12%|█▏        | 1142/9345 [23:26<2:17:01,  1.00s/it] 12%|█▏        | 1143/9345 [23:27<2:24:27,  1.06s/it] 12%|█▏        | 1144/9345 [23:29<2:22:24,  1.04s/it] 12%|█▏        | 1145/9345 [23:30<2:21:00,  1.03s/it] 12%|█▏        | 1146/9345 [23:31<2:20:29,  1.03s/it] 12%|█▏        | 1147/9345 [23:32<2:20:12,  1.03s/it] 12%|█▏        | 1148/9345 [23:33<2:19:48,  1.02s/it] 12%|█▏        | 1149/9345 [23:34<2:19:03,  1.02s/it] 12%|█▏        | 1150/9345 [23:35<2:18:38,  1.02s/it] 12%|█▏        | 1151/9345 [23:36<2:18:28,  1.01s/it] 12%|█▏        | 1152/9345 [23:37<2:18:23,  1.01s/it] 12%|█▏        | 1153/9345 [23:38<2:18:25,  1.01s/it] 12%|█▏        | 1154/9345 [23:39<2:18:40,  1.02s/it] 12%|█▏        | 1155/9345 [23:40<2:18:23,  1.01s/it] 12%|█▏        | 1156/9345 [23:41<2:18:18,  1.01s/it] 12%|█▏        | 1157/9345 [23:42<2:17:49,  1.01s/it] 12%|█▏        | 1158/9345 [23:43<2:24:01,  1.06s/it] 12%|█▏        | 1159/9345 [23:44<2:21:32,  1.04s/it] 12%|█▏        | 1160/9345 [23:45<2:20:12,  1.03s/it]                                                     {'loss': 0.2698, 'grad_norm': 0.4792244212054028, 'learning_rate': 3.103263777421081e-05, 'epoch': 0.62}
 12%|█▏        | 1160/9345 [23:45<2:20:12,  1.03s/it] 12%|█▏        | 1161/9345 [23:46<2:20:04,  1.03s/it] 12%|█▏        | 1162/9345 [23:47<2:19:22,  1.02s/it] 12%|█▏        | 1163/9345 [23:48<2:18:47,  1.02s/it] 12%|█▏        | 1164/9345 [23:49<2:18:11,  1.01s/it] 12%|█▏        | 1165/9345 [23:50<2:17:56,  1.01s/it] 12%|█▏        | 1166/9345 [23:51<2:17:58,  1.01s/it] 12%|█▏        | 1167/9345 [23:52<2:17:43,  1.01s/it] 12%|█▏        | 1168/9345 [23:53<2:17:27,  1.01s/it] 13%|█▎        | 1169/9345 [23:54<2:17:32,  1.01s/it] 13%|█▎        | 1170/9345 [23:55<2:18:01,  1.01s/it] 13%|█▎        | 1171/9345 [23:56<2:17:57,  1.01s/it] 13%|█▎        | 1172/9345 [23:57<2:24:21,  1.06s/it] 13%|█▎        | 1173/9345 [23:58<2:22:02,  1.04s/it] 13%|█▎        | 1174/9345 [23:59<2:20:41,  1.03s/it] 13%|█▎        | 1175/9345 [24:00<2:19:35,  1.03s/it] 13%|█▎        | 1176/9345 [24:01<2:18:50,  1.02s/it] 13%|█▎        | 1177/9345 [24:02<2:18:54,  1.02s/it] 13%|█▎        | 1178/9345 [24:03<2:18:22,  1.02s/it] 13%|█▎        | 1179/9345 [24:04<2:17:25,  1.01s/it] 13%|█▎        | 1180/9345 [24:05<2:17:27,  1.01s/it]                                                     {'loss': 0.278, 'grad_norm': 0.511104489893913, 'learning_rate': 3.156768325307651e-05, 'epoch': 0.63}
 13%|█▎        | 1180/9345 [24:05<2:17:27,  1.01s/it] 13%|█▎        | 1181/9345 [24:06<2:18:25,  1.02s/it] 13%|█▎        | 1182/9345 [24:07<2:18:49,  1.02s/it] 13%|█▎        | 1183/9345 [24:08<2:19:18,  1.02s/it] 13%|█▎        | 1184/9345 [24:09<2:19:33,  1.03s/it] 13%|█▎        | 1185/9345 [24:10<2:18:46,  1.02s/it] 13%|█▎        | 1186/9345 [24:11<2:18:30,  1.02s/it] 13%|█▎        | 1187/9345 [24:13<2:26:08,  1.07s/it] 13%|█▎        | 1188/9345 [24:14<2:23:02,  1.05s/it] 13%|█▎        | 1189/9345 [24:15<2:21:12,  1.04s/it] 13%|█▎        | 1190/9345 [24:16<2:19:55,  1.03s/it] 13%|█▎        | 1191/9345 [24:17<2:19:23,  1.03s/it] 13%|█▎        | 1192/9345 [24:18<2:18:56,  1.02s/it] 13%|█▎        | 1193/9345 [24:19<2:18:21,  1.02s/it] 13%|█▎        | 1194/9345 [24:20<2:17:44,  1.01s/it] 13%|█▎        | 1195/9345 [24:21<2:17:37,  1.01s/it] 13%|█▎        | 1196/9345 [24:22<2:17:07,  1.01s/it] 13%|█▎        | 1197/9345 [24:23<2:17:41,  1.01s/it] 13%|█▎        | 1198/9345 [24:24<2:17:44,  1.01s/it] 13%|█▎        | 1199/9345 [24:25<2:17:59,  1.02s/it] 13%|█▎        | 1200/9345 [24:26<2:17:54,  1.02s/it]                                                     {'loss': 0.277, 'grad_norm': 0.4414627435598209, 'learning_rate': 3.2102728731942213e-05, 'epoch': 0.64}
 13%|█▎        | 1200/9345 [24:26<2:17:54,  1.02s/it][WARNING|trainer.py:3344] 2024-05-31 14:58:47,355 >>  stage3_gather_16bit_weights_on_model_save=false. Saving the full checkpoint instead, use zero_to_fp32.py to recover weights
[INFO|trainer.py:3410] 2024-05-31 14:58:47,356 >> Saving model checkpoint to ./checkpoint_dir/checkpoint-1200
/opt/conda/lib/python3.10/site-packages/peft/utils/save_and_load.py:154: UserWarning: Could not find a config file in ./ - will assume that the vocabulary was not modified.
  warnings.warn(
[INFO|tokenization_utils_base.py:2513] 2024-05-31 14:58:47,379 >> tokenizer config file saved in ./checkpoint_dir/checkpoint-1200/tokenizer_config.json
[INFO|tokenization_utils_base.py:2522] 2024-05-31 14:58:47,380 >> Special tokens file saved in ./checkpoint_dir/checkpoint-1200/special_tokens_map.json
[2024-05-31 14:58:47,475] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step1200 is about to be saved!
[2024-05-31 14:58:51,577] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-1200/global_step1200/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:58:51,577] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1200/global_step1200/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:59:03,868] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1200/global_step1200/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:59:04,204] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1200/global_step1200/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:59:04,898] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1200/global_step1200/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:59:04,900] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-1200/global_step1200/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:59:04,906] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step1200 is ready now!
[2024-05-31 14:59:04,934] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step1200 is about to be saved!
[2024-05-31 14:59:04,950] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-1200/global_step1200/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 14:59:04,950] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1200/global_step1200/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 14:59:06,162] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1200/global_step1200/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 14:59:06,164] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1200/global_step1200/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 14:59:07,151] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1200/global_step1200/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 14:59:07,154] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-1200/global_step1200/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 14:59:07,159] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step1200 is ready now!
[INFO|trainer.py:3502] 2024-05-31 14:59:07,166 >> Deleting older checkpoint [checkpoint_dir/checkpoint-1100] due to args.save_total_limit
 13%|█▎        | 1201/9345 [24:47<15:51:51,  7.01s/it] 13%|█▎        | 1202/9345 [24:48<11:57:13,  5.28s/it] 13%|█▎        | 1203/9345 [24:49<9:04:29,  4.01s/it]  13%|█▎        | 1204/9345 [24:50<7:04:25,  3.13s/it] 13%|█▎        | 1205/9345 [24:51<5:43:36,  2.53s/it] 13%|█▎        | 1206/9345 [24:52<4:42:20,  2.08s/it] 13%|█▎        | 1207/9345 [24:53<3:59:34,  1.77s/it] 13%|█▎        | 1208/9345 [24:54<3:30:07,  1.55s/it] 13%|█▎        | 1209/9345 [24:55<3:09:19,  1.40s/it] 13%|█▎        | 1210/9345 [24:57<3:00:30,  1.33s/it] 13%|█▎        | 1211/9345 [24:58<2:56:29,  1.30s/it] 13%|█▎        | 1212/9345 [24:59<2:52:06,  1.27s/it] 13%|█▎        | 1213/9345 [25:00<2:43:00,  1.20s/it] 13%|█▎        | 1214/9345 [25:01<2:35:09,  1.14s/it] 13%|█▎        | 1215/9345 [25:02<2:29:44,  1.11s/it] 13%|█▎        | 1216/9345 [25:03<2:32:22,  1.12s/it] 13%|█▎        | 1217/9345 [25:04<2:28:33,  1.10s/it] 13%|█▎        | 1218/9345 [25:05<2:25:08,  1.07s/it] 13%|█▎        | 1219/9345 [25:06<2:22:14,  1.05s/it] 13%|█▎        | 1220/9345 [25:07<2:21:04,  1.04s/it]                                                     {'loss': 0.3055, 'grad_norm': 0.620673772344679, 'learning_rate': 3.263777421080792e-05, 'epoch': 0.65}
 13%|█▎        | 1220/9345 [25:07<2:21:04,  1.04s/it] 13%|█▎        | 1221/9345 [25:08<2:20:14,  1.04s/it] 13%|█▎        | 1222/9345 [25:09<2:19:09,  1.03s/it] 13%|█▎        | 1223/9345 [25:10<2:18:38,  1.02s/it] 13%|█▎        | 1224/9345 [25:11<2:17:56,  1.02s/it] 13%|█▎        | 1225/9345 [25:12<2:18:01,  1.02s/it] 13%|█▎        | 1226/9345 [25:13<2:17:46,  1.02s/it] 13%|█▎        | 1227/9345 [25:14<2:17:43,  1.02s/it] 13%|█▎        | 1228/9345 [25:15<2:17:07,  1.01s/it] 13%|█▎        | 1229/9345 [25:16<2:16:42,  1.01s/it] 13%|█▎        | 1230/9345 [25:17<2:16:39,  1.01s/it] 13%|█▎        | 1231/9345 [25:19<2:23:39,  1.06s/it] 13%|█▎        | 1232/9345 [25:20<2:21:22,  1.05s/it] 13%|█▎        | 1233/9345 [25:21<2:19:41,  1.03s/it] 13%|█▎        | 1234/9345 [25:22<2:18:48,  1.03s/it] 13%|█▎        | 1235/9345 [25:23<2:18:05,  1.02s/it] 13%|█▎        | 1236/9345 [25:24<2:17:22,  1.02s/it] 13%|█▎        | 1237/9345 [25:25<2:16:59,  1.01s/it] 13%|█▎        | 1238/9345 [25:26<2:17:01,  1.01s/it] 13%|█▎        | 1239/9345 [25:27<2:17:07,  1.02s/it] 13%|█▎        | 1240/9345 [25:28<2:17:17,  1.02s/it]                                                     {'loss': 0.2895, 'grad_norm': 0.5105032867499146, 'learning_rate': 3.317281968967362e-05, 'epoch': 0.66}
 13%|█▎        | 1240/9345 [25:28<2:17:17,  1.02s/it] 13%|█▎        | 1241/9345 [25:29<2:17:34,  1.02s/it] 13%|█▎        | 1242/9345 [25:30<2:17:48,  1.02s/it] 13%|█▎        | 1243/9345 [25:31<2:17:45,  1.02s/it] 13%|█▎        | 1244/9345 [25:32<2:17:39,  1.02s/it] 13%|█▎        | 1245/9345 [25:33<2:25:01,  1.07s/it] 13%|█▎        | 1246/9345 [25:34<2:23:07,  1.06s/it] 13%|█▎        | 1247/9345 [25:35<2:21:49,  1.05s/it] 13%|█▎        | 1248/9345 [25:36<2:20:59,  1.04s/it] 13%|█▎        | 1249/9345 [25:37<2:20:08,  1.04s/it] 13%|█▎        | 1250/9345 [25:38<2:19:34,  1.03s/it] 13%|█▎        | 1251/9345 [25:39<2:19:07,  1.03s/it] 13%|█▎        | 1252/9345 [25:40<2:18:31,  1.03s/it] 13%|█▎        | 1253/9345 [25:41<2:18:22,  1.03s/it] 13%|█▎        | 1254/9345 [25:42<2:18:27,  1.03s/it] 13%|█▎        | 1255/9345 [25:43<2:18:17,  1.03s/it] 13%|█▎        | 1256/9345 [25:44<2:18:01,  1.02s/it] 13%|█▎        | 1257/9345 [25:45<2:18:19,  1.03s/it] 13%|█▎        | 1258/9345 [25:46<2:18:14,  1.03s/it] 13%|█▎        | 1259/9345 [25:47<2:18:09,  1.03s/it] 13%|█▎        | 1260/9345 [25:49<2:25:32,  1.08s/it]                                                     {'loss': 0.2804, 'grad_norm': 0.8887877501935774, 'learning_rate': 3.370786516853933e-05, 'epoch': 0.67}
 13%|█▎        | 1260/9345 [25:49<2:25:32,  1.08s/it] 13%|█▎        | 1261/9345 [25:50<2:23:35,  1.07s/it] 14%|█▎        | 1262/9345 [25:51<2:21:50,  1.05s/it] 14%|█▎        | 1263/9345 [25:52<2:20:32,  1.04s/it] 14%|█▎        | 1264/9345 [25:53<2:19:28,  1.04s/it] 14%|█▎        | 1265/9345 [25:54<2:19:12,  1.03s/it] 14%|█▎        | 1266/9345 [25:55<2:18:51,  1.03s/it] 14%|█▎        | 1267/9345 [25:56<2:18:09,  1.03s/it] 14%|█▎        | 1268/9345 [25:57<2:18:04,  1.03s/it] 14%|█▎        | 1269/9345 [25:58<2:18:10,  1.03s/it] 14%|█▎        | 1270/9345 [25:59<2:18:01,  1.03s/it] 14%|█▎        | 1271/9345 [26:00<2:17:49,  1.02s/it] 14%|█▎        | 1272/9345 [26:01<2:18:05,  1.03s/it] 14%|█▎        | 1273/9345 [26:02<2:18:25,  1.03s/it] 14%|█▎        | 1274/9345 [26:03<2:25:11,  1.08s/it] 14%|█▎        | 1275/9345 [26:04<2:23:16,  1.07s/it] 14%|█▎        | 1276/9345 [26:05<2:21:54,  1.06s/it] 14%|█▎        | 1277/9345 [26:06<2:20:49,  1.05s/it] 14%|█▎        | 1278/9345 [26:07<2:19:47,  1.04s/it] 14%|█▎        | 1279/9345 [26:08<2:19:09,  1.04s/it] 14%|█▎        | 1280/9345 [26:09<2:18:19,  1.03s/it]                                                     {'loss': 0.273, 'grad_norm': 0.5625964948617145, 'learning_rate': 3.424291064740503e-05, 'epoch': 0.68}
 14%|█▎        | 1280/9345 [26:09<2:18:19,  1.03s/it] 14%|█▎        | 1281/9345 [26:10<2:18:28,  1.03s/it] 14%|█▎        | 1282/9345 [26:11<2:17:54,  1.03s/it] 14%|█▎        | 1283/9345 [26:12<2:17:33,  1.02s/it] 14%|█▎        | 1284/9345 [26:13<2:17:08,  1.02s/it] 14%|█▍        | 1285/9345 [26:14<2:16:41,  1.02s/it] 14%|█▍        | 1286/9345 [26:15<2:16:53,  1.02s/it] 14%|█▍        | 1287/9345 [26:16<2:16:48,  1.02s/it] 14%|█▍        | 1288/9345 [26:17<2:17:08,  1.02s/it] 14%|█▍        | 1289/9345 [26:19<2:23:58,  1.07s/it] 14%|█▍        | 1290/9345 [26:20<2:21:41,  1.06s/it] 14%|█▍        | 1291/9345 [26:21<2:20:06,  1.04s/it] 14%|█▍        | 1292/9345 [26:22<2:18:53,  1.03s/it] 14%|█▍        | 1293/9345 [26:23<2:18:16,  1.03s/it] 14%|█▍        | 1294/9345 [26:24<2:17:44,  1.03s/it] 14%|█▍        | 1295/9345 [26:25<2:17:36,  1.03s/it] 14%|█▍        | 1296/9345 [26:26<2:17:39,  1.03s/it] 14%|█▍        | 1297/9345 [26:27<2:17:51,  1.03s/it] 14%|█▍        | 1298/9345 [26:28<2:17:33,  1.03s/it] 14%|█▍        | 1299/9345 [26:29<2:17:28,  1.03s/it] 14%|█▍        | 1300/9345 [26:30<2:17:26,  1.03s/it]                                                     {'loss': 0.2971, 'grad_norm': 0.3416531747146797, 'learning_rate': 3.4777956126270736e-05, 'epoch': 0.7}
 14%|█▍        | 1300/9345 [26:30<2:17:26,  1.03s/it][WARNING|trainer.py:3344] 2024-05-31 15:00:51,437 >>  stage3_gather_16bit_weights_on_model_save=false. Saving the full checkpoint instead, use zero_to_fp32.py to recover weights
[INFO|trainer.py:3410] 2024-05-31 15:00:51,438 >> Saving model checkpoint to ./checkpoint_dir/checkpoint-1300
/opt/conda/lib/python3.10/site-packages/peft/utils/save_and_load.py:154: UserWarning: Could not find a config file in ./ - will assume that the vocabulary was not modified.
  warnings.warn(
[INFO|tokenization_utils_base.py:2513] 2024-05-31 15:00:51,456 >> tokenizer config file saved in ./checkpoint_dir/checkpoint-1300/tokenizer_config.json
[INFO|tokenization_utils_base.py:2522] 2024-05-31 15:00:51,457 >> Special tokens file saved in ./checkpoint_dir/checkpoint-1300/special_tokens_map.json
[2024-05-31 15:00:51,546] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step1300 is about to be saved!
[2024-05-31 15:00:56,237] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-1300/global_step1300/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 15:00:56,237] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1300/global_step1300/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 15:01:08,758] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1300/global_step1300/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 15:01:09,075] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1300/global_step1300/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 15:01:09,704] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1300/global_step1300/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 15:01:09,726] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-1300/global_step1300/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 15:01:09,729] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step1300 is ready now!
[2024-05-31 15:01:09,758] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step1300 is about to be saved!
[2024-05-31 15:01:09,774] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-1300/global_step1300/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 15:01:09,774] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1300/global_step1300/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 15:01:11,021] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1300/global_step1300/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 15:01:11,023] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1300/global_step1300/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 15:01:11,793] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1300/global_step1300/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 15:01:11,796] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-1300/global_step1300/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 15:01:11,802] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step1300 is ready now!
[INFO|trainer.py:3502] 2024-05-31 15:01:11,809 >> Deleting older checkpoint [checkpoint_dir/checkpoint-1200] due to args.save_total_limit
 14%|█▍        | 1301/9345 [26:51<15:59:14,  7.15s/it] 14%|█▍        | 1302/9345 [26:52<11:52:26,  5.31s/it] 14%|█▍        | 1303/9345 [26:53<9:07:47,  4.09s/it]  14%|█▍        | 1304/9345 [26:54<7:04:25,  3.17s/it] 14%|█▍        | 1305/9345 [26:56<5:38:14,  2.52s/it] 14%|█▍        | 1306/9345 [26:57<4:38:02,  2.08s/it] 14%|█▍        | 1307/9345 [26:58<3:55:33,  1.76s/it] 14%|█▍        | 1308/9345 [26:59<3:25:46,  1.54s/it] 14%|█▍        | 1309/9345 [27:00<3:05:07,  1.38s/it] 14%|█▍        | 1310/9345 [27:01<2:51:03,  1.28s/it] 14%|█▍        | 1311/9345 [27:02<2:40:31,  1.20s/it] 14%|█▍        | 1312/9345 [27:03<2:33:20,  1.15s/it] 14%|█▍        | 1313/9345 [27:04<2:28:05,  1.11s/it] 14%|█▍        | 1314/9345 [27:05<2:25:00,  1.08s/it] 14%|█▍        | 1315/9345 [27:06<2:22:28,  1.06s/it] 14%|█▍        | 1316/9345 [27:07<2:20:26,  1.05s/it] 14%|█▍        | 1317/9345 [27:08<2:19:24,  1.04s/it] 14%|█▍        | 1318/9345 [27:09<2:24:51,  1.08s/it] 14%|█▍        | 1319/9345 [27:10<2:22:01,  1.06s/it] 14%|█▍        | 1320/9345 [27:11<2:20:20,  1.05s/it]                                                     {'loss': 0.2453, 'grad_norm': 0.7591018306164938, 'learning_rate': 3.531300160513644e-05, 'epoch': 0.71}
 14%|█▍        | 1320/9345 [27:11<2:20:20,  1.05s/it] 14%|█▍        | 1321/9345 [27:12<2:19:38,  1.04s/it] 14%|█▍        | 1322/9345 [27:13<2:18:39,  1.04s/it] 14%|█▍        | 1323/9345 [27:14<2:17:58,  1.03s/it] 14%|█▍        | 1324/9345 [27:15<2:17:21,  1.03s/it] 14%|█▍        | 1325/9345 [27:16<2:17:00,  1.03s/it] 14%|█▍        | 1326/9345 [27:17<2:16:57,  1.02s/it] 14%|█▍        | 1327/9345 [27:18<2:16:31,  1.02s/it] 14%|█▍        | 1328/9345 [27:19<2:16:29,  1.02s/it] 14%|█▍        | 1329/9345 [27:20<2:16:05,  1.02s/it] 14%|█▍        | 1330/9345 [27:21<2:16:07,  1.02s/it] 14%|█▍        | 1331/9345 [27:22<2:16:00,  1.02s/it] 14%|█▍        | 1332/9345 [27:23<2:23:25,  1.07s/it] 14%|█▍        | 1333/9345 [27:24<2:21:07,  1.06s/it] 14%|█▍        | 1334/9345 [27:25<2:19:54,  1.05s/it] 14%|█▍        | 1335/9345 [27:26<2:18:34,  1.04s/it] 14%|█▍        | 1336/9345 [27:27<2:18:04,  1.03s/it] 14%|█▍        | 1337/9345 [27:29<2:17:17,  1.03s/it] 14%|█▍        | 1338/9345 [27:30<2:16:55,  1.03s/it] 14%|█▍        | 1339/9345 [27:31<2:16:49,  1.03s/it] 14%|█▍        | 1340/9345 [27:32<2:17:06,  1.03s/it]                                                     {'loss': 0.2691, 'grad_norm': 0.9885506794316444, 'learning_rate': 3.584804708400214e-05, 'epoch': 0.72}
 14%|█▍        | 1340/9345 [27:32<2:17:06,  1.03s/it] 14%|█▍        | 1341/9345 [27:33<2:17:05,  1.03s/it] 14%|█▍        | 1342/9345 [27:34<2:17:03,  1.03s/it] 14%|█▍        | 1343/9345 [27:35<2:16:48,  1.03s/it] 14%|█▍        | 1344/9345 [27:36<2:17:08,  1.03s/it] 14%|█▍        | 1345/9345 [27:37<2:16:46,  1.03s/it] 14%|█▍        | 1346/9345 [27:38<2:16:51,  1.03s/it] 14%|█▍        | 1347/9345 [27:39<2:23:08,  1.07s/it] 14%|█▍        | 1348/9345 [27:40<2:20:55,  1.06s/it] 14%|█▍        | 1349/9345 [27:41<2:19:16,  1.05s/it] 14%|█▍        | 1350/9345 [27:42<2:18:11,  1.04s/it] 14%|█▍        | 1351/9345 [27:43<2:17:55,  1.04s/it] 14%|█▍        | 1352/9345 [27:44<2:17:32,  1.03s/it] 14%|█▍        | 1353/9345 [27:45<2:17:29,  1.03s/it] 14%|█▍        | 1354/9345 [27:46<2:17:02,  1.03s/it] 14%|█▍        | 1355/9345 [27:47<2:16:09,  1.02s/it] 15%|█▍        | 1356/9345 [27:48<2:15:53,  1.02s/it] 15%|█▍        | 1357/9345 [27:49<2:15:12,  1.02s/it] 15%|█▍        | 1358/9345 [27:50<2:14:45,  1.01s/it] 15%|█▍        | 1359/9345 [27:51<2:14:22,  1.01s/it] 15%|█▍        | 1360/9345 [27:52<2:14:38,  1.01s/it]                                                     {'loss': 0.2774, 'grad_norm': 0.4838639273765098, 'learning_rate': 3.6383092562867846e-05, 'epoch': 0.73}
 15%|█▍        | 1360/9345 [27:52<2:14:38,  1.01s/it] 15%|█▍        | 1361/9345 [27:53<2:22:05,  1.07s/it] 15%|█▍        | 1362/9345 [27:54<2:20:03,  1.05s/it] 15%|█▍        | 1363/9345 [27:55<2:18:44,  1.04s/it] 15%|█▍        | 1364/9345 [27:56<2:17:56,  1.04s/it] 15%|█▍        | 1365/9345 [27:57<2:17:35,  1.03s/it] 15%|█▍        | 1366/9345 [27:58<2:17:09,  1.03s/it] 15%|█▍        | 1367/9345 [27:59<2:16:39,  1.03s/it] 15%|█▍        | 1368/9345 [28:00<2:16:12,  1.02s/it] 15%|█▍        | 1369/9345 [28:02<2:15:47,  1.02s/it] 15%|█▍        | 1370/9345 [28:03<2:15:36,  1.02s/it] 15%|█▍        | 1371/9345 [28:04<2:16:11,  1.02s/it] 15%|█▍        | 1372/9345 [28:05<2:16:08,  1.02s/it] 15%|█▍        | 1373/9345 [28:06<2:15:58,  1.02s/it] 15%|█▍        | 1374/9345 [28:07<2:16:00,  1.02s/it] 15%|█▍        | 1375/9345 [28:08<2:16:29,  1.03s/it] 15%|█▍        | 1376/9345 [28:09<2:22:39,  1.07s/it] 15%|█▍        | 1377/9345 [28:10<2:20:26,  1.06s/it] 15%|█▍        | 1378/9345 [28:11<2:18:40,  1.04s/it] 15%|█▍        | 1379/9345 [28:12<2:17:30,  1.04s/it] 15%|█▍        | 1380/9345 [28:13<2:16:42,  1.03s/it]                                                     {'loss': 0.2973, 'grad_norm': 0.5605583559839925, 'learning_rate': 3.691813804173355e-05, 'epoch': 0.74}
 15%|█▍        | 1380/9345 [28:13<2:16:42,  1.03s/it] 15%|█▍        | 1381/9345 [28:14<2:16:45,  1.03s/it] 15%|█▍        | 1382/9345 [28:15<2:16:35,  1.03s/it] 15%|█▍        | 1383/9345 [28:16<2:16:42,  1.03s/it] 15%|█▍        | 1384/9345 [28:17<2:16:32,  1.03s/it] 15%|█▍        | 1385/9345 [28:18<2:16:23,  1.03s/it] 15%|█▍        | 1386/9345 [28:19<2:15:55,  1.02s/it] 15%|█▍        | 1387/9345 [28:20<2:15:32,  1.02s/it] 15%|█▍        | 1388/9345 [28:21<2:15:24,  1.02s/it] 15%|█▍        | 1389/9345 [28:22<2:15:25,  1.02s/it] 15%|█▍        | 1390/9345 [28:23<2:15:21,  1.02s/it] 15%|█▍        | 1391/9345 [28:24<2:22:45,  1.08s/it] 15%|█▍        | 1392/9345 [28:25<2:20:40,  1.06s/it] 15%|█▍        | 1393/9345 [28:26<2:19:10,  1.05s/it] 15%|█▍        | 1394/9345 [28:27<2:18:08,  1.04s/it] 15%|█▍        | 1395/9345 [28:28<2:17:18,  1.04s/it] 15%|█▍        | 1396/9345 [28:29<2:16:48,  1.03s/it] 15%|█▍        | 1397/9345 [28:30<2:16:18,  1.03s/it] 15%|█▍        | 1398/9345 [28:32<2:15:45,  1.02s/it] 15%|█▍        | 1399/9345 [28:33<2:15:43,  1.02s/it] 15%|█▍        | 1400/9345 [28:34<2:15:21,  1.02s/it]                                                     {'loss': 0.3129, 'grad_norm': 0.575538176739685, 'learning_rate': 3.745318352059925e-05, 'epoch': 0.75}
 15%|█▍        | 1400/9345 [28:34<2:15:21,  1.02s/it][WARNING|trainer.py:3344] 2024-05-31 15:02:55,219 >>  stage3_gather_16bit_weights_on_model_save=false. Saving the full checkpoint instead, use zero_to_fp32.py to recover weights
[INFO|trainer.py:3410] 2024-05-31 15:02:55,220 >> Saving model checkpoint to ./checkpoint_dir/checkpoint-1400
/opt/conda/lib/python3.10/site-packages/peft/utils/save_and_load.py:154: UserWarning: Could not find a config file in ./ - will assume that the vocabulary was not modified.
  warnings.warn(
[INFO|tokenization_utils_base.py:2513] 2024-05-31 15:02:55,245 >> tokenizer config file saved in ./checkpoint_dir/checkpoint-1400/tokenizer_config.json
[INFO|tokenization_utils_base.py:2522] 2024-05-31 15:02:55,245 >> Special tokens file saved in ./checkpoint_dir/checkpoint-1400/special_tokens_map.json
[2024-05-31 15:02:55,339] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step1400 is about to be saved!
[2024-05-31 15:02:59,369] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-1400/global_step1400/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 15:02:59,369] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1400/global_step1400/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 15:03:11,641] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1400/global_step1400/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 15:03:11,966] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1400/global_step1400/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 15:03:12,592] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1400/global_step1400/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 15:03:12,593] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-1400/global_step1400/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 15:03:12,597] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step1400 is ready now!
[2024-05-31 15:03:12,626] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step1400 is about to be saved!
[2024-05-31 15:03:12,642] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-1400/global_step1400/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 15:03:12,642] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1400/global_step1400/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 15:03:13,838] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1400/global_step1400/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 15:03:13,839] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1400/global_step1400/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 15:03:14,576] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1400/global_step1400/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 15:03:14,577] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-1400/global_step1400/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 15:03:14,584] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step1400 is ready now!
[INFO|trainer.py:3502] 2024-05-31 15:03:14,590 >> Deleting older checkpoint [checkpoint_dir/checkpoint-1300] due to args.save_total_limit
 15%|█▍        | 1401/9345 [28:54<15:07:44,  6.86s/it] 15%|█▌        | 1402/9345 [28:55<11:16:08,  5.11s/it] 15%|█▌        | 1403/9345 [28:56<8:34:12,  3.88s/it]  15%|█▌        | 1404/9345 [28:57<6:40:36,  3.03s/it] 15%|█▌        | 1405/9345 [28:58<5:29:08,  2.49s/it] 15%|█▌        | 1406/9345 [28:59<4:31:08,  2.05s/it] 15%|█▌        | 1407/9345 [29:00<3:50:53,  1.75s/it] 15%|█▌        | 1408/9345 [29:01<3:21:47,  1.53s/it] 15%|█▌        | 1409/9345 [29:02<3:01:51,  1.37s/it] 15%|█▌        | 1410/9345 [29:03<2:47:38,  1.27s/it] 15%|█▌        | 1411/9345 [29:04<2:37:57,  1.19s/it] 15%|█▌        | 1412/9345 [29:05<2:31:09,  1.14s/it] 15%|█▌        | 1413/9345 [29:07<2:26:24,  1.11s/it] 15%|█▌        | 1414/9345 [29:08<2:22:55,  1.08s/it] 15%|█▌        | 1415/9345 [29:09<2:20:31,  1.06s/it] 15%|█▌        | 1416/9345 [29:10<2:19:11,  1.05s/it] 15%|█▌        | 1417/9345 [29:11<2:17:49,  1.04s/it] 15%|█▌        | 1418/9345 [29:12<2:16:48,  1.04s/it] 15%|█▌        | 1419/9345 [29:13<2:23:08,  1.08s/it] 15%|█▌        | 1420/9345 [29:14<2:21:38,  1.07s/it]                                                     {'loss': 0.3046, 'grad_norm': 0.5037999846472704, 'learning_rate': 3.7988228999464956e-05, 'epoch': 0.76}
 15%|█▌        | 1420/9345 [29:14<2:21:38,  1.07s/it] 15%|█▌        | 1421/9345 [29:15<2:20:07,  1.06s/it] 15%|█▌        | 1422/9345 [29:16<2:18:45,  1.05s/it] 15%|█▌        | 1423/9345 [29:17<2:17:37,  1.04s/it] 15%|█▌        | 1424/9345 [29:18<2:16:45,  1.04s/it] 15%|█▌        | 1425/9345 [29:19<2:15:57,  1.03s/it] 15%|█▌        | 1426/9345 [29:20<2:15:41,  1.03s/it] 15%|█▌        | 1427/9345 [29:21<2:15:20,  1.03s/it] 15%|█▌        | 1428/9345 [29:22<2:15:07,  1.02s/it] 15%|█▌        | 1429/9345 [29:23<2:15:06,  1.02s/it] 15%|█▌        | 1430/9345 [29:24<2:14:56,  1.02s/it] 15%|█▌        | 1431/9345 [29:25<2:15:03,  1.02s/it] 15%|█▌        | 1432/9345 [29:26<2:15:19,  1.03s/it] 15%|█▌        | 1433/9345 [29:27<2:15:13,  1.03s/it] 15%|█▌        | 1434/9345 [29:28<2:21:52,  1.08s/it] 15%|█▌        | 1435/9345 [29:29<2:19:27,  1.06s/it] 15%|█▌        | 1436/9345 [29:30<2:18:09,  1.05s/it] 15%|█▌        | 1437/9345 [29:31<2:17:00,  1.04s/it] 15%|█▌        | 1438/9345 [29:32<2:16:31,  1.04s/it] 15%|█▌        | 1439/9345 [29:33<2:15:59,  1.03s/it] 15%|█▌        | 1440/9345 [29:35<2:15:44,  1.03s/it]                                                     {'loss': 0.2923, 'grad_norm': 0.3707969534834106, 'learning_rate': 3.852327447833066e-05, 'epoch': 0.77}
 15%|█▌        | 1440/9345 [29:35<2:15:44,  1.03s/it] 15%|█▌        | 1441/9345 [29:36<2:15:39,  1.03s/it] 15%|█▌        | 1442/9345 [29:37<2:15:32,  1.03s/it] 15%|█▌        | 1443/9345 [29:38<2:15:37,  1.03s/it] 15%|█▌        | 1444/9345 [29:39<2:15:13,  1.03s/it] 15%|█▌        | 1445/9345 [29:40<2:15:36,  1.03s/it] 15%|█▌        | 1446/9345 [29:41<2:15:03,  1.03s/it] 15%|█▌        | 1447/9345 [29:42<2:14:36,  1.02s/it] 15%|█▌        | 1448/9345 [29:43<2:14:22,  1.02s/it] 16%|█▌        | 1449/9345 [29:44<2:21:51,  1.08s/it] 16%|█▌        | 1450/9345 [29:45<2:20:12,  1.07s/it] 16%|█▌        | 1451/9345 [29:46<2:18:35,  1.05s/it] 16%|█▌        | 1452/9345 [29:47<2:17:19,  1.04s/it] 16%|█▌        | 1453/9345 [29:48<2:16:46,  1.04s/it] 16%|█▌        | 1454/9345 [29:49<2:16:11,  1.04s/it] 16%|█▌        | 1455/9345 [29:50<2:15:50,  1.03s/it] 16%|█▌        | 1456/9345 [29:51<2:15:37,  1.03s/it] 16%|█▌        | 1457/9345 [29:52<2:14:59,  1.03s/it] 16%|█▌        | 1458/9345 [29:53<2:14:30,  1.02s/it] 16%|█▌        | 1459/9345 [29:54<2:14:49,  1.03s/it] 16%|█▌        | 1460/9345 [29:55<2:14:40,  1.02s/it]                                                     {'loss': 0.2874, 'grad_norm': 0.9305174934699338, 'learning_rate': 3.905831995719636e-05, 'epoch': 0.78}
 16%|█▌        | 1460/9345 [29:55<2:14:40,  1.02s/it] 16%|█▌        | 1461/9345 [29:56<2:15:14,  1.03s/it] 16%|█▌        | 1462/9345 [29:57<2:15:13,  1.03s/it] 16%|█▌        | 1463/9345 [29:58<2:22:00,  1.08s/it] 16%|█▌        | 1464/9345 [29:59<2:19:46,  1.06s/it] 16%|█▌        | 1465/9345 [30:01<2:18:18,  1.05s/it] 16%|█▌        | 1466/9345 [30:02<2:17:01,  1.04s/it] 16%|█▌        | 1467/9345 [30:03<2:16:00,  1.04s/it] 16%|█▌        | 1468/9345 [30:04<2:15:22,  1.03s/it] 16%|█▌        | 1469/9345 [30:05<2:15:19,  1.03s/it] 16%|█▌        | 1470/9345 [30:06<2:15:22,  1.03s/it] 16%|█▌        | 1471/9345 [30:07<2:15:08,  1.03s/it] 16%|█▌        | 1472/9345 [30:08<2:15:08,  1.03s/it] 16%|█▌        | 1473/9345 [30:09<2:14:43,  1.03s/it] 16%|█▌        | 1474/9345 [30:10<2:14:16,  1.02s/it] 16%|█▌        | 1475/9345 [30:11<2:14:12,  1.02s/it] 16%|█▌        | 1476/9345 [30:12<2:14:04,  1.02s/it] 16%|█▌        | 1477/9345 [30:13<2:13:57,  1.02s/it] 16%|█▌        | 1478/9345 [30:14<2:20:42,  1.07s/it] 16%|█▌        | 1479/9345 [30:15<2:18:58,  1.06s/it] 16%|█▌        | 1480/9345 [30:16<2:17:56,  1.05s/it]                                                     {'loss': 0.2834, 'grad_norm': 0.49507724955758986, 'learning_rate': 3.959336543606207e-05, 'epoch': 0.79}
 16%|█▌        | 1480/9345 [30:16<2:17:56,  1.05s/it] 16%|█▌        | 1481/9345 [30:17<2:17:24,  1.05s/it] 16%|█▌        | 1482/9345 [30:18<2:16:56,  1.04s/it] 16%|█▌        | 1483/9345 [30:19<2:16:05,  1.04s/it] 16%|█▌        | 1484/9345 [30:20<2:15:23,  1.03s/it] 16%|█▌        | 1485/9345 [30:21<2:14:54,  1.03s/it] 16%|█▌        | 1486/9345 [30:22<2:14:28,  1.03s/it] 16%|█▌        | 1487/9345 [30:23<2:14:09,  1.02s/it] 16%|█▌        | 1488/9345 [30:24<2:14:10,  1.02s/it] 16%|█▌        | 1489/9345 [30:25<2:14:09,  1.02s/it] 16%|█▌        | 1490/9345 [30:26<2:14:35,  1.03s/it] 16%|█▌        | 1491/9345 [30:27<2:14:27,  1.03s/it] 16%|█▌        | 1492/9345 [30:29<2:20:42,  1.08s/it] 16%|█▌        | 1493/9345 [30:30<2:18:39,  1.06s/it] 16%|█▌        | 1494/9345 [30:31<2:17:31,  1.05s/it] 16%|█▌        | 1495/9345 [30:32<2:16:09,  1.04s/it] 16%|█▌        | 1496/9345 [30:33<2:15:21,  1.03s/it] 16%|█▌        | 1497/9345 [30:34<2:14:45,  1.03s/it] 16%|█▌        | 1498/9345 [30:35<2:14:45,  1.03s/it] 16%|█▌        | 1499/9345 [30:36<2:14:29,  1.03s/it] 16%|█▌        | 1500/9345 [30:37<2:14:22,  1.03s/it]                                                     {'loss': 0.2642, 'grad_norm': 0.3935443818037677, 'learning_rate': 4.0128410914927775e-05, 'epoch': 0.8}
 16%|█▌        | 1500/9345 [30:37<2:14:22,  1.03s/it][WARNING|trainer.py:3344] 2024-05-31 15:04:58,386 >>  stage3_gather_16bit_weights_on_model_save=false. Saving the full checkpoint instead, use zero_to_fp32.py to recover weights
[INFO|trainer.py:3410] 2024-05-31 15:04:58,387 >> Saving model checkpoint to ./checkpoint_dir/checkpoint-1500
/opt/conda/lib/python3.10/site-packages/peft/utils/save_and_load.py:154: UserWarning: Could not find a config file in ./ - will assume that the vocabulary was not modified.
  warnings.warn(
[INFO|tokenization_utils_base.py:2513] 2024-05-31 15:04:58,407 >> tokenizer config file saved in ./checkpoint_dir/checkpoint-1500/tokenizer_config.json
[INFO|tokenization_utils_base.py:2522] 2024-05-31 15:04:58,407 >> Special tokens file saved in ./checkpoint_dir/checkpoint-1500/special_tokens_map.json
[2024-05-31 15:04:58,506] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step1500 is about to be saved!
[2024-05-31 15:05:02,634] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-1500/global_step1500/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 15:05:02,634] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1500/global_step1500/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 15:05:14,730] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1500/global_step1500/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 15:05:15,068] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1500/global_step1500/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 15:05:15,977] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1500/global_step1500/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 15:05:15,979] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-1500/global_step1500/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 15:05:15,984] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step1500 is ready now!
[2024-05-31 15:05:16,014] [INFO] [logging.py:96:log_dist] [Rank 0] [Torch] Checkpoint global_step1500 is about to be saved!
[2024-05-31 15:05:16,031] [INFO] [logging.py:96:log_dist] [Rank 0] Saving model checkpoint: ./checkpoint_dir/checkpoint-1500/global_step1500/zero_pp_rank_0_mp_rank_00_model_states.pt
[2024-05-31 15:05:16,031] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1500/global_step1500/zero_pp_rank_0_mp_rank_00_model_states.pt...
[2024-05-31 15:05:17,272] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1500/global_step1500/zero_pp_rank_0_mp_rank_00_model_states.pt.
[2024-05-31 15:05:17,274] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving ./checkpoint_dir/checkpoint-1500/global_step1500/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
[2024-05-31 15:05:18,046] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved ./checkpoint_dir/checkpoint-1500/global_step1500/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
[2024-05-31 15:05:18,048] [INFO] [engine.py:3483:_save_zero_checkpoint] zero checkpoint saved ./checkpoint_dir/checkpoint-1500/global_step1500/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
[2024-05-31 15:05:18,055] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step1500 is ready now!
[INFO|trainer.py:3502] 2024-05-31 15:05:18,063 >> Deleting older checkpoint [checkpoint_dir/checkpoint-1400] due to args.save_total_limit
 16%|█▌        | 1501/9345 [30:57<15:08:44,  6.95s/it] 16%|█▌        | 1502/9345 [30:59<11:15:33,  5.17s/it] 16%|█▌        | 1503/9345 [31:00<8:32:27,  3.92s/it]  16%|█▌        | 1504/9345 [31:01<6:38:40,  3.05s/it] 16%|█▌        | 1505/9345 [31:02<5:18:45,  2.44s/it] 16%|█▌        | 1506/9345 [31:03<4:23:02,  2.01s/it] 16%|█▌        | 1507/9345 [31:04<3:50:11,  1.76s/it] 16%|█▌        | 1508/9345 [31:05<3:21:06,  1.54s/it] 16%|█▌        | 1509/9345 [31:06<3:00:35,  1.38s/it] 16%|█▌        | 1510/9345 [31:07<2:46:28,  1.27s/it] 16%|█▌        | 1511/9345 [31:08<2:36:46,  1.20s/it] 16%|█▌        | 1512/9345 [31:09<2:29:45,  1.15s/it] 16%|█▌        | 1513/9345 [31:10<2:24:39,  1.11s/it]W0531 15:05:32.540000 140295535670464 torch/distributed/elastic/agent/server/api.py:741] Received Signals.SIGHUP death signal, shutting down workers
W0531 15:05:32.542000 140295535670464 torch/distributed/elastic/multiprocessing/api.py:851] Sending process 191351 closing signal SIGHUP
Warning: The default cache directory for DeepSpeed Triton autotune, /root/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
[93m [WARNING] [0m async_io requires the dev libaio .so object and headers but these were not found.
[93m [WARNING] [0m async_io: please install the libaio-dev package with apt
[93m [WARNING] [0m If libaio is already installed (perhaps from source), try setting the CFLAGS and LDFLAGS environment variables to where it can be found.
[93m [WARNING] [0m Please specify the CUTLASS repo directory as environment variable $CUTLASS_PATH
[93m [WARNING] [0m sparse_attn requires a torch version >= 1.5 and < 2.0 but detected 2.3
[93m [WARNING] [0m using untested triton version (2.3.0), only 1.0.0 is known to be compatible
Traceback (most recent call last):
  File "/opt/conda/bin/accelerate", line 8, in <module>
    sys.exit(main())
  File "/opt/conda/lib/python3.10/site-packages/accelerate/commands/accelerate_cli.py", line 46, in main
    args.func(args)
  File "/opt/conda/lib/python3.10/site-packages/accelerate/commands/launch.py", line 1067, in launch_command
    deepspeed_launcher(args)
  File "/opt/conda/lib/python3.10/site-packages/accelerate/commands/launch.py", line 771, in deepspeed_launcher
    distrib_run.run(args)
  File "/opt/conda/lib/python3.10/site-packages/torch/distributed/run.py", line 870, in run
    elastic_launch(
  File "/opt/conda/lib/python3.10/site-packages/torch/distributed/launcher/api.py", line 132, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/opt/conda/lib/python3.10/site-packages/torch/distributed/launcher/api.py", line 254, in launch_agent
    result = agent.run()
  File "/opt/conda/lib/python3.10/site-packages/torch/distributed/elastic/metrics/api.py", line 123, in wrapper
    result = f(*args, **kwargs)
  File "/opt/conda/lib/python3.10/site-packages/torch/distributed/elastic/agent/server/api.py", line 733, in run
    result = self._invoke_run(role)
  File "/opt/conda/lib/python3.10/site-packages/torch/distributed/elastic/agent/server/api.py", line 876, in _invoke_run
    time.sleep(monitor_interval)
  File "/opt/conda/lib/python3.10/site-packages/torch/distributed/elastic/multiprocessing/api.py", line 76, in _terminate_process_handler
    raise SignalException(f"Process {os.getpid()} got signal: {sigval}", sigval=sigval)
torch.distributed.elastic.multiprocessing.api.SignalException: Process 191294 got signal: 1
/opt/conda/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/opt/conda/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
[2024-05-31 15:07:09,778] [INFO] [real_accelerator.py:203:get_accelerator] Setting ds_accelerator to cuda (auto detect)
W0531 15:07:10.637000 140673750934720 torch/distributed/run.py:757] 
W0531 15:07:10.637000 140673750934720 torch/distributed/run.py:757] *****************************************
W0531 15:07:10.637000 140673750934720 torch/distributed/run.py:757] Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
W0531 15:07:10.637000 140673750934720 torch/distributed/run.py:757] *****************************************
[2024-05-31 15:07:14,345] [INFO] [real_accelerator.py:203:get_accelerator] Setting ds_accelerator to cuda (auto detect)
[2024-05-31 15:07:14,362] [INFO] [real_accelerator.py:203:get_accelerator] Setting ds_accelerator to cuda (auto detect)
Warning: The default cache directory for DeepSpeed Triton autotune, /root/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
Warning: The default cache directory for DeepSpeed Triton autotune, /root/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
[93m [WARNING] [0m async_io requires the dev libaio .so object and headers but these were not found.
[93m [WARNING] [0m async_io: please install the libaio-dev package with apt
[93m [WARNING] [0m If libaio is already installed (perhaps from source), try setting the CFLAGS and LDFLAGS environment variables to where it can be found.
[93m [WARNING] [0m Please specify the CUTLASS repo directory as environment variable $CUTLASS_PATH
[93m [WARNING] [0m async_io requires the dev libaio .so object and headers but these were not found.
[93m [WARNING] [0m async_io: please install the libaio-dev package with apt
[93m [WARNING] [0m If libaio is already installed (perhaps from source), try setting the CFLAGS and LDFLAGS environment variables to where it can be found.
[93m [WARNING] [0m Please specify the CUTLASS repo directory as environment variable $CUTLASS_PATH
[93m [WARNING] [0m sparse_attn requires a torch version >= 1.5 and < 2.0 but detected 2.3
[93m [WARNING] [0m using untested triton version (2.3.0), only 1.0.0 is known to be compatible
[93m [WARNING] [0m sparse_attn requires a torch version >= 1.5 and < 2.0 but detected 2.3
[93m [WARNING] [0m using untested triton version (2.3.0), only 1.0.0 is known to be compatible
[2024-05-31 15:07:15,131] [INFO] [comm.py:637:init_distributed] cdb=None
[2024-05-31 15:07:15,131] [INFO] [comm.py:668:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
[2024-05-31 15:07:15,142] [INFO] [comm.py:637:init_distributed] cdb=None
2024-05-31 15:07:15 - WARNING - __main__ - Process rank: 0, device: cuda:0, n_gpu: 1 distributed training: True, 16-bits training: False
2024-05-31 15:07:15 - INFO - __main__ - Training/evaluation parameters TrainingArguments(
_n_gpu=1,
accelerator_config={'split_batches': False, 'dispatch_batches': None, 'even_batches': True, 'use_seedable_sampler': True, 'non_blocking': False, 'gradient_accumulation_kwargs': None},
adafactor=False,
adam_beta1=0.9,
adam_beta2=0.999,
adam_epsilon=1e-08,
auto_find_batch_size=False,
batch_eval_metrics=False,
bf16=True,
bf16_full_eval=False,
data_seed=None,
dataloader_drop_last=False,
dataloader_num_workers=0,
dataloader_persistent_workers=False,
dataloader_pin_memory=True,
dataloader_prefetch_factor=None,
ddp_backend=None,
ddp_broadcast_buffers=None,
ddp_bucket_cap_mb=None,
ddp_find_unused_parameters=None,
ddp_timeout=1800,
debug=[],
deepspeed=None,
disable_tqdm=False,
dispatch_batches=None,
do_eval=False,
do_predict=False,
do_train=False,
eval_accumulation_steps=None,
eval_delay=0,
eval_do_concat_batches=True,
eval_steps=None,
eval_strategy=no,
evaluation_strategy=None,
fp16=False,
fp16_backend=auto,
fp16_full_eval=False,
fp16_opt_level=O1,
fsdp=[],
fsdp_config={'min_num_params': 0, 'xla': False, 'xla_fsdp_v2': False, 'xla_fsdp_grad_ckpt': False},
fsdp_min_num_params=0,
fsdp_transformer_layer_cls_to_wrap=None,
full_determinism=False,
gradient_accumulation_steps=1,
gradient_checkpointing=True,
gradient_checkpointing_kwargs={'use_reentrant': False},
greater_is_better=None,
group_by_length=False,
half_precision_backend=auto,
hub_always_push=False,
hub_model_id=None,
hub_private_repo=False,
hub_strategy=every_save,
hub_token=<HUB_TOKEN>,
ignore_data_skip=False,
include_inputs_for_metrics=False,
include_num_input_tokens_seen=False,
include_tokens_per_second=False,
jit_mode_eval=False,
label_names=None,
label_smoothing_factor=0.0,
learning_rate=5e-05,
length_column_name=length,
load_best_model_at_end=False,
local_rank=0,
log_level=info,
log_level_replica=warning,
log_on_each_node=True,
logging_dir=./checkpoint_dir/runs/May31_15-07-14_n08,
logging_first_step=False,
logging_nan_inf_filter=True,
logging_steps=20,
logging_strategy=steps,
lr_scheduler_kwargs={},
lr_scheduler_type=cosine,
max_grad_norm=1.0,
max_steps=-1,
metric_for_best_model=None,
mp_parameters=,
neftune_noise_alpha=None,
no_cuda=False,
num_train_epochs=5,
optim=adamw_torch,
optim_args=None,
optim_target_modules=None,
output_dir=./checkpoint_dir,
overwrite_output_dir=True,
past_index=-1,
per_device_eval_batch_size=2,
per_device_train_batch_size=2,
prediction_loss_only=False,
push_to_hub=False,
push_to_hub_model_id=None,
push_to_hub_organization=None,
push_to_hub_token=<PUSH_TO_HUB_TOKEN>,
ray_scope=last,
remove_unused_columns=True,
report_to=['tensorboard'],
restore_callback_states_from_checkpoint=False,
resume_from_checkpoint=None,
run_name=./checkpoint_dir,
save_on_each_node=False,
save_only_model=False,
save_safetensors=True,
save_steps=100,
save_strategy=steps,
save_total_limit=1,
seed=0,
skip_memory_metrics=True,
split_batches=None,
tf32=None,
torch_compile=False,
torch_compile_backend=None,
torch_compile_mode=None,
torchdynamo=None,
tpu_metrics_debug=False,
tpu_num_cores=None,
use_cpu=False,
use_ipex=False,
use_legacy_prediction_loop=False,
use_mps_device=False,
warmup_ratio=0.2,
warmup_steps=0,
weight_decay=0.0,
)
2024-05-31 15:07:15 - INFO - __main__ - PEFT parameters LoraConfig(peft_type=<PeftType.LORA: 'LORA'>, auto_mapping=None, base_model_name_or_path=None, revision=None, task_type='CAUSAL_LM', inference_mode=False, r=16, target_modules='all-linear', lora_alpha=32, lora_dropout=0.05, fan_in_fan_out=False, bias='none', use_rslora=False, modules_to_save=None, init_lora_weights=True, layers_to_transform=None, layers_pattern=None, rank_pattern={}, alpha_pattern={}, megatron_config=None, megatron_core='megatron.core', loftq_config={}, use_dora=False)
[INFO|configuration_utils.py:731] 2024-05-31 15:07:15,255 >> loading configuration file ./config.json
[INFO|configuration_utils.py:731] 2024-05-31 15:07:15,258 >> loading configuration file ./config.json
[INFO|configuration_utils.py:796] 2024-05-31 15:07:15,259 >> Model config Phi3Config {
  "_name_or_path": "./",
  "architectures": [
    "Phi3ForCausalLM"
  ],
  "attention_dropout": 0.0,
  "auto_map": {
    "AutoConfig": "configuration_phi3.Phi3Config",
    "AutoModelForCausalLM": "modeling_phi3.Phi3ForCausalLM"
  },
  "bos_token_id": 1,
  "embd_pdrop": 0.0,
  "eos_token_id": 32000,
  "hidden_act": "silu",
  "hidden_size": 3072,
  "initializer_range": 0.02,
  "intermediate_size": 8192,
  "max_position_embeddings": 4096,
  "model_type": "phi3",
  "num_attention_heads": 32,
  "num_hidden_layers": 32,
  "num_key_value_heads": 32,
  "original_max_position_embeddings": 4096,
  "pad_token_id": 32000,
  "resid_pdrop": 0.0,
  "rms_norm_eps": 1e-05,
  "rope_scaling": null,
  "rope_theta": 10000.0,
  "sliding_window": 2047,
  "tie_word_embeddings": false,
  "torch_dtype": "bfloat16",
  "transformers_version": "4.41.1",
  "use_cache": false,
  "vocab_size": 32064
}

[INFO|modeling_utils.py:3471] 2024-05-31 15:07:15,304 >> loading weights file ./model.safetensors.index.json
[INFO|modeling_utils.py:1519] 2024-05-31 15:07:15,304 >> Instantiating Phi3ForCausalLM model under default dtype torch.bfloat16.
[INFO|modeling_utils.py:3614] 2024-05-31 15:07:15,305 >> Detected DeepSpeed ZeRO-3: activating zero.init() for this model
[WARNING|logging.py:329] 2024-05-31 15:07:15,308 >> You are attempting to use Flash Attention 2.0 with a model not initialized on GPU. Make sure to move the model to GPU after initializing it on CPU with `model.to('cuda')`.
[INFO|configuration_utils.py:962] 2024-05-31 15:07:15,314 >> Generate config GenerationConfig {
  "bos_token_id": 1,
  "eos_token_id": 32000,
  "pad_token_id": 32000,
  "use_cache": false
}

2024-05-31 15:07:15 - WARNING - __main__ - Process rank: 1, device: cuda:1, n_gpu: 1 distributed training: True, 16-bits training: False
[WARNING|logging.py:329] 2024-05-31 15:07:15,430 >> You are attempting to use Flash Attention 2.0 with a model not initialized on GPU. Make sure to move the model to GPU after initializing it on CPU with `model.to('cuda')`.
[2024-05-31 15:07:15,796] [INFO] [partition_parameters.py:345:__exit__] finished initializing model - num_params = 195, num_elems = 3.82B
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:00<00:00,  4.27it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  4.99it/s]Loading checkpoint shards: 100%|██████████| 2/2 [00:00<00:00,  4.87it/s]
[WARNING|logging.py:314] 2024-05-31 15:07:16,294 >> Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
-----------------------------
['question', 'answer']
-----------------------------
{'question': 'Natalia sold clips to 48 of her friends in April, and then she sold half as many clips in May. How many clips did Natalia sell altogether in April and May?', 'answer': 'Natalia sold 48/2 = <<48/2=24>>24 clips in May.\nNatalia sold 48+24 = <<48+24=72>>72 clips altogether in April and May.'}
<s><|user|>
Answer the following question.

Question: Betty is saving money for a new wallet which costs $100. Betty has only half of the money she needs. Her parents decided to give her $15 for that purpose, and her grandparents twice as much as her parents. How much more money does Betty need to buy the wallet?<|end|>
<|assistant|>
Answer: In the beginning, Betty has only 100 / 2 = $<<100/2=50>>50.
Betty's grandparents gave her 15 * 2 = $<<15*2=30>>30.
This means, Betty needs 100 - 50 - 30 - 15 = $<<100-50-30-15=5>>5 more.
Loading checkpoint shards:  50%|█████     | 1/2 [00:02<00:02,  2.03s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:02<00:00,  1.39s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:02<00:00,  1.49s/it]
[INFO|modeling_utils.py:4280] 2024-05-31 15:07:18,799 >> All model checkpoint weights were used when initializing Phi3ForCausalLM.

[INFO|modeling_utils.py:4288] 2024-05-31 15:07:18,799 >> All the weights of Phi3ForCausalLM were initialized from the model checkpoint at ./.
If your task is similar to the task the model of the checkpoint was trained on, you can already use Phi3ForCausalLM for predictions without further training.
[INFO|configuration_utils.py:915] 2024-05-31 15:07:18,802 >> loading configuration file ./generation_config.json
[INFO|configuration_utils.py:962] 2024-05-31 15:07:18,802 >> Generate config GenerationConfig {
  "bos_token_id": 1,
  "eos_token_id": [
    32000,
    32001,
    32007
  ],
  "pad_token_id": 32000
}

[INFO|tokenization_utils_base.py:2106] 2024-05-31 15:07:18,805 >> loading file tokenizer.model
[INFO|tokenization_utils_base.py:2106] 2024-05-31 15:07:18,805 >> loading file tokenizer.json
[INFO|tokenization_utils_base.py:2106] 2024-05-31 15:07:18,805 >> loading file added_tokens.json
[INFO|tokenization_utils_base.py:2106] 2024-05-31 15:07:18,805 >> loading file special_tokens_map.json
[INFO|tokenization_utils_base.py:2106] 2024-05-31 15:07:18,805 >> loading file tokenizer_config.json
[WARNING|logging.py:314] 2024-05-31 15:07:18,862 >> Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Overwrite dataset info from restored data version if exists.
2024-05-31 15:07:18 - INFO - datasets.builder - Overwrite dataset info from restored data version if exists.
Loading Dataset info from /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5
2024-05-31 15:07:18 - INFO - datasets.info - Loading Dataset info from /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5
Found cached dataset gsm8k (/root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5)
2024-05-31 15:07:18 - INFO - datasets.builder - Found cached dataset gsm8k (/root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5)
Loading Dataset info from /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5
2024-05-31 15:07:18 - INFO - datasets.info - Loading Dataset info from /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5
-----------------------------
['question', 'answer']
-----------------------------
Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-5a7811434d08fb09.arrow
2024-05-31 15:07:18 - INFO - datasets.arrow_dataset - Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-5a7811434d08fb09.arrow
Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-7989e7b156c6dfa6.arrow
2024-05-31 15:07:18 - INFO - datasets.arrow_dataset - Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-7989e7b156c6dfa6.arrow
{'question': 'Natalia sold clips to 48 of her friends in April, and then she sold half as many clips in May. How many clips did Natalia sell altogether in April and May?', 'answer': 'Natalia sold 48/2 = <<48/2=24>>24 clips in May.\nNatalia sold 48+24 = <<48+24=72>>72 clips altogether in April and May.'}
Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-0d894978e4a745e3.arrow
2024-05-31 15:07:18 - INFO - datasets.arrow_dataset - Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-0d894978e4a745e3.arrow
Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-514d9be6b6eed3cb.arrow
2024-05-31 15:07:18 - INFO - datasets.arrow_dataset - Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-514d9be6b6eed3cb.arrow
<s><|user|>
Answer the following question.

Question: Betty is saving money for a new wallet which costs $100. Betty has only half of the money she needs. Her parents decided to give her $15 for that purpose, and her grandparents twice as much as her parents. How much more money does Betty need to buy the wallet?<|end|>
<|assistant|>
Answer: In the beginning, Betty has only 100 / 2 = $<<100/2=50>>50.
Betty's grandparents gave her 15 * 2 = $<<15*2=30>>30.
This means, Betty needs 100 - 50 - 30 - 15 = $<<100-50-30-15=5>>5 more.
Caching indices mapping at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-e93e90f72f868845.arrow
2024-05-31 15:07:18 - INFO - datasets.arrow_dataset - Caching indices mapping at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-e93e90f72f868845.arrow
Caching indices mapping at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-6706bb3b01839252.arrow
2024-05-31 15:07:18 - INFO - datasets.arrow_dataset - Caching indices mapping at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-6706bb3b01839252.arrow
Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-a33b343c530563b1.arrow
2024-05-31 15:07:19 - INFO - datasets.arrow_dataset - Loading cached processed dataset at /root/.cache/huggingface/datasets/gsm8k/main/0.0.0/98a0a808f38328e5/cache-a33b343c530563b1.arrow
[INFO|trainer.py:641] 2024-05-31 15:07:19,502 >> Using auto half precision backend
[2024-05-31 15:07:19,679] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed info: version=0.14.2, git-hash=unknown, git-branch=unknown
[2024-05-31 15:07:19,702] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2024-05-31 15:07:19,705] [INFO] [logging.py:96:log_dist] [Rank 0] Using client Optimizer as basic optimizer
[2024-05-31 15:07:19,705] [INFO] [logging.py:96:log_dist] [Rank 0] Removing param_group that has no 'params' in the basic Optimizer
[2024-05-31 15:07:19,721] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed Basic Optimizer = AdamW
[2024-05-31 15:07:19,721] [INFO] [utils.py:56:is_zero_supported_optimizer] Checking ZeRO support for optimizer=AdamW type=<class 'torch.optim.adamw.AdamW'>
[2024-05-31 15:07:19,721] [INFO] [logging.py:96:log_dist] [Rank 0] Creating fp16 ZeRO stage 3 optimizer, MiCS is enabled False, Hierarchical params gather False
[2024-05-31 15:07:19,721] [INFO] [logging.py:96:log_dist] [Rank 0] Creating torch.bfloat16 ZeRO stage 3 optimizer
[2024-05-31 15:07:19,854] [INFO] [utils.py:779:see_memory_usage] Stage 3 initialize beginning
[2024-05-31 15:07:19,854] [INFO] [utils.py:780:see_memory_usage] MA 3.61 GB         Max_MA 3.93 GB         CA 4.16 GB         Max_CA 5 GB 
[2024-05-31 15:07:19,854] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 25.86 GB, percent = 2.6%
[2024-05-31 15:07:19,860] [INFO] [stage3.py:130:__init__] Reduce bucket size 500,000,000
[2024-05-31 15:07:19,860] [INFO] [stage3.py:131:__init__] Prefetch bucket size 50,000,000
[2024-05-31 15:07:19,988] [INFO] [utils.py:779:see_memory_usage] DeepSpeedZeRoOffload initialize [begin]
[2024-05-31 15:07:19,989] [INFO] [utils.py:780:see_memory_usage] MA 3.61 GB         Max_MA 3.61 GB         CA 4.16 GB         Max_CA 4 GB 
[2024-05-31 15:07:19,989] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 25.87 GB, percent = 2.6%
Parameter Offload: Total persistent parameters: 8064000 in 225 params
[2024-05-31 15:07:20,257] [INFO] [utils.py:779:see_memory_usage] DeepSpeedZeRoOffload initialize [end]
[2024-05-31 15:07:20,257] [INFO] [utils.py:780:see_memory_usage] MA 3.58 GB         Max_MA 3.61 GB         CA 4.16 GB         Max_CA 4 GB 
[2024-05-31 15:07:20,257] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 25.88 GB, percent = 2.6%
[2024-05-31 15:07:20,390] [INFO] [utils.py:779:see_memory_usage] Before creating fp16 partitions
[2024-05-31 15:07:20,391] [INFO] [utils.py:780:see_memory_usage] MA 3.58 GB         Max_MA 3.58 GB         CA 4.16 GB         Max_CA 4 GB 
[2024-05-31 15:07:20,391] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 25.88 GB, percent = 2.6%
[2024-05-31 15:07:20,703] [INFO] [utils.py:779:see_memory_usage] After creating fp16 partitions: 1
[2024-05-31 15:07:20,703] [INFO] [utils.py:780:see_memory_usage] MA 3.58 GB         Max_MA 3.58 GB         CA 4.11 GB         Max_CA 4 GB 
[2024-05-31 15:07:20,704] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 25.9 GB, percent = 2.6%
[2024-05-31 15:07:20,835] [INFO] [utils.py:779:see_memory_usage] Before creating fp32 partitions
[2024-05-31 15:07:20,836] [INFO] [utils.py:780:see_memory_usage] MA 3.58 GB         Max_MA 3.58 GB         CA 4.11 GB         Max_CA 4 GB 
[2024-05-31 15:07:20,836] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 25.9 GB, percent = 2.6%
[2024-05-31 15:07:20,980] [INFO] [utils.py:779:see_memory_usage] After creating fp32 partitions
[2024-05-31 15:07:20,981] [INFO] [utils.py:780:see_memory_usage] MA 3.63 GB         Max_MA 3.65 GB         CA 4.16 GB         Max_CA 4 GB 
[2024-05-31 15:07:20,981] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 25.91 GB, percent = 2.6%
[2024-05-31 15:07:21,114] [INFO] [utils.py:779:see_memory_usage] Before initializing optimizer states
[2024-05-31 15:07:21,115] [INFO] [utils.py:780:see_memory_usage] MA 3.63 GB         Max_MA 3.63 GB         CA 4.16 GB         Max_CA 4 GB 
[2024-05-31 15:07:21,115] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 25.91 GB, percent = 2.6%
[2024-05-31 15:07:21,246] [INFO] [utils.py:779:see_memory_usage] After initializing optimizer states
[2024-05-31 15:07:21,247] [INFO] [utils.py:780:see_memory_usage] MA 3.63 GB         Max_MA 3.68 GB         CA 4.16 GB         Max_CA 4 GB 
[2024-05-31 15:07:21,247] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 25.91 GB, percent = 2.6%
[2024-05-31 15:07:21,247] [INFO] [stage3.py:486:_setup_for_real_optimizer] optimizer state initialized
[2024-05-31 15:07:21,464] [INFO] [utils.py:779:see_memory_usage] After initializing ZeRO optimizer
[2024-05-31 15:07:21,465] [INFO] [utils.py:780:see_memory_usage] MA 4.58 GB         Max_MA 4.59 GB         CA 5.09 GB         Max_CA 5 GB 
[2024-05-31 15:07:21,465] [INFO] [utils.py:787:see_memory_usage] CPU Virtual Memory:  used = 25.96 GB, percent = 2.6%
[2024-05-31 15:07:21,465] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed Final Optimizer = AdamW
[2024-05-31 15:07:21,465] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed using client LR scheduler
[2024-05-31 15:07:21,465] [INFO] [logging.py:96:log_dist] [Rank 0] DeepSpeed LR Scheduler = None
[2024-05-31 15:07:21,465] [INFO] [logging.py:96:log_dist] [Rank 0] step=0, skipped=0, lr=[0.0], mom=[(0.9, 0.999)]
[2024-05-31 15:07:21,468] [INFO] [config.py:996:print] DeepSpeedEngine configuration:
[2024-05-31 15:07:21,469] [INFO] [config.py:1000:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2024-05-31 15:07:21,469] [INFO] [config.py:1000:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2024-05-31 15:07:21,469] [INFO] [config.py:1000:print]   amp_enabled .................. False
[2024-05-31 15:07:21,469] [INFO] [config.py:1000:print]   amp_params ................... False
[2024-05-31 15:07:21,469] [INFO] [config.py:1000:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2024-05-31 15:07:21,469] [INFO] [config.py:1000:print]   bfloat16_enabled ............. True
[2024-05-31 15:07:21,469] [INFO] [config.py:1000:print]   bfloat16_immediate_grad_update  False
[2024-05-31 15:07:21,469] [INFO] [config.py:1000:print]   checkpoint_parallel_write_pipeline  False
[2024-05-31 15:07:21,469] [INFO] [config.py:1000:print]   checkpoint_tag_validation_enabled  True
[2024-05-31 15:07:21,469] [INFO] [config.py:1000:print]   checkpoint_tag_validation_fail  False
[2024-05-31 15:07:21,469] [INFO] [config.py:1000:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7ff9058903d0>
[2024-05-31 15:07:21,469] [INFO] [config.py:1000:print]   communication_data_type ...... None
[2024-05-31 15:07:21,469] [INFO] [config.py:1000:print]   compile_config ............... enabled=False backend='inductor' kwargs={}
[2024-05-31 15:07:21,469] [INFO] [config.py:1000:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2024-05-31 15:07:21,469] [INFO] [config.py:1000:print]   curriculum_enabled_legacy .... False
[2024-05-31 15:07:21,470] [INFO] [config.py:1000:print]   curriculum_params_legacy ..... False
[2024-05-31 15:07:21,470] [INFO] [config.py:1000:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2024-05-31 15:07:21,470] [INFO] [config.py:1000:print]   data_efficiency_enabled ...... False
[2024-05-31 15:07:21,470] [INFO] [config.py:1000:print]   dataloader_drop_last ......... False
[2024-05-31 15:07:21,470] [INFO] [config.py:1000:print]   disable_allgather ............ False
[2024-05-31 15:07:21,470] [INFO] [config.py:1000:print]   dump_state ................... False
[2024-05-31 15:07:21,470] [INFO] [config.py:1000:print]   dynamic_loss_scale_args ...... None
[2024-05-31 15:07:21,470] [INFO] [config.py:1000:print]   eigenvalue_enabled ........... False
[2024-05-31 15:07:21,470] [INFO] [config.py:1000:print]   eigenvalue_gas_boundary_resolution  1
[2024-05-31 15:07:21,470] [INFO] [config.py:1000:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2024-05-31 15:07:21,470] [INFO] [config.py:1000:print]   eigenvalue_layer_num ......... 0
[2024-05-31 15:07:21,470] [INFO] [config.py:1000:print]   eigenvalue_max_iter .......... 100
[2024-05-31 15:07:21,470] [INFO] [config.py:1000:print]   eigenvalue_stability ......... 1e-06
[2024-05-31 15:07:21,470] [INFO] [config.py:1000:print]   eigenvalue_tol ............... 0.01
[2024-05-31 15:07:21,470] [INFO] [config.py:1000:print]   eigenvalue_verbose ........... False
[2024-05-31 15:07:21,470] [INFO] [config.py:1000:print]   elasticity_enabled ........... False
[2024-05-31 15:07:21,470] [INFO] [config.py:1000:print]   flops_profiler_config ........ {
    "enabled": false, 
    "recompute_fwd_factor": 0.0, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2024-05-31 15:07:21,470] [INFO] [config.py:1000:print]   fp16_auto_cast ............... None
[2024-05-31 15:07:21,470] [INFO] [config.py:1000:print]   fp16_enabled ................. False
[2024-05-31 15:07:21,470] [INFO] [config.py:1000:print]   fp16_master_weights_and_gradients  False
[2024-05-31 15:07:21,470] [INFO] [config.py:1000:print]   global_rank .................. 0
[2024-05-31 15:07:21,470] [INFO] [config.py:1000:print]   grad_accum_dtype ............. None
[2024-05-31 15:07:21,470] [INFO] [config.py:1000:print]   gradient_accumulation_steps .. 1
[2024-05-31 15:07:21,471] [INFO] [config.py:1000:print]   gradient_clipping ............ 1.0
[2024-05-31 15:07:21,471] [INFO] [config.py:1000:print]   gradient_predivide_factor .... 1.0
[2024-05-31 15:07:21,471] [INFO] [config.py:1000:print]   graph_harvesting ............. False
[2024-05-31 15:07:21,471] [INFO] [config.py:1000:print]   hybrid_engine ................ enabled=False max_out_tokens=512 inference_tp_size=1 release_inference_cache=False pin_parameters=True tp_gather_partition_size=8
[2024-05-31 15:07:21,471] [INFO] [config.py:1000:print]   initial_dynamic_scale ........ 1
[2024-05-31 15:07:21,471] [INFO] [config.py:1000:print]   load_universal_checkpoint .... False
[2024-05-31 15:07:21,471] [INFO] [config.py:1000:print]   loss_scale ................... 1.0
[2024-05-31 15:07:21,471] [INFO] [config.py:1000:print]   memory_breakdown ............. False
[2024-05-31 15:07:21,471] [INFO] [config.py:1000:print]   mics_hierarchial_params_gather  False
[2024-05-31 15:07:21,471] [INFO] [config.py:1000:print]   mics_shard_size .............. -1
[2024-05-31 15:07:21,471] [INFO] [config.py:1000:print]   monitor_config ............... tensorboard=TensorBoardConfig(enabled=False, output_path='', job_name='DeepSpeedJobName') wandb=WandbConfig(enabled=False, group=None, team=None, project='deepspeed') csv_monitor=CSVConfig(enabled=False, output_path='', job_name='DeepSpeedJobName') enabled=False
[2024-05-31 15:07:21,471] [INFO] [config.py:1000:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2024-05-31 15:07:21,471] [INFO] [config.py:1000:print]   optimizer_legacy_fusion ...... False
[2024-05-31 15:07:21,471] [INFO] [config.py:1000:print]   optimizer_name ............... None
[2024-05-31 15:07:21,471] [INFO] [config.py:1000:print]   optimizer_params ............. None
[2024-05-31 15:07:21,471] [INFO] [config.py:1000:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0, 'pipe_partitioned': True, 'grad_partitioned': True}
[2024-05-31 15:07:21,471] [INFO] [config.py:1000:print]   pld_enabled .................. False
[2024-05-31 15:07:21,471] [INFO] [config.py:1000:print]   pld_params ................... False
[2024-05-31 15:07:21,471] [INFO] [config.py:1000:print]   prescale_gradients ........... False
[2024-05-31 15:07:21,471] [INFO] [config.py:1000:print]   scheduler_name ............... None
[2024-05-31 15:07:21,471] [INFO] [config.py:1000:print]   scheduler_params ............. None
[2024-05-31 15:07:21,471] [INFO] [config.py:1000:print]   seq_parallel_communication_data_type  torch.float32
[2024-05-31 15:07:21,471] [INFO] [config.py:1000:print]   sparse_attention ............. None
[2024-05-31 15:07:21,472] [INFO] [config.py:1000:print]   sparse_gradients_enabled ..... False
[2024-05-31 15:07:21,472] [INFO] [config.py:1000:print]   steps_per_print .............. inf
[2024-05-31 15:07:21,472] [INFO] [config.py:1000:print]   train_batch_size ............. 4
[2024-05-31 15:07:21,472] [INFO] [config.py:1000:print]   train_micro_batch_size_per_gpu  2
[2024-05-31 15:07:21,472] [INFO] [config.py:1000:print]   use_data_before_expert_parallel_  False
[2024-05-31 15:07:21,472] [INFO] [config.py:1000:print]   use_node_local_storage ....... False
[2024-05-31 15:07:21,472] [INFO] [config.py:1000:print]   wall_clock_breakdown ......... False
[2024-05-31 15:07:21,472] [INFO] [config.py:1000:print]   weight_quantization_config ... None
[2024-05-31 15:07:21,472] [INFO] [config.py:1000:print]   world_size ................... 2
[2024-05-31 15:07:21,472] [INFO] [config.py:1000:print]   zero_allow_untested_optimizer  True
[2024-05-31 15:07:21,472] [INFO] [config.py:1000:print]   zero_config .................. stage=3 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 use_multi_rank_bucket_allreduce=True allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=True load_from_fp32_weights=True elastic_checkpoint=False offload_param=DeepSpeedZeroOffloadParamConfig(device='none', nvme_path=None, buffer_count=5, buffer_size=100,000,000, max_in_cpu=1,000,000,000, pin_memory=False) offload_optimizer=DeepSpeedZeroOffloadOptimizerConfig(device='none', nvme_path=None, buffer_count=4, pin_memory=False, pipeline=False, pipeline_read=False, pipeline_write=False, fast_init=False, ratio=1.0) sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=True stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False zero_hpz_partition_size=1 zero_quantized_weights=False zero_quantized_nontrainable_weights=False zero_quantized_gradients=False mics_shard_size=-1 mics_hierarchical_params_gather=False memory_efficient_linear=True pipeline_loading_checkpoint=False override_module_apply=True
[2024-05-31 15:07:21,472] [INFO] [config.py:1000:print]   zero_enabled ................. True
[2024-05-31 15:07:21,472] [INFO] [config.py:1000:print]   zero_force_ds_cpu_optimizer .. True
[2024-05-31 15:07:21,472] [INFO] [config.py:1000:print]   zero_optimization_stage ...... 3
[2024-05-31 15:07:21,472] [INFO] [config.py:986:print_user_config]   json = {
    "train_batch_size": 4, 
    "train_micro_batch_size_per_gpu": 2, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 3, 
        "offload_optimizer": {
            "device": "none", 
            "nvme_path": null
        }, 
        "offload_param": {
            "device": "none", 
            "nvme_path": null
        }, 
        "stage3_gather_16bit_weights_on_model_save": true
    }, 
    "gradient_clipping": 1.0, 
    "steps_per_print": inf, 
    "bf16": {
        "enabled": true
    }, 
    "fp16": {
        "enabled": false
    }, 
    "zero_allow_untested_optimizer": true
}
[INFO|trainer.py:2078] 2024-05-31 15:07:21,472 >> ***** Running training *****
[INFO|trainer.py:2079] 2024-05-31 15:07:21,473 >>   Num examples = 7,473
[INFO|trainer.py:2080] 2024-05-31 15:07:21,473 >>   Num Epochs = 5
[INFO|trainer.py:2081] 2024-05-31 15:07:21,473 >>   Instantaneous batch size per device = 2
[INFO|trainer.py:2084] 2024-05-31 15:07:21,473 >>   Total train batch size (w. parallel, distributed & accumulation) = 4
[INFO|trainer.py:2085] 2024-05-31 15:07:21,473 >>   Gradient Accumulation steps = 1
[INFO|trainer.py:2086] 2024-05-31 15:07:21,473 >>   Total optimization steps = 9,345
[INFO|trainer.py:2087] 2024-05-31 15:07:21,476 >>   Number of trainable parameters = 25,165,824
  0%|          | 0/9345 [00:00<?, ?it/s][rank1]: Traceback (most recent call last):
[rank1]:   File "/root/Phi-3-mini-4k-instruct/sample_finetune.py", line 317, in <module>
[rank1]:     train_result = trainer.train()
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/trl/trainer/sft_trainer.py", line 361, in train
[rank1]:     output = super().train(*args, **kwargs)
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/transformers/trainer.py", line 1885, in train
[rank1]:     return inner_training_loop(
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/transformers/trainer.py", line 2216, in _inner_training_loop
[rank1]:     tr_loss_step = self.training_step(model, inputs)
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/transformers/trainer.py", line 3250, in training_step
[rank1]:     self.accelerator.backward(loss)
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/accelerate/accelerator.py", line 2117, in backward
[rank1]:     self.deepspeed_engine_wrapped.backward(loss, **kwargs)
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/accelerate/utils/deepspeed.py", line 166, in backward
[rank1]:     self.engine.backward(loss, **kwargs)
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
[rank1]:     ret_val = func(*args, **kwargs)
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/runtime/engine.py", line 2002, in backward
[rank1]:     self.allreduce_gradients()
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
[rank1]:     ret_val = func(*args, **kwargs)
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/runtime/engine.py", line 1921, in allreduce_gradients
[rank1]:     self.optimizer.overlapping_partition_gradients_reduce_epilogue()
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/runtime/zero/stage3.py", line 1110, in overlapping_partition_gradients_reduce_epilogue
[rank1]:     self.independent_gradient_partition_epilogue()
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
[rank1]:     ret_val = func(*args, **kwargs)
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/runtime/zero/stage3.py", line 1084, in independent_gradient_partition_epilogue
[rank1]:     self.__reduce_and_partition_ipg_grads()
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
[rank1]:     ret_val = func(*args, **kwargs)
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
[rank1]:     return func(*args, **kwargs)
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/runtime/zero/stage3.py", line 1274, in __reduce_and_partition_ipg_grads
[rank1]:     grad_partitions = self.__avg_scatter_grads(self.params_in_ipg_bucket)
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
[rank1]:     ret_val = func(*args, **kwargs)
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/runtime/zero/stage3.py", line 1343, in __avg_scatter_grads
[rank1]:     grad_partitions_for_rank = reduce_scatter_coalesced(full_grads_for_rank, self.dp_process_group)
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
[rank1]:     ret_val = func(*args, **kwargs)
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
[rank1]:     return func(*args, **kwargs)
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/runtime/comm/coalesced_collectives.py", line 128, in reduce_scatter_coalesced
[rank1]:     _torch_reduce_scatter_fn(tensor_partition_flat_buffer,
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/runtime/comm/coalesced_collectives.py", line 23, in _torch_reduce_scatter_fn
[rank1]:     return instrument_w_nvtx(dist.reduce_scatter_fn)(output_tensor, input_tensor, group=group, async_op=False)
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
[rank1]:     ret_val = func(*args, **kwargs)
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/comm/comm.py", line 257, in reduce_scatter_fn
[rank1]:     return reduce_scatter_tensor(output_tensor,
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/comm/comm.py", line 117, in log_wrapper
[rank1]:     return func(*args, **kwargs)
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/comm/comm.py", line 289, in reduce_scatter_tensor
[rank1]:     return cdb.reduce_scatter_tensor(output_tensor=output_tensor,
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 451, in _fn
[rank1]:     return fn(*args, **kwargs)
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/comm/torch.py", line 263, in reduce_scatter_tensor
[rank1]:     return self.reduce_scatter_function(output_tensor,
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/torch/distributed/c10d_logger.py", line 75, in wrapper
[rank1]:     return func(*args, **kwargs)
[rank1]:   File "/opt/conda/lib/python3.10/site-packages/torch/distributed/distributed_c10d.py", line 3359, in reduce_scatter_tensor
[rank1]:     work = group._reduce_scatter_base(output, input, opts)
[rank1]: torch.distributed.DistBackendError: NCCL error in: ../torch/csrc/distributed/c10d/ProcessGroupNCCL.cpp:1970, unhandled system error (run with NCCL_DEBUG=INFO for details), NCCL version 2.20.5
[rank1]: ncclSystemError: System call (e.g. socket, malloc) or external library call failed or device error. 
[rank1]: Last error:
[rank1]: Error while creating shared memory segment /dev/shm/nccl-0CsCxy (size 9637888)
[rank0]: Traceback (most recent call last):
[rank0]:   File "/root/Phi-3-mini-4k-instruct/sample_finetune.py", line 317, in <module>
[rank0]:     train_result = trainer.train()
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/trl/trainer/sft_trainer.py", line 361, in train
[rank0]:     output = super().train(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/transformers/trainer.py", line 1885, in train
[rank0]:     return inner_training_loop(
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/transformers/trainer.py", line 2216, in _inner_training_loop
[rank0]:     tr_loss_step = self.training_step(model, inputs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/transformers/trainer.py", line 3250, in training_step
[rank0]:     self.accelerator.backward(loss)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/accelerate/accelerator.py", line 2117, in backward
[rank0]:     self.deepspeed_engine_wrapped.backward(loss, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/accelerate/utils/deepspeed.py", line 166, in backward
[rank0]:     self.engine.backward(loss, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
[rank0]:     ret_val = func(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/runtime/engine.py", line 2002, in backward
[rank0]:     self.allreduce_gradients()
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
[rank0]:     ret_val = func(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/runtime/engine.py", line 1921, in allreduce_gradients
[rank0]:     self.optimizer.overlapping_partition_gradients_reduce_epilogue()
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/runtime/zero/stage3.py", line 1110, in overlapping_partition_gradients_reduce_epilogue
[rank0]:     self.independent_gradient_partition_epilogue()
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
[rank0]:     ret_val = func(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/runtime/zero/stage3.py", line 1084, in independent_gradient_partition_epilogue
[rank0]:     self.__reduce_and_partition_ipg_grads()
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
[rank0]:     ret_val = func(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
[rank0]:     return func(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/runtime/zero/stage3.py", line 1274, in __reduce_and_partition_ipg_grads
[rank0]:     grad_partitions = self.__avg_scatter_grads(self.params_in_ipg_bucket)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
[rank0]:     ret_val = func(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/runtime/zero/stage3.py", line 1343, in __avg_scatter_grads
[rank0]:     grad_partitions_for_rank = reduce_scatter_coalesced(full_grads_for_rank, self.dp_process_group)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
[rank0]:     ret_val = func(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
[rank0]:     return func(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/runtime/comm/coalesced_collectives.py", line 128, in reduce_scatter_coalesced
[rank0]:     _torch_reduce_scatter_fn(tensor_partition_flat_buffer,
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/runtime/comm/coalesced_collectives.py", line 23, in _torch_reduce_scatter_fn
[rank0]:     return instrument_w_nvtx(dist.reduce_scatter_fn)(output_tensor, input_tensor, group=group, async_op=False)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/utils/nvtx.py", line 15, in wrapped_fn
[rank0]:     ret_val = func(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/comm/comm.py", line 257, in reduce_scatter_fn
[rank0]:     return reduce_scatter_tensor(output_tensor,
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/comm/comm.py", line 117, in log_wrapper
[rank0]:     return func(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/comm/comm.py", line 289, in reduce_scatter_tensor
[rank0]:     return cdb.reduce_scatter_tensor(output_tensor=output_tensor,
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/_dynamo/eval_frame.py", line 451, in _fn
[rank0]:     return fn(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/deepspeed/comm/torch.py", line 263, in reduce_scatter_tensor
[rank0]:     return self.reduce_scatter_function(output_tensor,
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/distributed/c10d_logger.py", line 75, in wrapper
[rank0]:     return func(*args, **kwargs)
[rank0]:   File "/opt/conda/lib/python3.10/site-packages/torch/distributed/distributed_c10d.py", line 3359, in reduce_scatter_tensor
[rank0]:     work = group._reduce_scatter_base(output, input, opts)
[rank0]: torch.distributed.DistBackendError: NCCL error in: ../torch/csrc/distributed/c10d/ProcessGroupNCCL.cpp:1970, unhandled system error (run with NCCL_DEBUG=INFO for details), NCCL version 2.20.5
[rank0]: ncclSystemError: System call (e.g. socket, malloc) or external library call failed or device error. 
[rank0]: Last error:
[rank0]: Error while creating shared memory segment /dev/shm/nccl-IOhvBu (size 9637888)
  0%|          | 0/9345 [00:03<?, ?it/s]
E0531 15:07:25.660000 140673750934720 torch/distributed/elastic/multiprocessing/api.py:826] failed (exitcode: 1) local_rank: 0 (pid: 197146) of binary: /opt/conda/bin/python
Warning: The default cache directory for DeepSpeed Triton autotune, /root/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
[93m [WARNING] [0m async_io requires the dev libaio .so object and headers but these were not found.
[93m [WARNING] [0m async_io: please install the libaio-dev package with apt
[93m [WARNING] [0m If libaio is already installed (perhaps from source), try setting the CFLAGS and LDFLAGS environment variables to where it can be found.
[93m [WARNING] [0m Please specify the CUTLASS repo directory as environment variable $CUTLASS_PATH
[93m [WARNING] [0m sparse_attn requires a torch version >= 1.5 and < 2.0 but detected 2.3
[93m [WARNING] [0m using untested triton version (2.3.0), only 1.0.0 is known to be compatible
Traceback (most recent call last):
  File "/opt/conda/bin/accelerate", line 8, in <module>
    sys.exit(main())
  File "/opt/conda/lib/python3.10/site-packages/accelerate/commands/accelerate_cli.py", line 46, in main
    args.func(args)
  File "/opt/conda/lib/python3.10/site-packages/accelerate/commands/launch.py", line 1067, in launch_command
    deepspeed_launcher(args)
  File "/opt/conda/lib/python3.10/site-packages/accelerate/commands/launch.py", line 771, in deepspeed_launcher
    distrib_run.run(args)
  File "/opt/conda/lib/python3.10/site-packages/torch/distributed/run.py", line 870, in run
    elastic_launch(
  File "/opt/conda/lib/python3.10/site-packages/torch/distributed/launcher/api.py", line 132, in __call__
    return launch_agent(self._config, self._entrypoint, list(args))
  File "/opt/conda/lib/python3.10/site-packages/torch/distributed/launcher/api.py", line 263, in launch_agent
    raise ChildFailedError(
torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
============================================================
sample_finetune.py FAILED
------------------------------------------------------------
Failures:
[1]:
  time      : 2024-05-31_15:07:25
  host      : n08
  rank      : 1 (local_rank: 1)
  exitcode  : 1 (pid: 197147)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
------------------------------------------------------------
Root Cause (first observed failure):
[0]:
  time      : 2024-05-31_15:07:25
  host      : n08
  rank      : 0 (local_rank: 0)
  exitcode  : 1 (pid: 197146)
  error_file: <N/A>
  traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
============================================================
